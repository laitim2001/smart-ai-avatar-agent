# Persona Management System - å®Œæ•´æ¸¬è©¦æŒ‡å—

## ğŸ“‹ æ¸¬è©¦æ¦‚è¦½

æœ¬æ–‡ä»¶æä¾› Persona ç®¡ç†ç³»çµ±çš„å®Œæ•´æ¸¬è©¦æµç¨‹ï¼ŒåŒ…å« API æ¸¬è©¦ã€UI æ¸¬è©¦ã€æ•´åˆæ¸¬è©¦å’Œé æœŸè¡Œç‚ºé©—è­‰ã€‚

**æ¸¬è©¦ç¯„åœ**:
- âœ… CRUD API ç«¯é»
- âœ… UI å…ƒä»¶äº’å‹•
- âœ… åˆªé™¤é©—è­‰é‚è¼¯
- âœ… Agent-Persona ç¶å®šé—œä¿‚
- âœ… è³‡æ–™é©—è­‰èˆ‡éŒ¯èª¤è™•ç†

---

## ğŸ”§ æ¸¬è©¦ç’°å¢ƒæº–å‚™

### 1. å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨

```bash
# ç¢ºä¿åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„
cd C:\smart-ai-avatar-agent

# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
npm run dev

# ä¼ºæœå™¨æ‡‰è©²åœ¨ http://localhost:3002 é‹è¡Œ
```

### 2. æª¢æŸ¥è³‡æ–™åº«é€£ç·š

```bash
# ç¢ºèª Prisma é€£ç·š
npx prisma studio

# é–‹å•Ÿ http://localhost:5555 æŸ¥çœ‹è³‡æ–™åº«
# æª¢æŸ¥ Persona å’Œ AIAgent è¡¨æ˜¯å¦å­˜åœ¨
```

### 3. æº–å‚™æ¸¬è©¦å·¥å…·

- **ç€è¦½å™¨**: Chrome/Edge (å»ºè­°é–‹å•Ÿé–‹ç™¼è€…å·¥å…·)
- **API æ¸¬è©¦**: Postman, Insomnia, æˆ– curl
- **è³‡æ–™åº«**: Prisma Studio (http://localhost:5555)

---

## ğŸ§ª API ç«¯é»æ¸¬è©¦

### Test 1: å»ºç«‹æ–° Persona (POST /api/personas)

**è«‹æ±‚**:
```bash
curl -X POST http://localhost:3002/api/personas \
  -H "Content-Type: application/json" \
  -d '{
    "name": "æŠ€è¡“æ¶æ§‹å¸«",
    "role": "Technical Architect",
    "description": "å°ˆæ³¨æ–¼ç³»çµ±è¨­è¨ˆèˆ‡æ¶æ§‹è¦åŠƒï¼Œæ“…é•·å¾®æœå‹™ã€é›²ç«¯æ¶æ§‹å’Œæ•ˆèƒ½å„ªåŒ–ã€‚æä¾›æŠ€è¡“æ±ºç­–å»ºè­°å’Œæœ€ä½³å¯¦è¸æŒ‡å°ã€‚",
    "systemPrompt": "ä½ æ˜¯ä¸€ä½è³‡æ·±æŠ€è¡“æ¶æ§‹å¸«ï¼Œæ“æœ‰ 15 å¹´ä»¥ä¸Šçš„ç³»çµ±è¨­è¨ˆç¶“é©—ã€‚ä½ æ“…é•·åˆ†ææ¥­å‹™éœ€æ±‚ä¸¦è½‰åŒ–ç‚ºå¯æ“´å±•çš„æŠ€è¡“æ¶æ§‹ï¼Œç†Ÿæ‚‰å„ç¨®è¨­è¨ˆæ¨¡å¼ã€å¾®æœå‹™æ¶æ§‹ã€é›²ç«¯æŠ€è¡“å’Œæ•ˆèƒ½å„ªåŒ–ç­–ç•¥ã€‚åœ¨å›ç­”å•é¡Œæ™‚ï¼Œä½ æœƒï¼š\n1. è€ƒæ…®ç³»çµ±çš„å¯æ“´å±•æ€§ã€å¯ç¶­è­·æ€§å’Œæ•ˆèƒ½\n2. æä¾›å¤šå€‹æŠ€è¡“æ–¹æ¡ˆä¸¦åˆ†æå„ªåŠ£\n3. å¼•ç”¨æ¥­ç•Œæœ€ä½³å¯¦è¸å’Œæ¡ˆä¾‹\n4. ä½¿ç”¨æ¸…æ™°çš„æŠ€è¡“è¡“èªï¼Œå¿…è¦æ™‚é™„ä¸Šåœ–è¡¨èªªæ˜\n5. é—œæ³¨é•·æœŸæŠ€è¡“å‚µå‹™å’Œæ¼”é€²è·¯å¾‘",
    "language": "zh-TW",
    "tone": "professional",
    "style": ["analytical", "systematic", "detail-oriented"],
    "capabilities": ["ç³»çµ±è¨­è¨ˆ", "æ¶æ§‹è¦åŠƒ", "æ•ˆèƒ½å„ªåŒ–", "æŠ€è¡“é¸å‹", "ç¨‹å¼ç¢¼å¯©æŸ¥"],
    "restrictions": ["ä¸è¨è«–æ”¿æ²»è©±é¡Œ", "ä¸æä¾›å…·é«”çš„å•†æ¥­æ©Ÿå¯†è³‡è¨Š"],
    "version": "1.0.0"
  }'
```

**é æœŸå›æ‡‰** (status: 200):
```json
{
  "success": true,
  "data": {
    "id": "cm123abc456",
    "name": "æŠ€è¡“æ¶æ§‹å¸«",
    "role": "Technical Architect",
    "description": "å°ˆæ³¨æ–¼ç³»çµ±è¨­è¨ˆèˆ‡æ¶æ§‹è¦åŠƒ...",
    "language": "zh-TW",
    "tone": "professional",
    "version": "1.0.0",
    "createdAt": "2025-10-23T10:30:00.000Z"
  },
  "message": "Persona å·²å»ºç«‹",
  "timestamp": "2025-10-23T10:30:00.123Z"
}
```

**é©—è­‰é»**:
- âœ… status code ç‚º 200
- âœ… success ç‚º true
- âœ… data åŒ…å«å®Œæ•´ Persona è³‡è¨Š
- âœ… id å·²è‡ªå‹•ç”Ÿæˆ (CUID)
- âœ… createdAt æ™‚é–“æˆ³å·²è¨­å®š

**å¤±æ•—æ¡ˆä¾‹æ¸¬è©¦**:

**1.1 ç¼ºå°‘å¿…å¡«æ¬„ä½**:
```bash
curl -X POST http://localhost:3002/api/personas \
  -H "Content-Type: application/json" \
  -d '{
    "name": "æ¸¬è©¦",
    "description": "å¤ªçŸ­"
  }'
```

é æœŸå›æ‡‰ (status: 400):
```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "è³‡æ–™é©—è­‰å¤±æ•—",
    "details": {
      "role": { "_errors": ["Required"] },
      "systemPrompt": { "_errors": ["Required"] },
      "description": { "_errors": ["æè¿°è‡³å°‘éœ€è¦ 10 å­—å…ƒ"] }
    }
  }
}
```

**1.2 ç„¡æ•ˆçš„ language**:
```bash
curl -X POST http://localhost:3002/api/personas \
  -H "Content-Type: application/json" \
  -d '{
    "name": "æ¸¬è©¦",
    "role": "æ¸¬è©¦",
    "description": "é€™æ˜¯ä¸€å€‹æ¸¬è©¦æè¿°è‡³å°‘åå€‹å­—å…ƒ",
    "systemPrompt": "é€™æ˜¯ä¸€å€‹æ¸¬è©¦çš„ System Promptï¼Œéœ€è¦è‡³å°‘ä¸€ç™¾å€‹å­—å…ƒæ‰èƒ½é€šéé©—è­‰ã€‚æ‰€ä»¥æˆ‘éœ€è¦å¯«æ›´å¤šçš„å…§å®¹ä¾†é”åˆ°é€™å€‹è¦æ±‚ã€‚è®“æˆ‘ç¹¼çºŒå¯«ä¸€äº›æœ‰æ„ç¾©çš„å…§å®¹ä¾†ç¢ºä¿é•·åº¦è¶³å¤ ã€‚",
    "language": "invalid-lang",
    "tone": "professional"
  }'
```

é æœŸå›æ‡‰ (status: 400):
```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "è³‡æ–™é©—è­‰å¤±æ•—",
    "details": {
      "language": { "_errors": ["èªè¨€å¿…é ˆæ˜¯ zh-TW, en æˆ– ja"] }
    }
  }
}
```

---

### Test 2: å–å¾—æ‰€æœ‰ Personas (GET /api/personas)

**è«‹æ±‚**:
```bash
curl -X GET http://localhost:3002/api/personas
```

**é æœŸå›æ‡‰** (status: 200):
```json
{
  "success": true,
  "data": [
    {
      "id": "cm123abc456",
      "name": "æŠ€è¡“æ¶æ§‹å¸«",
      "role": "Technical Architect",
      "description": "å°ˆæ³¨æ–¼ç³»çµ±è¨­è¨ˆèˆ‡æ¶æ§‹è¦åŠƒ...",
      "language": "zh-TW",
      "tone": "professional",
      "capabilities": ["ç³»çµ±è¨­è¨ˆ", "æ¶æ§‹è¦åŠƒ", "æ•ˆèƒ½å„ªåŒ–"],
      "version": "1.0.0"
    }
  ],
  "total": 1,
  "timestamp": "2025-10-23T10:31:00.123Z"
}
```

**é©—è­‰é»**:
- âœ… å›å‚³æ‰€æœ‰å•Ÿç”¨çš„ Persona (isActive: true)
- âœ… æŒ‰ç…§ createdAt é™åºæ’åº (æœ€æ–°çš„åœ¨å‰)
- âœ… total æ¬„ä½æ­£ç¢ºé¡¯ç¤ºæ•¸é‡
- âœ… åªåŒ…å«å¿…è¦æ¬„ä½ (ä¸åŒ…å« systemPrompt)

---

### Test 3: å–å¾—å–®ä¸€ Persona (GET /api/personas/[id])

**è«‹æ±‚**:
```bash
# æ›¿æ› {id} ç‚ºå¯¦éš›çš„ Persona ID
curl -X GET http://localhost:3002/api/personas/cm123abc456
```

**é æœŸå›æ‡‰** (status: 200):
```json
{
  "success": true,
  "data": {
    "id": "cm123abc456",
    "name": "æŠ€è¡“æ¶æ§‹å¸«",
    "role": "Technical Architect",
    "description": "å°ˆæ³¨æ–¼ç³»çµ±è¨­è¨ˆèˆ‡æ¶æ§‹è¦åŠƒ...",
    "systemPrompt": "ä½ æ˜¯ä¸€ä½è³‡æ·±æŠ€è¡“æ¶æ§‹å¸«...",
    "language": "zh-TW",
    "tone": "professional",
    "style": ["analytical", "systematic", "detail-oriented"],
    "capabilities": ["ç³»çµ±è¨­è¨ˆ", "æ¶æ§‹è¦åŠƒ", "æ•ˆèƒ½å„ªåŒ–"],
    "restrictions": ["ä¸è¨è«–æ”¿æ²»è©±é¡Œ"],
    "version": "1.0.0",
    "isActive": true,
    "createdAt": "2025-10-23T10:30:00.000Z",
    "updatedAt": "2025-10-23T10:30:00.000Z",
    "agents": []
  },
  "timestamp": "2025-10-23T10:32:00.123Z"
}
```

**é©—è­‰é»**:
- âœ… åŒ…å«å®Œæ•´çš„ Persona è³‡è¨Š (å« systemPrompt)
- âœ… åŒ…å«é—œè¯çš„ agents é™£åˆ—
- âœ… åŒ…å« createdAt å’Œ updatedAt æ™‚é–“æˆ³

**å¤±æ•—æ¡ˆä¾‹æ¸¬è©¦**:

**3.1 ä¸å­˜åœ¨çš„ ID**:
```bash
curl -X GET http://localhost:3002/api/personas/invalid-id-123
```

é æœŸå›æ‡‰ (status: 404):
```json
{
  "success": false,
  "error": {
    "code": "PERSONA_NOT_FOUND",
    "message": "æ‰¾ä¸åˆ°æŒ‡å®šçš„ Persona"
  }
}
```

---

### Test 4: æ›´æ–° Persona (PUT /api/personas/[id])

**è«‹æ±‚**:
```bash
curl -X PUT http://localhost:3002/api/personas/cm123abc456 \
  -H "Content-Type: application/json" \
  -d '{
    "name": "æŠ€è¡“æ¶æ§‹å¸«",
    "role": "Senior Technical Architect",
    "description": "å°ˆæ³¨æ–¼ç³»çµ±è¨­è¨ˆèˆ‡æ¶æ§‹è¦åŠƒï¼Œæ“…é•·å¾®æœå‹™ã€é›²ç«¯æ¶æ§‹å’Œæ•ˆèƒ½å„ªåŒ–ã€‚æä¾›æŠ€è¡“æ±ºç­–å»ºè­°å’Œæœ€ä½³å¯¦è¸æŒ‡å°ã€‚",
    "systemPrompt": "ä½ æ˜¯ä¸€ä½è³‡æ·±æŠ€è¡“æ¶æ§‹å¸«ï¼Œæ“æœ‰ 15 å¹´ä»¥ä¸Šçš„ç³»çµ±è¨­è¨ˆç¶“é©—...",
    "language": "zh-TW",
    "tone": "professional",
    "style": ["analytical", "systematic", "detail-oriented"],
    "capabilities": ["ç³»çµ±è¨­è¨ˆ", "æ¶æ§‹è¦åŠƒ", "æ•ˆèƒ½å„ªåŒ–", "æŠ€è¡“é¸å‹", "ç¨‹å¼ç¢¼å¯©æŸ¥"],
    "restrictions": ["ä¸è¨è«–æ”¿æ²»è©±é¡Œ"],
    "version": "1.1.0"
  }'
```

**é æœŸå›æ‡‰** (status: 200):
```json
{
  "success": true,
  "data": {
    "id": "cm123abc456",
    "name": "æŠ€è¡“æ¶æ§‹å¸«",
    "role": "Senior Technical Architect",
    "version": "1.1.0",
    "updatedAt": "2025-10-23T10:35:00.000Z"
  },
  "message": "Persona å·²æ›´æ–°",
  "timestamp": "2025-10-23T10:35:00.123Z"
}
```

**é©—è­‰é»**:
- âœ… role å·²å¾ "Technical Architect" æ›´æ–°ç‚º "Senior Technical Architect"
- âœ… version å·²å¾ "1.0.0" æ›´æ–°ç‚º "1.1.0"
- âœ… updatedAt æ™‚é–“æˆ³å·²æ›´æ–°

---

### Test 5: å–å¾— Persona çš„é—œè¯ Agents (GET /api/personas/[id]/agents)

**è«‹æ±‚**:
```bash
curl -X GET http://localhost:3002/api/personas/cm123abc456/agents
```

**é æœŸå›æ‡‰ (ç„¡é—œè¯)** (status: 200):
```json
{
  "success": true,
  "data": [],
  "total": 0,
  "timestamp": "2025-10-23T10:36:00.123Z"
}
```

**é æœŸå›æ‡‰ (æœ‰é—œè¯)** (status: 200):
```json
{
  "success": true,
  "data": [
    {
      "id": "agent123",
      "name": "ç³»çµ±æ¶æ§‹åŠ©æ‰‹",
      "description": "å”åŠ©ç³»çµ±æ¶æ§‹è¨­è¨ˆ",
      "category": "æŠ€è¡“",
      "isActive": true,
      "createdAt": "2025-10-23T09:00:00.000Z"
    }
  ],
  "total": 1,
  "timestamp": "2025-10-23T10:36:00.123Z"
}
```

---

### Test 6: åˆªé™¤ Persona (DELETE /api/personas/[id])

**æ¡ˆä¾‹ 6.1: åˆªé™¤æ²’æœ‰é—œè¯ Agent çš„ Persona (æˆåŠŸ)**

**è«‹æ±‚**:
```bash
curl -X DELETE http://localhost:3002/api/personas/cm123abc456
```

**é æœŸå›æ‡‰** (status: 200):
```json
{
  "success": true,
  "message": "Persona å·²åˆªé™¤",
  "timestamp": "2025-10-23T10:37:00.123Z"
}
```

**é©—è­‰é»**:
- âœ… Persona å·²å¾è³‡æ–™åº«ä¸­åˆªé™¤
- âœ… GET /api/personas ä¸å†å›å‚³æ­¤ Persona

---

**æ¡ˆä¾‹ 6.2: åˆªé™¤æœ‰é—œè¯ Agent çš„ Persona (å¤±æ•— - é‡è¦ï¼)**

**å‰ç½®æ­¥é©Ÿ**:
1. å»ºç«‹ä¸€å€‹æ–°çš„ Persona
2. å»ºç«‹ä¸€å€‹ Agent ä¸¦ç¶å®šåˆ°è©² Persona
3. å˜—è©¦åˆªé™¤è©² Persona

**è«‹æ±‚**:
```bash
# å‡è¨­ Persona ID ç‚º cm456def789
curl -X DELETE http://localhost:3002/api/personas/cm456def789
```

**é æœŸå›æ‡‰** (status: 400):
```json
{
  "success": false,
  "error": {
    "code": "PERSONA_IN_USE",
    "message": "æ­¤ Persona æ­£è¢«ä½¿ç”¨ï¼Œç„¡æ³•åˆªé™¤",
    "details": {
      "linkedAgents": [
        {
          "id": "agent123",
          "name": "ç³»çµ±æ¶æ§‹åŠ©æ‰‹",
          "category": "æŠ€è¡“",
          "isActive": true
        }
      ],
      "agentCount": 1
    }
  },
  "timestamp": "2025-10-23T10:38:00.123Z"
}
```

**é©—è­‰é»**:
- âœ… status code ç‚º 400 (Bad Request)
- âœ… error.code ç‚º "PERSONA_IN_USE"
- âœ… error.details åŒ…å«å®Œæ•´çš„ linkedAgents åˆ—è¡¨
- âœ… Persona ä»ç„¶å­˜åœ¨æ–¼è³‡æ–™åº«ä¸­ (æœªè¢«åˆªé™¤)

---

## ğŸ¨ UI æ¸¬è©¦

### Test 7: Persona åˆ—è¡¨é é¢åŸºæœ¬åŠŸèƒ½

**æ­¥é©Ÿ**:
1. é–‹å•Ÿç€è¦½å™¨ï¼Œå‰å¾€ `http://localhost:3002/zh-TW/knowledge/persona`
2. è§€å¯Ÿé é¢è¼‰å…¥

**é æœŸçµæœ**:

**7.1 çµ±è¨ˆå¡ç‰‡é¡¯ç¤º**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“š Persona ç¸½æ•¸         â”‚ â”‚ ğŸ¤– é—œè¯ Agent æ•¸é‡       â”‚
â”‚ 3                       â”‚ â”‚ 5                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒ èªè¨€ç¨®é¡              â”‚ â”‚ âœ… å•Ÿç”¨æ•¸é‡              â”‚
â”‚ 3                       â”‚ â”‚ 3                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**7.2 æœå°‹èˆ‡ç¯©é¸å€åŸŸ**:
- âœ… é¡¯ç¤ºæœå°‹è¼¸å…¥æ¡† (placeholder: "æœå°‹ Persona åç¨±ã€è§’è‰²ã€æè¿°...")
- âœ… é¡¯ç¤ºèªè¨€ç¯©é¸ä¸‹æ‹‰é¸å–® (æ‰€æœ‰èªè¨€, ç¹é«”ä¸­æ–‡, English, æ—¥æœ¬èª)
- âœ… é¡¯ç¤ºç‹€æ…‹ç¯©é¸ä¸‹æ‹‰é¸å–® (æ‰€æœ‰ç‹€æ…‹, å•Ÿç”¨, åœç”¨)
- âœ… é¡¯ç¤º "+ æ–°å¢ Persona" æŒ‰éˆ• (è—è‰²)
- âœ… **æ‰€æœ‰ä¸‹æ‹‰é¸å–®èƒŒæ™¯ç‚ºç™½è‰²ï¼Œä¸é€æ˜**

**7.3 Persona å¡ç‰‡ç¶²æ ¼**:
- âœ… ä»¥å¡ç‰‡å½¢å¼é¡¯ç¤ºæ‰€æœ‰ Persona
- âœ… æ¯å¼µå¡ç‰‡åŒ…å«:
  - åç¨± (CardTitle)
  - è§’è‰² (text-muted-foreground)
  - æè¿° (line-clamp-2, æœ€å¤šå…©è¡Œ)
  - èªè¨€ Badge (Globe icon)
  - èªæ°£ Badge
  - ç‰ˆæœ¬ Badge (v1.0.0)
  - èƒ½åŠ›æ¨™ç±¤ (ç´«è‰², æœ€å¤šé¡¯ç¤º 3 å€‹)
  - Agent æ•¸é‡ (Bot icon)
  - ç·¨è¼¯æŒ‰éˆ• (outline)
  - åˆªé™¤æŒ‰éˆ• (destructive)

**7.4 ç©ºç‹€æ…‹é¡¯ç¤º**:
å¦‚æœæ²’æœ‰ Persona:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        å°šæœªå»ºç«‹ä»»ä½• Persona         â”‚
â”‚                                    â”‚
â”‚   é»æ“Šã€Œæ–°å¢ Personaã€æŒ‰éˆ•é–‹å§‹å»ºç«‹  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Test 8: å»ºç«‹æ–° Persona (PersonaForm)

**æ­¥é©Ÿ**:
1. é»æ“Š "+ æ–°å¢ Persona" æŒ‰éˆ•
2. è§€å¯Ÿå°è©±æ¡†é–‹å•Ÿ

**é æœŸçµæœ**:

**8.1 å°è©±æ¡†çµæ§‹**:
- âœ… æ¨™é¡Œ: "å»ºç«‹æ–° Persona"
- âœ… 4 å€‹åˆ†é æ¨™ç±¤:
  - åŸºæœ¬è³‡è¨Š (é è¨­é¸ä¸­)
  - System Prompt
  - ç‰¹å¾µé…ç½®
  - ç‰ˆæœ¬èˆ‡ç‹€æ…‹

**8.2 Tab 1: åŸºæœ¬è³‡è¨Š**:
- âœ… åç¨±è¼¸å…¥æ¡† (å¿…å¡«, placeholder: "ä¾‹å¦‚ï¼šæŠ€è¡“æ¶æ§‹å¸«")
- âœ… è§’è‰²è¼¸å…¥æ¡† (å¿…å¡«, placeholder: "ä¾‹å¦‚ï¼šTechnical Architect")
- âœ… æè¿°æ–‡å­—å€åŸŸ (å¿…å¡«, min 10 å­—å…ƒ, placeholder: "è©³ç´°æè¿°æ­¤ Persona çš„å°ˆé•·...")
- âœ… èªè¨€é¸æ“‡ä¸‹æ‹‰é¸å–® (å¿…å¡«, é è¨­: ç¹é«”ä¸­æ–‡)
  - **é©—è­‰èƒŒæ™¯ç‚ºç™½è‰²**
- âœ… èªæ°£é¸æ“‡ä¸‹æ‹‰é¸å–® (å¿…å¡«, é è¨­: å°ˆæ¥­)
  - **é©—è­‰èƒŒæ™¯ç‚ºç™½è‰²**

**8.3 Tab 2: System Prompt**:
- âœ… å¤§å‹æ–‡å­—å€åŸŸ (min-h-[300px])
- âœ… å­—å…ƒè¨ˆæ•¸é¡¯ç¤º (å³ä¸‹è§’, "å·²è¼¸å…¥ XXX å­—å…ƒ")
- âœ… æœ€å°‘ 100 å­—å…ƒé©—è­‰
- âœ… Placeholder æä¾›æ’°å¯«æç¤º
- âœ… é¡¯ç¤ºæ’°å¯«æç¤ºæ¡† (è—è‰²èƒŒæ™¯)

**8.4 Tab 3: ç‰¹å¾µé…ç½®**:
- âœ… 3 å€‹æ¨™ç±¤ç®¡ç†å€åŸŸ:
  - é¢¨æ ¼æ¨™ç±¤ (style)
  - èƒ½åŠ›æ¨™ç±¤ (capabilities)
  - é™åˆ¶æ¨™ç±¤ (restrictions)
- âœ… æ¯å€‹å€åŸŸåŒ…å«:
  - è¼¸å…¥æ¡†
  - "+" æ–°å¢æŒ‰éˆ•
  - å·²æ–°å¢æ¨™ç±¤åˆ—è¡¨ (å¸¶ X åˆªé™¤æŒ‰éˆ•)
- âœ… æŒ‰ä¸‹ Enter éµå¯æ–°å¢æ¨™ç±¤
- âœ… æ¨™ç±¤æ¨£å¼:
  - style: è—è‰² (bg-blue-100 text-blue-800)
  - capabilities: ç¶ è‰² (bg-green-100 text-green-800)
  - restrictions: ç´…è‰² (bg-red-100 text-red-800)

**8.5 Tab 4: ç‰ˆæœ¬èˆ‡ç‹€æ…‹**:
- âœ… ç‰ˆæœ¬è™Ÿè¼¸å…¥æ¡† (é è¨­: "1.0.0")
- âœ… Semantic Versioning æ ¼å¼é©—è­‰ (X.Y.Z)
- âœ… ç‰ˆæœ¬æ§åˆ¶èªªæ˜æ¡† (ç°è‰²èƒŒæ™¯)
- âœ… å•Ÿç”¨ç‹€æ…‹é–‹é—œ (Switch, é è¨­: é–‹å•Ÿ)

**8.6 è¡¨å–®æ“ä½œ**:
- âœ… "å–æ¶ˆ" æŒ‰éˆ• (é—œé–‰å°è©±æ¡†)
- âœ… "å»ºç«‹ Persona" æŒ‰éˆ• (æäº¤è¡¨å–®)

**æ¸¬è©¦æ¡ˆä¾‹**:

**8.7 é©—è­‰éŒ¯èª¤æ¸¬è©¦**:
1. ç•™ç©ºåç¨±æ¬„ä½ï¼Œé»æ“Š "å»ºç«‹ Persona"
   - é æœŸ: é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ "è«‹å¡«å¯« Persona åç¨±"
2. è¼¸å…¥å°‘æ–¼ 10 å­—å…ƒçš„æè¿°
   - é æœŸ: é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ "æè¿°è‡³å°‘éœ€è¦ 10 å­—å…ƒ"
3. è¼¸å…¥å°‘æ–¼ 100 å­—å…ƒçš„ System Prompt
   - é æœŸ: é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ "System Prompt è‡³å°‘éœ€è¦ 100 å­—å…ƒ"
4. è¼¸å…¥ç„¡æ•ˆçš„ç‰ˆæœ¬è™Ÿ (ä¾‹å¦‚: "v1.0")
   - é æœŸ: é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ "ç‰ˆæœ¬è™Ÿæ ¼å¼éŒ¯èª¤ï¼Œè«‹ä½¿ç”¨ X.Y.Z æ ¼å¼"

**8.8 æˆåŠŸå»ºç«‹æ¸¬è©¦**:
1. å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ (åç¨±ã€è§’è‰²ã€æè¿°ã€systemPrompt)
2. é¸æ“‡èªè¨€å’Œèªæ°£
3. æ–°å¢å¹¾å€‹èƒ½åŠ›æ¨™ç±¤
4. è¨­å®šç‰ˆæœ¬è™Ÿç‚º "1.0.0"
5. é»æ“Š "å»ºç«‹ Persona"

é æœŸçµæœ:
- âœ… é¡¯ç¤ºæˆåŠŸè¨Šæ¯: "Persona å·²å»ºç«‹" (toast)
- âœ… å°è©±æ¡†é—œé–‰
- âœ… Persona åˆ—è¡¨è‡ªå‹•é‡æ–°è¼‰å…¥
- âœ… æ–°çš„ Persona å¡ç‰‡é¡¯ç¤ºåœ¨åˆ—è¡¨é ‚éƒ¨

---

### Test 9: ç·¨è¼¯ Persona

**æ­¥é©Ÿ**:
1. åœ¨ Persona å¡ç‰‡ä¸Šé»æ“Š "ç·¨è¼¯" æŒ‰éˆ•
2. è§€å¯Ÿå°è©±æ¡†é–‹å•Ÿ

**é æœŸçµæœ**:

**9.1 è¡¨å–®è¼‰å…¥**:
- âœ… æ¨™é¡Œ: "ç·¨è¼¯ Persona"
- âœ… æ‰€æœ‰æ¬„ä½å·²é å¡«å……ç¾æœ‰è³‡æ–™
- âœ… æ¨™ç±¤é™£åˆ—æ­£ç¢ºé¡¯ç¤º
- âœ… é–‹é—œç‹€æ…‹æ­£ç¢ºåæ˜  isActive

**9.2 ä¿®æ”¹æ¸¬è©¦**:
1. ä¿®æ”¹è§’è‰²ç‚º "Senior Technical Architect"
2. ä¿®æ”¹ç‰ˆæœ¬è™Ÿç‚º "1.1.0"
3. æ–°å¢ä¸€å€‹èƒ½åŠ›æ¨™ç±¤
4. é»æ“Š "å„²å­˜è®Šæ›´" æŒ‰éˆ•

é æœŸçµæœ:
- âœ… é¡¯ç¤ºæˆåŠŸè¨Šæ¯: "Persona å·²æ›´æ–°" (toast)
- âœ… å°è©±æ¡†é—œé–‰
- âœ… Persona å¡ç‰‡é¡¯ç¤ºæ›´æ–°å¾Œçš„è³‡è¨Š
- âœ… ç‰ˆæœ¬è™Ÿé¡¯ç¤ºç‚º "v1.1.0"

---

### Test 10: æœå°‹èˆ‡ç¯©é¸åŠŸèƒ½

**æ¸¬è©¦æ¡ˆä¾‹**:

**10.1 æœå°‹æ¸¬è©¦**:
1. åœ¨æœå°‹æ¡†è¼¸å…¥ "æ¶æ§‹å¸«"
2. è§€å¯Ÿåˆ—è¡¨è®ŠåŒ–

é æœŸçµæœ:
- âœ… åªé¡¯ç¤ºåç¨±ã€è§’è‰²æˆ–æè¿°åŒ…å« "æ¶æ§‹å¸«" çš„ Persona
- âœ… ä¸ç¬¦åˆçš„å¡ç‰‡éš±è—
- âœ… çµ±è¨ˆå¡ç‰‡æ•¸é‡ä¸è®Š (é¡¯ç¤ºç¸½æ•¸ï¼Œä¸æ˜¯ç¯©é¸å¾Œçš„æ•¸é‡)

**10.2 èªè¨€ç¯©é¸æ¸¬è©¦**:
1. é¸æ“‡èªè¨€ç¯©é¸: "ç¹é«”ä¸­æ–‡"
2. è§€å¯Ÿåˆ—è¡¨è®ŠåŒ–

é æœŸçµæœ:
- âœ… åªé¡¯ç¤º language ç‚º "zh-TW" çš„ Persona
- âœ… å…¶ä»–èªè¨€çš„ Persona éš±è—
- âœ… **ä¸‹æ‹‰é¸å–®èƒŒæ™¯ç‚ºç™½è‰²**

**10.3 ç‹€æ…‹ç¯©é¸æ¸¬è©¦**:
1. é¸æ“‡ç‹€æ…‹ç¯©é¸: "åœç”¨"
2. è§€å¯Ÿåˆ—è¡¨è®ŠåŒ–

é æœŸçµæœ:
- âœ… åªé¡¯ç¤º isActive ç‚º false çš„ Persona
- âœ… å•Ÿç”¨çš„ Persona éš±è—
- âœ… **ä¸‹æ‹‰é¸å–®èƒŒæ™¯ç‚ºç™½è‰²**

**10.4 çµ„åˆç¯©é¸æ¸¬è©¦**:
1. æœå°‹: "é¡§å•"
2. èªè¨€: "ç¹é«”ä¸­æ–‡"
3. ç‹€æ…‹: "å•Ÿç”¨"

é æœŸçµæœ:
- âœ… åªé¡¯ç¤ºåŒæ™‚ç¬¦åˆä¸‰å€‹æ¢ä»¶çš„ Persona
- âœ… å¦‚æœæ²’æœ‰çµæœï¼Œé¡¯ç¤ºç©ºç‹€æ…‹è¨Šæ¯

---

### Test 11: åˆªé™¤ Persona (é—œéµæ¸¬è©¦ï¼)

**æ¡ˆä¾‹ 11.1: åˆªé™¤æ²’æœ‰é—œè¯ Agent çš„ Persona (æˆåŠŸ)**

**å‰ç½®æ¢ä»¶**:
- ç¢ºä¿è©² Persona æ²’æœ‰è¢«ä»»ä½• Agent ä½¿ç”¨

**æ­¥é©Ÿ**:
1. é»æ“Š Persona å¡ç‰‡ä¸Šçš„ "åˆªé™¤" æŒ‰éˆ• (ç´…è‰²)
2. è§€å¯Ÿåˆªé™¤æŒ‰éˆ•ç‹€æ…‹: æ‡‰è©²æ˜¯**å•Ÿç”¨**çš„

**é æœŸçµæœ**:

**11.1.1 ç¢ºèªå°è©±æ¡†é¡¯ç¤º**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸  ç¢ºèªåˆªé™¤                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¢ºå®šè¦åˆªé™¤ Persona "æŠ€è¡“æ¶æ§‹å¸«" å—ï¼Ÿ â”‚
â”‚                                     â”‚
â”‚ æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚                     â”‚
â”‚                                     â”‚
â”‚  [å–æ¶ˆ]    [ç¢ºèªåˆªé™¤]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**11.1.2 é»æ“Š "ç¢ºèªåˆªé™¤"**:
- âœ… é¡¯ç¤ºæˆåŠŸè¨Šæ¯: "Persona å·²åˆªé™¤" (toast)
- âœ… å°è©±æ¡†é—œé–‰
- âœ… Persona å¡ç‰‡å¾åˆ—è¡¨ä¸­ç§»é™¤
- âœ… çµ±è¨ˆå¡ç‰‡æ•¸é‡æ›´æ–° (Persona ç¸½æ•¸ -1)

---

**æ¡ˆä¾‹ 11.2: åˆªé™¤æœ‰é—œè¯ Agent çš„ Persona (å¤±æ•— - æœ€é‡è¦çš„æ¸¬è©¦ï¼)**

**å‰ç½®æ¢ä»¶**:
1. å»ºç«‹ä¸€å€‹æ–°çš„ Persona (ä¾‹å¦‚: "å•†å‹™é¡§å•")
2. å‰å¾€ Agent Market é é¢ (`/agents`)
3. å»ºç«‹ä¸€å€‹æ–°çš„ Agentï¼Œé¸æ“‡å‰›æ‰å»ºç«‹çš„ Persona
4. å›åˆ° Persona åˆ—è¡¨é é¢

**æ­¥é©Ÿ**:
1. æ‰¾åˆ°è©² Persona çš„å¡ç‰‡
2. è§€å¯Ÿå¡ç‰‡åº•éƒ¨çš„ "ğŸ¤– X å€‹ Agent" é¡¯ç¤º (æ‡‰è©²é¡¯ç¤º "1 å€‹ Agent" æˆ–æ›´å¤š)
3. è§€å¯Ÿ "åˆªé™¤" æŒ‰éˆ•ç‹€æ…‹

**é æœŸçµæœ**:

**11.2.1 åˆªé™¤æŒ‰éˆ•ç‹€æ…‹**:
- âœ… åˆªé™¤æŒ‰éˆ•æ‡‰è©²æ˜¯**ç¦ç”¨**ç‹€æ…‹ (ç°è‰², ç„¡æ³•é»æ“Š)
- âœ… æ»‘é¼ æ‡¸åœåœ¨æŒ‰éˆ•ä¸Šæ™‚ï¼Œé¡¯ç¤º tooltip: "æ­¤ Persona è¢« X å€‹ Agent ä½¿ç”¨ï¼Œç„¡æ³•åˆªé™¤"

**11.2.2 å˜—è©¦é»æ“Šåˆªé™¤æŒ‰éˆ•**:
- âœ… æŒ‰éˆ•ç„¡åæ‡‰ (å› ç‚º disabled)
- âœ… ä¸æœƒé–‹å•Ÿä»»ä½•å°è©±æ¡†

**é‡è¦**: å¦‚æœåˆªé™¤æŒ‰éˆ•ä»ç„¶å¯ä»¥é»æ“Šï¼Œé€™æ˜¯ä¸€å€‹åš´é‡çš„ BUGï¼

---

**æ¡ˆä¾‹ 11.3: åˆªé™¤æœ‰é—œè¯ Agent çš„ Persona - å¾Œç«¯é©—è­‰æ¸¬è©¦**

**ç›®çš„**: æ¸¬è©¦å³ä½¿å‰ç«¯é©—è­‰è¢«ç¹éï¼Œå¾Œç«¯ API ä»èƒ½é˜»æ­¢åˆªé™¤

**æ­¥é©Ÿ**:
1. ä½¿ç”¨ curl æˆ– Postman ç›´æ¥å‘¼å« DELETE API
2. æä¾›ä¸€å€‹æœ‰é—œè¯ Agent çš„ Persona ID

```bash
curl -X DELETE http://localhost:3002/api/personas/cm456def789
```

**é æœŸçµæœ** (status: 400):
```json
{
  "success": false,
  "error": {
    "code": "PERSONA_IN_USE",
    "message": "æ­¤ Persona æ­£è¢«ä½¿ç”¨ï¼Œç„¡æ³•åˆªé™¤",
    "details": {
      "linkedAgents": [
        {
          "id": "agent123",
          "name": "å•†å‹™åŠ©æ‰‹",
          "category": "å•†å‹™",
          "isActive": true
        }
      ],
      "agentCount": 1
    }
  }
}
```

**é©—è­‰é»**:
- âœ… API å›å‚³ 400 éŒ¯èª¤
- âœ… error.code ç‚º "PERSONA_IN_USE"
- âœ… error.details åŒ…å«å®Œæ•´çš„ linkedAgents åˆ—è¡¨
- âœ… Persona ä»ç„¶å­˜åœ¨æ–¼è³‡æ–™åº«ä¸­

---

### Test 12: AgentEditor æ•´åˆæ¸¬è©¦

**æ­¥é©Ÿ**:
1. å‰å¾€ Agent Market é é¢ (`http://localhost:3002/zh-TW/agents`)
2. é»æ“Š "+ æ–°å¢ Agent" æŒ‰éˆ• æˆ– ç·¨è¼¯ç¾æœ‰ Agent
3. è§€å¯Ÿ Persona é¸æ“‡å€åŸŸ

**é æœŸçµæœ**:

**12.1 Persona ä¸‹æ‹‰é¸å–®è¼‰å…¥**:
- âœ… å°è©±æ¡†é–‹å•Ÿæ™‚ï¼Œè‡ªå‹•è¼‰å…¥ Persona åˆ—è¡¨
- âœ… é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹: "è¼‰å…¥ Persona åˆ—è¡¨..." (0.5-1 ç§’)
- âœ… è¼‰å…¥å®Œæˆå¾Œï¼Œé¡¯ç¤º Persona é¸æ“‡ä¸‹æ‹‰é¸å–®
- âœ… **ä¸‹æ‹‰é¸å–®èƒŒæ™¯ç‚ºç™½è‰²ï¼Œä¸é€æ˜**

**12.2 Persona é¸é …é¡¯ç¤º**:
æ¯å€‹é¸é …åŒ…å«å…©è¡Œ:
```
æŠ€è¡“æ¶æ§‹å¸«
Technical Architect â€¢ zh-TW
```

**é©—è­‰é»**:
- âœ… ç¬¬ä¸€è¡Œ: Persona åç¨± (font-medium)
- âœ… ç¬¬äºŒè¡Œ: è§’è‰² â€¢ èªè¨€ (text-xs text-gray-500)
- âœ… é¸é …ä¸å†æ˜¯ç¡¬ç·¨ç¢¼çš„ "CDO å•†å‹™é¡§å•" å’Œ "æŠ€è¡“é¡§å•"

**12.3 é¸æ“‡ Persona**:
1. é»æ“Šä¸‹æ‹‰é¸å–®
2. é¸æ“‡ä¸€å€‹ Persona (ä¾‹å¦‚: "æŠ€è¡“æ¶æ§‹å¸«")

é æœŸçµæœ:
- âœ… ä¸‹æ‹‰é¸å–®é¡¯ç¤ºé¸ä¸­çš„ Persona åç¨±
- âœ… è—è‰²è³‡è¨Šæ¡†é¡¯ç¤ºé¸ä¸­ Persona çš„è©³ç´°è³‡è¨Š:
  ```
  å·²é¸æ“‡ Personaï¼šæŠ€è¡“æ¶æ§‹å¸«
  è§’è‰²ï¼šTechnical Architect
  èªè¨€ï¼šç¹é«”ä¸­æ–‡ | èªæ°£ï¼šå°ˆæ¥­
  ```

**12.4 å„²å­˜ Agent**:
1. å¡«å¯« Agent çš„å…¶ä»–å¿…å¡«æ¬„ä½
2. é»æ“Š "å»ºç«‹ Agent" æˆ– "å„²å­˜è®Šæ›´"

é æœŸçµæœ:
- âœ… Agent æˆåŠŸå»ºç«‹/æ›´æ–°
- âœ… personaId æ¬„ä½æ­£ç¢ºå„²å­˜åˆ°è³‡æ–™åº«
- âœ… Agent å¡ç‰‡é¡¯ç¤ºåœ¨åˆ—è¡¨ä¸­

---

## ğŸ”„ æ•´åˆæ¸¬è©¦æµç¨‹

### Test 13: å®Œæ•´ Persona â†’ Agent â†’ Delete å·¥ä½œæµç¨‹

**ç›®çš„**: æ¸¬è©¦å®Œæ•´çš„ CRUD ç”Ÿå‘½é€±æœŸå’Œåˆªé™¤é©—è­‰

**æ­¥é©Ÿ**:

**13.1 å»ºç«‹ Persona**:
1. å‰å¾€ `/knowledge/persona`
2. é»æ“Š "+ æ–°å¢ Persona"
3. å¡«å¯«è¡¨å–®:
   - åç¨±: "æ¸¬è©¦ Persona"
   - è§’è‰²: "Test Role"
   - æè¿°: "é€™æ˜¯ä¸€å€‹æ¸¬è©¦ç”¨çš„ Persona æè¿°è‡³å°‘åå€‹å­—å…ƒ"
   - System Prompt: (è‡³å°‘ 100 å­—å…ƒ)
   - èªè¨€: ç¹é«”ä¸­æ–‡
   - èªæ°£: å‹å–„
4. å»ºç«‹æˆåŠŸ

**é©—è­‰é»**:
- âœ… Persona å¡ç‰‡é¡¯ç¤ºåœ¨åˆ—è¡¨ä¸­
- âœ… "ğŸ¤– 0 å€‹ Agent" é¡¯ç¤º
- âœ… åˆªé™¤æŒ‰éˆ•æ˜¯**å•Ÿç”¨**çš„

---

**13.2 å»ºç«‹ Agent ä¸¦ç¶å®š Persona**:
1. å‰å¾€ `/agents`
2. é»æ“Š "+ æ–°å¢ Agent"
3. å¡«å¯«è¡¨å–®:
   - åç¨±: "æ¸¬è©¦ Agent"
   - æè¿°: "æ¸¬è©¦ç”¨ Agent"
   - é¡åˆ¥: é¸æ“‡ä¸€å€‹é¡åˆ¥
   - **Persona: é¸æ“‡ "æ¸¬è©¦ Persona"**
4. å»ºç«‹æˆåŠŸ

**é©—è­‰é»**:
- âœ… Agent å¡ç‰‡é¡¯ç¤ºåœ¨åˆ—è¡¨ä¸­
- âœ… å¯ä»¥åœ¨ Agent è©³æƒ…ä¸­çœ‹åˆ°ç¶å®šçš„ Persona

---

**13.3 å›åˆ° Persona åˆ—è¡¨ï¼Œé©—è­‰é—œè¯**:
1. å›åˆ° `/knowledge/persona`
2. æ‰¾åˆ° "æ¸¬è©¦ Persona" å¡ç‰‡

**é æœŸè®ŠåŒ–**:
- âœ… "ğŸ¤– 1 å€‹ Agent" é¡¯ç¤º (å¾ 0 æ›´æ–°ç‚º 1)
- âœ… åˆªé™¤æŒ‰éˆ•è®Šç‚º**ç¦ç”¨**ç‹€æ…‹ (ç°è‰²)
- âœ… æ»‘é¼ æ‡¸åœé¡¯ç¤º: "æ­¤ Persona è¢« 1 å€‹ Agent ä½¿ç”¨ï¼Œç„¡æ³•åˆªé™¤"

---

**13.4 å˜—è©¦åˆªé™¤æœ‰é—œè¯çš„ Persona**:
1. é»æ“Šåˆªé™¤æŒ‰éˆ•

**é æœŸçµæœ**:
- âœ… æŒ‰éˆ•ç„¡åæ‡‰ (å› ç‚º disabled)
- âœ… ä¸æœƒé–‹å•Ÿä»»ä½•å°è©±æ¡†

---

**13.5 åˆªé™¤ Agent**:
1. å›åˆ° `/agents`
2. æ‰¾åˆ° "æ¸¬è©¦ Agent"
3. é»æ“Šåˆªé™¤æŒ‰éˆ•
4. ç¢ºèªåˆªé™¤

**é©—è­‰é»**:
- âœ… Agent å¾åˆ—è¡¨ä¸­ç§»é™¤
- âœ… åˆªé™¤æˆåŠŸè¨Šæ¯é¡¯ç¤º

---

**13.6 å›åˆ° Persona åˆ—è¡¨ï¼Œé©—è­‰è§£é™¤é—œè¯**:
1. å›åˆ° `/knowledge/persona`
2. æ‰¾åˆ° "æ¸¬è©¦ Persona" å¡ç‰‡

**é æœŸè®ŠåŒ–**:
- âœ… "ğŸ¤– 0 å€‹ Agent" é¡¯ç¤º (å¾ 1 æ›´æ–°å› 0)
- âœ… åˆªé™¤æŒ‰éˆ•è®Šç‚º**å•Ÿç”¨**ç‹€æ…‹ (ç´…è‰²)
- âœ… å¯ä»¥æ­£å¸¸é»æ“Š

---

**13.7 æˆåŠŸåˆªé™¤ Persona**:
1. é»æ“Šåˆªé™¤æŒ‰éˆ•
2. ç¢ºèªå°è©±æ¡†é¡¯ç¤º
3. é»æ“Š "ç¢ºèªåˆªé™¤"

**é æœŸçµæœ**:
- âœ… åˆªé™¤æˆåŠŸè¨Šæ¯é¡¯ç¤º
- âœ… "æ¸¬è©¦ Persona" å¡ç‰‡å¾åˆ—è¡¨ä¸­ç§»é™¤
- âœ… çµ±è¨ˆå¡ç‰‡æ•¸é‡æ›´æ–°

---

## ğŸ“Š é æœŸè¡Œç‚ºç¸½çµ

### Console æ—¥èªŒæª¢æŸ¥

åœ¨æ¸¬è©¦éç¨‹ä¸­ï¼Œé–‹å•Ÿç€è¦½å™¨é–‹ç™¼è€…å·¥å…· (F12)ï¼Œæª¢æŸ¥ Console æ˜¯å¦æœ‰ä»¥ä¸‹æ—¥èªŒ:

**æ­£å¸¸æƒ…æ³**:
```
[PersonaPage] è¼‰å…¥ Personas ä¸­...
[PersonaPage] æˆåŠŸè¼‰å…¥ 3 å€‹ Personas
[PersonaPage] çµ±è¨ˆè³‡æ–™: {totalPersonas: 3, totalLinkedAgents: 2, languages: 2, activePersonas: 3}

[AgentEditor] è¼‰å…¥ Personas...
[AgentEditor] æˆåŠŸè¼‰å…¥ 3 å€‹ Personas
```

**éŒ¯èª¤æƒ…æ³**:
```
âŒ [PersonaPage Error] è¼‰å…¥ Personas å¤±æ•—: NetworkError
âŒ [API Error] POST /api/personas: Validation failed
âŒ [API Error] DELETE /api/personas/cm123: PERSONA_IN_USE
```

---

### è¦–è¦ºæŒ‡æ¨™æª¢æŸ¥

**æˆåŠŸç‹€æ…‹**:
- âœ… Toast é€šçŸ¥: ç¶ è‰²èƒŒæ™¯, ç™½è‰²æ–‡å­—, âœ“ åœ–ç¤º
- âœ… å•Ÿç”¨ Badge: è—è‰²èƒŒæ™¯, ç™½è‰²æ–‡å­—, CheckCircle åœ–ç¤º
- âœ… æŒ‰éˆ• hover: é‚Šæ¡†é¡è‰²è®ŠåŒ–, é™°å½±å¢å¼·

**éŒ¯èª¤ç‹€æ…‹**:
- âŒ Toast é€šçŸ¥: ç´…è‰²èƒŒæ™¯, ç™½è‰²æ–‡å­—, âœ— åœ–ç¤º
- âŒ åœç”¨ Badge: ç°è‰²èƒŒæ™¯, ç°è‰²æ–‡å­—, XCircle åœ–ç¤º
- âŒ ç¦ç”¨æŒ‰éˆ•: ç°è‰², ç„¡ hover æ•ˆæœ, cursor: not-allowed

**è¼‰å…¥ç‹€æ…‹**:
- â³ Spinner å‹•ç•«
- â³ æŒ‰éˆ•é¡¯ç¤º "è¼‰å…¥ä¸­..." æˆ– Spinner
- â³ éª¨æ¶å± (å¦‚æœå¯¦ä½œ)

---

### æ•ˆèƒ½æŒ‡æ¨™

**é é¢è¼‰å…¥**:
- âœ… åˆå§‹è¼‰å…¥æ™‚é–“: < 1 ç§’
- âœ… Persona åˆ—è¡¨è¼‰å…¥: < 500ms (10 å€‹ä»¥å…§)
- âœ… çµ±è¨ˆè³‡æ–™è¨ˆç®—: < 100ms

**äº’å‹•å›æ‡‰**:
- âœ… æœå°‹ç¯©é¸: å³æ™‚åæ‡‰ (< 100ms)
- âœ… å°è©±æ¡†é–‹å•Ÿ: < 200ms
- âœ… è¡¨å–®æäº¤: < 1 ç§’

**API å›æ‡‰æ™‚é–“**:
- âœ… GET /api/personas: < 300ms
- âœ… POST /api/personas: < 500ms
- âœ… PUT /api/personas/[id]: < 500ms
- âœ… DELETE /api/personas/[id]: < 300ms

---

## âš ï¸ å¸¸è¦‹å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

### Issue 1: Selection èƒŒæ™¯é€æ˜

**ç—‡ç‹€**: ä¸‹æ‹‰é¸å–®é¸é …èƒŒæ™¯æ˜¯é€æ˜çš„ï¼Œç„¡æ³•çœ‹æ¸…æ–‡å­—

**æª¢æŸ¥é»**:
```typescript
// ç¢ºèª SelectTrigger æœ‰ bg-white
<SelectTrigger className="bg-white">

// ç¢ºèª SelectContent æœ‰ bg-white
<SelectContent className="bg-white">
```

**ä½ç½®**:
- `components/knowledge/PersonaForm.tsx`: Line 280, 283, 294, 297
- `app/[locale]/(dashboard)/knowledge/persona/page.tsx`: Line 310, 313, 322, 325
- `components/agents/AgentEditor.tsx`: Line 425, 428

---

### Issue 2: åˆªé™¤æŒ‰éˆ•æ²’æœ‰æ­£ç¢ºç¦ç”¨

**ç—‡ç‹€**: å³ä½¿ Persona æœ‰é—œè¯ Agentï¼Œåˆªé™¤æŒ‰éˆ•ä»å¯é»æ“Š

**æª¢æŸ¥é»**:
```typescript
// PersonaCard.tsx
const agentCount = persona._count?.agents || persona.agents?.length || 0
const hasLinkedAgents = agentCount > 0

// åˆªé™¤æŒ‰éˆ•
<Button
  variant="destructive"
  onClick={() => onDelete(persona)}
  disabled={hasLinkedAgents}  // é‡è¦ï¼
  title={hasLinkedAgents ? `æ­¤ Persona è¢« ${agentCount} å€‹ Agent ä½¿ç”¨ï¼Œç„¡æ³•åˆªé™¤` : ''}
>
```

**é©—è­‰**:
- åœ¨ Persona åˆ—è¡¨é é¢ï¼Œæª¢æŸ¥ `personas` state æ˜¯å¦åŒ…å« `_count.agents` æˆ– `agents` é™£åˆ—
- ç¢ºèª `loadPersonas()` å‡½æ•¸æœ‰å‘¼å« `/api/personas/[id]/agents` ä¾†å–å¾—é—œè¯æ•¸é‡

---

### Issue 3: AgentEditor é¡¯ç¤ºèˆŠçš„ç¡¬ç·¨ç¢¼ Persona

**ç—‡ç‹€**: Persona ä¸‹æ‹‰é¸å–®ä»é¡¯ç¤º "CDO å•†å‹™é¡§å•" å’Œ "æŠ€è¡“é¡§å•"

**è§£æ±ºæ–¹æ¡ˆ**:
ç¢ºèª `components/agents/AgentEditor.tsx` å·²æ›´æ–°:
```typescript
// æ‡‰è©²çœ‹åˆ°é€™äº›
const [availablePersonas, setAvailablePersonas] = useState<Persona[]>([])
const loadPersonas = async () => { /* ... */ }

// ä¸æ‡‰è©²çœ‹åˆ°é€™äº› (èˆŠçš„ç¡¬ç·¨ç¢¼)
<SelectItem value="commercial-advisor">CDO å•†å‹™é¡§å•</SelectItem>
<SelectItem value="technical-advisor">æŠ€è¡“é¡§å•</SelectItem>
```

---

### Issue 4: Toast é€šçŸ¥æ²’æœ‰é¡¯ç¤º

**ç—‡ç‹€**: æ“ä½œæˆåŠŸ/å¤±æ•—å¾Œï¼Œæ²’æœ‰é¡¯ç¤ºé€šçŸ¥è¨Šæ¯

**æª¢æŸ¥é»**:
1. ç¢ºèª `app/layout.tsx` æœ‰åŒ…å« `<Toaster />`:
```typescript
import { Toaster } from 'sonner'

export default function RootLayout() {
  return (
    <html>
      <body>
        {children}
        <Toaster />  {/* é‡è¦ï¼ */}
      </body>
    </html>
  )
}
```

2. ç¢ºèªæœ‰æ­£ç¢ºå°å…¥ `toast`:
```typescript
import { toast } from 'sonner'

// ä½¿ç”¨
toast.success('æ“ä½œæˆåŠŸ')
toast.error('æ“ä½œå¤±æ•—')
```

---

## âœ… æ¸¬è©¦å®Œæˆæª¢æŸ¥æ¸…å–®

å®Œæˆæ‰€æœ‰æ¸¬è©¦å¾Œï¼Œç¢ºèªä»¥ä¸‹é …ç›®:

### API æ¸¬è©¦
- [ ] POST /api/personas - å»ºç«‹æˆåŠŸ
- [ ] POST /api/personas - é©—è­‰å¤±æ•— (ç¼ºå°‘æ¬„ä½)
- [ ] GET /api/personas - å–å¾—åˆ—è¡¨
- [ ] GET /api/personas/[id] - å–å¾—å–®ä¸€ Persona
- [ ] GET /api/personas/[id] - 404 éŒ¯èª¤ (ä¸å­˜åœ¨çš„ ID)
- [ ] PUT /api/personas/[id] - æ›´æ–°æˆåŠŸ
- [ ] DELETE /api/personas/[id] - åˆªé™¤æˆåŠŸ (ç„¡é—œè¯)
- [ ] DELETE /api/personas/[id] - åˆªé™¤å¤±æ•— (æœ‰é—œè¯)
- [ ] GET /api/personas/[id]/agents - å–å¾—é—œè¯ Agents

### UI åŠŸèƒ½æ¸¬è©¦
- [ ] Persona åˆ—è¡¨é é¢æ­£ç¢ºé¡¯ç¤º
- [ ] çµ±è¨ˆå¡ç‰‡æ­£ç¢ºè¨ˆç®—
- [ ] æœå°‹åŠŸèƒ½é‹ä½œæ­£å¸¸
- [ ] èªè¨€ç¯©é¸é‹ä½œæ­£å¸¸
- [ ] ç‹€æ…‹ç¯©é¸é‹ä½œæ­£å¸¸
- [ ] æ–°å¢ Persona è¡¨å–®é‹ä½œæ­£å¸¸
- [ ] ç·¨è¼¯ Persona è¡¨å–®é‹ä½œæ­£å¸¸
- [ ] åˆªé™¤ Persona (ç„¡é—œè¯) é‹ä½œæ­£å¸¸
- [ ] åˆªé™¤æŒ‰éˆ•æ­£ç¢ºç¦ç”¨ (æœ‰é—œè¯)
- [ ] AgentEditor Persona é¸æ“‡é‹ä½œæ­£å¸¸

### è¦–è¦ºæ¸¬è©¦
- [ ] æ‰€æœ‰ Selection èƒŒæ™¯ç‚ºç™½è‰²ï¼Œä¸é€æ˜
- [ ] æŒ‰éˆ• hover æ•ˆæœæ­£å¸¸
- [ ] Toast é€šçŸ¥æ­£å¸¸é¡¯ç¤º
- [ ] è¼‰å…¥ç‹€æ…‹æ­£ç¢ºé¡¯ç¤º
- [ ] ç©ºç‹€æ…‹æ­£ç¢ºé¡¯ç¤º

### æ•´åˆæ¸¬è©¦
- [ ] å®Œæ•´å·¥ä½œæµç¨‹: å»ºç«‹ Persona â†’ å»ºç«‹ Agent â†’ åˆªé™¤é©—è­‰ â†’ åˆªé™¤ Agent â†’ åˆªé™¤ Persona

---

## ğŸ“ æ¸¬è©¦å ±å‘Šç¯„æœ¬

æ¸¬è©¦å®Œæˆå¾Œï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç¯„æœ¬è¨˜éŒ„çµæœ:

```markdown
# Persona Management System æ¸¬è©¦å ±å‘Š

**æ¸¬è©¦æ—¥æœŸ**: 2025-10-23
**æ¸¬è©¦äººå“¡**: [Your Name]
**æ¸¬è©¦ç’°å¢ƒ**: Windows 11, Chrome 120, Node.js 20.x

## æ¸¬è©¦çµæœç¸½è¦½

- âœ… é€šé: XX é …
- âŒ å¤±æ•—: XX é …
- âš ï¸ éƒ¨åˆ†é€šé: XX é …

## API æ¸¬è©¦çµæœ

| ç«¯é» | ç‹€æ…‹ | å‚™è¨» |
|------|------|------|
| POST /api/personas | âœ… | å»ºç«‹æˆåŠŸ |
| GET /api/personas | âœ… | å›å‚³ 3 å€‹ Personas |
| DELETE /api/personas/[id] (æœ‰é—œè¯) | âœ… | æ­£ç¢ºé˜»æ­¢åˆªé™¤ |

## UI æ¸¬è©¦çµæœ

| åŠŸèƒ½ | ç‹€æ…‹ | å‚™è¨» |
|------|------|------|
| Persona åˆ—è¡¨é¡¯ç¤º | âœ… | å¡ç‰‡æ­£ç¢ºæ¸²æŸ“ |
| Selection èƒŒæ™¯ | âœ… | æ‰€æœ‰ä¸‹æ‹‰é¸å–®èƒŒæ™¯ç‚ºç™½è‰² |
| åˆªé™¤æŒ‰éˆ•ç¦ç”¨ | âœ… | æœ‰é—œè¯æ™‚æ­£ç¢ºç¦ç”¨ |

## ç™¼ç¾çš„å•é¡Œ

1. **[å•é¡Œæè¿°]**
   - åš´é‡ç¨‹åº¦: é«˜/ä¸­/ä½
   - é‡ç¾æ­¥é©Ÿ: [...]
   - é æœŸè¡Œç‚º: [...]
   - å¯¦éš›è¡Œç‚º: [...]

## å»ºè­°æ”¹é€²

1. [æ”¹é€²å»ºè­° 1]
2. [æ”¹é€²å»ºè­° 2]
```

---

## ğŸ¯ ç¸½çµ

æœ¬æ¸¬è©¦æŒ‡å—æ¶µè“‹äº† Persona ç®¡ç†ç³»çµ±çš„æ‰€æœ‰é—œéµåŠŸèƒ½:

1. **å®Œæ•´çš„ CRUD æ“ä½œ**: å»ºç«‹ã€è®€å–ã€æ›´æ–°ã€åˆªé™¤
2. **åˆªé™¤é©—è­‰é‚è¼¯**: å‰ç«¯ + å¾Œç«¯é›™é‡ä¿è­·
3. **Agent-Persona ç¶å®šé—œä¿‚**: å¤–éµç´„æŸæ­£ç¢ºé‹ä½œ
4. **UI äº’å‹•é«”é©—**: æœå°‹ã€ç¯©é¸ã€è¡¨å–®é©—è­‰
5. **è¦–è¦ºå“è³ª**: Selection èƒŒæ™¯ã€æŒ‰éˆ•ç‹€æ…‹ã€é€šçŸ¥è¨Šæ¯

è«‹ä¾ç…§æœ¬æŒ‡å—é€é …æ¸¬è©¦ï¼Œç¢ºä¿ç³»çµ±é‹ä½œæ­£å¸¸ã€‚å¦‚æœ‰ä»»ä½•å•é¡Œï¼Œè«‹åƒè€ƒã€Œå¸¸è¦‹å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆã€ç« ç¯€ã€‚

**é‡è¦æé†’**: åˆªé™¤é©—è­‰é‚è¼¯æ˜¯æœ€é—œéµçš„æ¸¬è©¦é …ç›®ï¼å¿…é ˆç¢ºä¿æœ‰é—œè¯ Agent çš„ Persona ç„¡æ³•è¢«åˆªé™¤ã€‚
