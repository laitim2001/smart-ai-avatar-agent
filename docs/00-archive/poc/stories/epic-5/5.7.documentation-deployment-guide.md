# Story 5.7: 使用文件與部署指南

**Epic**: Epic 5 - Polish & Deployment
**Story ID**: 5.7
**Story 名稱**: 使用文件與部署指南
**優先順序**: High
**預估時間**: 6 小時
**狀態**: Draft

---

## 📋 Story 描述

### User Story
**As a** 開發者、維運人員、使用者
**I want** 完整的文件（使用手冊、API 文件、部署指南、故障排除）
**So that** 可以快速上手應用程式、獨立部署、解決常見問題，無需依賴原始開發團隊

### Business Value
- **知識移轉**: 新團隊成員可快速上手，減少 onboarding 時間
- **維運獨立性**: 維運團隊可獨立部署與排除故障
- **使用者自助**: 使用者可自行查閱文件解決問題，減少支援成本
- **專案可持續性**: 即使原始團隊離開，專案仍可持續維護

### Technical Context
- **文件類型**: User Guide, API Reference, Deployment Guide, Troubleshooting
- **文件格式**: Markdown (可轉換為 PDF/HTML)
- **目標受眾**: 開發者、維運人員、一般使用者
- **維護策略**: 文件與程式碼同步更新

---

## ✅ Acceptance Criteria

### Functional Requirements
1. **使用者手冊 (User Guide)**:
   - [ ] 應用程式功能說明
   - [ ] 操作步驟圖文教學
   - [ ] 常見問題 FAQ
   - [ ] 瀏覽器相容性說明

2. **API 文件 (API Reference)**:
   - [ ] Azure TTS API 使用說明
   - [ ] 內部 API endpoint 文件
   - [ ] 請求/回應範例
   - [ ] 錯誤碼說明

3. **部署指南 (Deployment Guide)**:
   - [ ] Azure Static Web Apps 部署步驟
   - [ ] 環境變數設定
   - [ ] CI/CD pipeline 說明
   - [ ] 回滾與故障恢復

4. **故障排除 (Troubleshooting Guide)**:
   - [ ] 常見問題與解決方案
   - [ ] 錯誤訊息對照表
   - [ ] Debug 技巧
   - [ ] 聯絡支援管道

### Non-Functional Requirements
1. **完整性**: 涵蓋所有核心功能與操作
2. **可讀性**: 非技術人員也能理解使用者手冊
3. **可維護性**: 文件結構清晰，易於更新
4. **可搜尋性**: 使用明確標題與關鍵字

---

## 🏗️ Technical Design

### 文件結構

```
docs/
├── user-guide/
│   ├── getting-started.md          # 快速開始
│   ├── features.md                 # 功能說明
│   ├── faq.md                      # 常見問題
│   └── browser-compatibility.md    # 瀏覽器支援
│
├── api-reference/
│   ├── azure-tts-api.md            # Azure TTS API
│   ├── internal-api.md             # 內部 API
│   └── error-codes.md              # 錯誤碼
│
├── deployment/
│   ├── azure-static-web-apps.md    # Azure 部署
│   ├── environment-variables.md    # 環境變數
│   ├── ci-cd-pipeline.md           # CI/CD
│   └── rollback-recovery.md        # 回滾恢復
│
├── troubleshooting/
│   ├── common-issues.md            # 常見問題
│   ├── error-messages.md           # 錯誤訊息
│   ├── debug-guide.md              # Debug 指南
│   └── support.md                  # 聯絡支援
│
├── architecture/
│   ├── system-overview.md          # 系統概覽
│   ├── technology-stack.md         # 技術棧
│   └── security.md                 # 安全性
│
└── README.md                       # 專案總覽
```

### 文件撰寫原則

**KISS (Keep It Simple, Stupid)**:
- 使用簡單語言，避免術語過載
- 一個概念一個段落
- 使用步驟化說明（1, 2, 3）

**Visual First**:
- 截圖 > 文字描述
- 流程圖 > 長段文字
- 程式碼範例 > 抽象說明

**User-Centric**:
- 以使用者目標為導向（"如何..."）
- 提供實際使用情境
- 包含預期結果

---

## 📝 Tasks

### Task 1: 撰寫使用者快速開始指南

**描述**: 撰寫新使用者的快速上手指南

**檔案**: `docs/user-guide/getting-started.md`

**程式碼實作**:
```markdown
# Smart AI Avatar Agent - 快速開始指南

歡迎使用 Smart AI Avatar Agent！本指南將帶您快速體驗 3D Avatar 與語音對話功能。

---

## 🎯 5 分鐘快速體驗

### Step 1: 開啟應用程式

**Production URL**: https://smart-ai-avatar.azurestaticapps.net

使用以下瀏覽器獲得最佳體驗:
- ✅ Google Chrome 120+ (推薦)
- ✅ Microsoft Edge 120+
- ⚠️ Safari 17+ (需點擊「啟用音訊」)
- ⚠️ Firefox 121+ (需點擊「啟用音訊」)

### Step 2: 啟用音訊功能 (Safari/Firefox)

如果您使用 Safari 或 Firefox，首次進入會看到「啟用音訊」按鈕：

![啟用音訊按鈕](../images/audio-activation.png)

**為什麼需要這個步驟？**
- 瀏覽器安全政策要求使用者確認才能播放音訊
- 這是一次性操作，之後不會再出現

點擊「🎵 啟用音訊」按鈕即可繼續。

### Step 3: 觀察 3D Avatar

頁面載入完成後，您會看到 3D Avatar：

![3D Avatar](../images/avatar-display.png)

**互動方式**:
- 🖱️ **滑鼠拖曳**: 旋轉視角
- 🔍 **滑鼠滾輪**: 縮放距離
- 📱 **觸控**: 單指拖曳旋轉，雙指縮放

### Step 4: 發送第一則訊息

在畫面下方的聊天輸入框輸入「你好」：

![聊天介面](../images/chat-interface.png)

然後點擊「送出」按鈕。

### Step 5: 體驗語音與 Lip Sync

系統會：
1. ✅ 生成中文語音（~2 秒）
2. ✅ 自動播放音訊
3. ✅ Avatar 嘴型同步動畫

![Lip Sync 動畫](../images/lipsync-animation.png)

**🎉 恭喜！您已完成第一次對話體驗！**

---

## 🌟 功能亮點

### 1. 3D Avatar 顯示

**技術**: WebGL (Three.js)
**特色**:
- 流暢的 3D 渲染（30+ FPS）
- 可自由旋轉與縮放視角
- 閒置時有微妙的呼吸動畫

**系統需求**:
- 支援 WebGL 的現代瀏覽器
- 建議顯示卡: 整合顯卡以上

### 2. Azure TTS 語音生成

**技術**: Azure Cognitive Services Speech API
**特色**:
- 自然的中文語音（HsiaoChenNeural）
- 快速生成（平均 1.8 秒）
- 高音質（16kHz, 32kbps MP3）

**支援語言**: 目前僅中文（POC 階段）

### 3. Lip Sync 嘴型同步

**技術**: Web Audio API + Blendshape Animation
**特色**:
- 語音與嘴型即時同步（延遲 <100ms）
- 準確度 72%（POC 目標 70%）
- 流暢的過渡動畫

**已知限制**: 快速語句或高頻音素準確度略低

### 4. 響應式設計

**支援裝置**:
- 💻 **Desktop**: 完整功能，最佳體驗
- 📱 **Tablet**: 觸控優化，良好體驗
- 📱 **Mobile**: 觸控優化，可接受體驗

**自動調整**:
- Desktop: 左右分欄佈局（Avatar 左、Chat 右）
- Tablet/Mobile: 上下佈局（Avatar 上、Chat 下）

---

## 🔧 進階設定

### 調整 3D 視角

**初始視角重置**:
1. 重新整理頁面（F5）
2. 或調整至您喜歡的角度後記住該位置

**最佳觀看角度**:
- 距離: 2.5 - 3.5 公尺
- 高度: 與 Avatar 眼睛平視
- 角度: 正面或 15° 側面

### 音訊音量調整

**系統音量**:
- Windows: 右下角音量圖示
- macOS: 頂部選單列音量控制
- iOS/Android: 裝置側邊音量鍵

**瀏覽器音量**:
- Chrome: 分頁標籤右鍵 → "網站設定" → 音效
- Safari: Safari → 偏好設定 → 網站 → 自動播放

---

## 🎓 使用技巧

### 技巧 1: 最佳訊息長度

**推薦長度**: 10-30 字
- ✅ **短句** (5-10 字): 「你好」、「再見」
- ✅ **中句** (10-30 字): 「很高興認識你，我是 AI 助手」
- ⚠️ **長句** (>30 字): 可能需要較長生成時間

### 技巧 2: 清晰的語句

**語音生成品質最佳**:
- ✅ 標準中文詞彙
- ✅ 完整句子（有標點）
- ❌ 避免過多英文混合
- ❌ 避免網路用語或火星文

### 技巧 3: 網路連線

**建議網路速度**:
- 最低: 1 Mbps
- 推薦: 5 Mbps+
- 理想: 10 Mbps+

**離線模式**: 目前不支援（POC 階段）

---

## ❓ 常見問題

### Q1: 為什麼我看不到 3D Avatar？

**可能原因**:
1. **瀏覽器不支援 WebGL**
   - 解決: 更新至最新版 Chrome/Edge
   - 檢查: 前往 https://get.webgl.org/ 測試

2. **顯示卡驅動過舊**
   - 解決: 更新顯示卡驅動程式

3. **硬體加速被禁用**
   - Chrome: 設定 → 系統 → 「使用硬體加速」
   - 勾選後重新啟動瀏覽器

### Q2: 為什麼聽不到語音？

**可能原因**:
1. **未啟用音訊** (Safari/Firefox)
   - 解決: 點擊「啟用音訊」按鈕

2. **系統音量靜音**
   - 解決: 檢查系統音量設定

3. **瀏覽器分頁靜音**
   - 解決: 右鍵點擊分頁 → 取消靜音

### Q3: Lip Sync 不同步怎麼辦？

**可能原因**:
1. **網路延遲**
   - 解決: 檢查網路連線速度
   - 延遲 >200ms 可能影響同步

2. **CPU 負載過高**
   - 解決: 關閉其他占用 CPU 的程式
   - 降低視窗大小可改善效能

3. **瀏覽器效能**
   - 解決: 重新整理頁面
   - 或改用 Chrome/Edge

### Q4: 手機上很慢怎麼辦？

**優化建議**:
1. **關閉其他 App**: 釋放記憶體
2. **降低視窗大小**: 減少渲染負擔
3. **使用 WiFi**: 4G 可能不夠快
4. **更新作業系統**: iOS/Android 最新版

### Q5: 應用程式當掉了怎麼辦？

**緊急處理**:
1. **重新整理頁面** (F5 或 Cmd+R)
2. **清除瀏覽器快取**
3. **重新啟動瀏覽器**
4. **更換瀏覽器** (Chrome → Edge)

如果問題持續，請參閱 [故障排除指南](../troubleshooting/common-issues.md)。

---

## 📞 需要協助？

**技術支援**:
- 📧 Email: support@example.com
- 💬 GitHub Issues: https://github.com/your-org/smart-ai-avatar-agent/issues
- 📖 完整文件: https://docs.example.com

**回應時間**:
- 緊急問題: 24 小時內
- 一般問題: 3 個工作天內

---

## 🎉 下一步

恭喜您完成快速開始！接下來您可以：

1. 📖 **閱讀功能詳解**: [features.md](./features.md)
2. ❓ **查看更多 FAQ**: [faq.md](./faq.md)
3. 🌐 **瞭解瀏覽器支援**: [browser-compatibility.md](./browser-compatibility.md)
4. 🛠️ **部署自己的實例**: [deployment guide](../deployment/azure-static-web-apps.md)

**享受與 AI Avatar 的對話體驗！** 🚀
```

**驗證方式**:
- [ ] 內容清晰易懂
- [ ] 截圖完整（需後續補充）
- [ ] FAQ 涵蓋常見問題
- [ ] 非技術人員可理解

---

### Task 2: 撰寫 API 參考文件

**描述**: 撰寫 Azure TTS API 與內部 API 的使用文件

**檔案**: `docs/api-reference/azure-tts-api.md`

**程式碼實作**:
```markdown
# Azure TTS API Reference

本文件說明如何使用 Azure Cognitive Services Text-to-Speech API。

---

## 📋 概覽

**API Endpoint**: `https://{region}.tts.speech.microsoft.com/cognitiveservices/v1`

**Authentication**: Subscription Key (Ocp-Apim-Subscription-Key header)

**Supported Regions**:
- `eastus` (美國東部)
- `westus` (美國西部)
- `eastasia` (東亞)
- `southeastasia` (東南亞)

**Rate Limits** (Free Tier):
- 20 requests/minute
- 5 million characters/month

---

## 🔑 Authentication

### Method 1: Subscription Key (本專案使用)

**Request Header**:
```http
Ocp-Apim-Subscription-Key: YOUR_SUBSCRIPTION_KEY
```

**Example**:
```typescript
const response = await fetch(
  'https://eastus.tts.speech.microsoft.com/cognitiveservices/v1',
  {
    method: 'POST',
    headers: {
      'Ocp-Apim-Subscription-Key': process.env.AZURE_TTS_API_KEY,
      'Content-Type': 'application/ssml+xml',
      'X-Microsoft-OutputFormat': 'audio-16khz-32kbitrate-mono-mp3',
    },
    body: ssml,
  }
);
```

### Method 2: Access Token (未使用)

**Exchange Subscription Key for Token**:
```http
POST https://{region}.api.cognitive.microsoft.com/sts/v1.0/issueToken
Ocp-Apim-Subscription-Key: YOUR_SUBSCRIPTION_KEY
```

**Use Token**:
```http
Authorization: Bearer YOUR_ACCESS_TOKEN
```

**Token Lifetime**: 10 minutes

---

## 📤 Request Format

### HTTP Method
```http
POST /cognitiveservices/v1
```

### Headers

| Header | Value | Required |
|--------|-------|----------|
| `Content-Type` | `application/ssml+xml` | ✅ |
| `Ocp-Apim-Subscription-Key` | Your API Key | ✅ |
| `X-Microsoft-OutputFormat` | Audio format (see below) | ✅ |
| `User-Agent` | Application name | ❌ |

### Supported Audio Formats

| Format | Value | Bitrate | Sample Rate |
|--------|-------|---------|-------------|
| **MP3 (本專案使用)** | `audio-16khz-32kbitrate-mono-mp3` | 32 kbps | 16 kHz |
| MP3 | `audio-16khz-128kbitrate-mono-mp3` | 128 kbps | 16 kHz |
| WAV | `riff-16khz-16bit-mono-pcm` | 256 kbps | 16 kHz |
| OGG | `ogg-16khz-16bit-mono-opus` | ~20 kbps | 16 kHz |

**選擇 32kbps MP3 的原因**:
- ✅ 檔案小（節省 bandwidth）
- ✅ 品質足夠（語音清晰）
- ✅ 廣泛支援（所有瀏覽器）

### Request Body (SSML)

**SSML (Speech Synthesis Markup Language)** 格式:

```xml
<speak version='1.0' xml:lang='zh-TW'>
  <voice name='zh-TW-HsiaoChenNeural'>
    你好，我是 AI 助手。
  </voice>
</speak>
```

**SSML Elements**:

| Element | Purpose | Example |
|---------|---------|---------|
| `<speak>` | Root element | `<speak version='1.0' xml:lang='zh-TW'>` |
| `<voice>` | Voice selection | `<voice name='zh-TW-HsiaoChenNeural'>` |
| `<break>` | Pause | `<break time='500ms'/>` |
| `<prosody>` | Speed/Pitch | `<prosody rate='slow'>慢速</prosody>` |
| `<emphasis>` | Emphasis | `<emphasis level='strong'>重要</emphasis>` |

**Complete Example**:
```xml
<speak version='1.0' xml:lang='zh-TW'>
  <voice name='zh-TW-HsiaoChenNeural'>
    <prosody rate='medium' pitch='default'>
      你好，<break time='300ms'/>
      我是<emphasis level='strong'>AI 助手</emphasis>。
      很高興認識你！
    </prosody>
  </voice>
</speak>
```

---

## 📥 Response Format

### Success Response

**Status Code**: `200 OK`

**Content-Type**: `audio/mpeg` (or specified format)

**Body**: Binary audio data

**Example (TypeScript)**:
```typescript
const response = await fetch(endpoint, { ...config });

if (response.ok) {
  const audioBlob = await response.blob();
  const audioUrl = URL.createObjectURL(audioBlob);

  const audio = new Audio(audioUrl);
  audio.play();
}
```

### Error Response

**Status Codes**:

| Code | Meaning | Cause |
|------|---------|-------|
| `400` | Bad Request | Invalid SSML or missing headers |
| `401` | Unauthorized | Invalid API key |
| `403` | Forbidden | Quota exceeded or region mismatch |
| `429` | Too Many Requests | Rate limit exceeded |
| `500` | Internal Server Error | Azure service error |

**Error Body** (JSON):
```json
{
  "error": {
    "code": "InvalidRequest",
    "message": "The SSML document is invalid."
  }
}
```

---

## 🎤 Supported Voices (Chinese)

### Standard Voices

| Voice Name | Gender | Style | Use Case |
|------------|--------|-------|----------|
| **zh-TW-HsiaoChenNeural** (本專案) | Female | Natural, Friendly | General purpose |
| zh-TW-YunJheNeural | Male | Natural, Professional | Business |
| zh-TW-HsiaoYuNeural | Female | Young, Energetic | Marketing |

### Voice Styles (HsiaoChenNeural)

```xml
<!-- Cheerful -->
<mstts:express-as style="cheerful">
  今天天氣真好！
</mstts:express-as>

<!-- Sad -->
<mstts:express-as style="sad">
  很遺憾聽到這個消息。
</mstts:express-as>

<!-- Angry -->
<mstts:express-as style="angry">
  這太不公平了！
</mstts:express-as>
```

**Supported Styles**:
- `cheerful` (開心)
- `sad` (悲傷)
- `angry` (生氣)
- `fearful` (恐懼)
- `friendly` (友善)
- `gentle` (溫柔)

---

## 💻 Code Examples

### Basic Usage (TypeScript)

```typescript
// src/services/tts.ts
export async function generateSpeech(text: string): Promise<string> {
  const region = process.env.NEXT_PUBLIC_AZURE_TTS_REGION || 'eastus';
  const apiKey = process.env.NEXT_PUBLIC_AZURE_TTS_API_KEY;

  const ssml = `
    <speak version='1.0' xml:lang='zh-TW'>
      <voice name='zh-TW-HsiaoChenNeural'>
        ${text}
      </voice>
    </speak>
  `;

  const response = await fetch(
    `https://${region}.tts.speech.microsoft.com/cognitiveservices/v1`,
    {
      method: 'POST',
      headers: {
        'Ocp-Apim-Subscription-Key': apiKey!,
        'Content-Type': 'application/ssml+xml',
        'X-Microsoft-OutputFormat': 'audio-16khz-32kbitrate-mono-mp3',
      },
      body: ssml,
    }
  );

  if (!response.ok) {
    throw new Error(`TTS API failed: ${response.status}`);
  }

  const audioBlob = await response.blob();
  const audioUrl = URL.createObjectURL(audioBlob);

  return audioUrl;
}
```

### With Error Handling

```typescript
export async function generateSpeechWithRetry(
  text: string,
  maxRetries = 1
): Promise<string> {
  let attempt = 0;

  while (attempt <= maxRetries) {
    try {
      return await generateSpeech(text);
    } catch (error) {
      attempt++;

      if (attempt > maxRetries) {
        console.error('TTS generation failed after retries:', error);
        throw new Error('語音生成失敗，請稍後再試');
      }

      // Wait before retry
      await new Promise((resolve) => setTimeout(resolve, 2000));
    }
  }

  throw new Error('Unexpected error');
}
```

### With Caching

```typescript
const audioCache = new Map<string, string>();

export async function generateSpeechCached(text: string): Promise<string> {
  // Check cache
  const cached = audioCache.get(text);
  if (cached) {
    console.log('Cache hit:', text);
    return cached;
  }

  // Generate new
  const audioUrl = await generateSpeech(text);

  // Store in cache (limit size)
  if (audioCache.size >= 50) {
    const firstKey = audioCache.keys().next().value;
    audioCache.delete(firstKey);
  }

  audioCache.set(text, audioUrl);

  return audioUrl;
}
```

---

## 🧪 Testing

### Using cURL

```bash
curl -X POST \
  "https://eastus.tts.speech.microsoft.com/cognitiveservices/v1" \
  -H "Ocp-Apim-Subscription-Key: YOUR_API_KEY" \
  -H "Content-Type: application/ssml+xml" \
  -H "X-Microsoft-OutputFormat: audio-16khz-32kbitrate-mono-mp3" \
  -d "<speak version='1.0' xml:lang='zh-TW'><voice name='zh-TW-HsiaoChenNeural'>你好</voice></speak>" \
  --output test.mp3
```

### Using Postman

1. **Method**: POST
2. **URL**: `https://eastus.tts.speech.microsoft.com/cognitiveservices/v1`
3. **Headers**:
   - `Ocp-Apim-Subscription-Key`: `YOUR_KEY`
   - `Content-Type`: `application/ssml+xml`
   - `X-Microsoft-OutputFormat`: `audio-16khz-32kbitrate-mono-mp3`
4. **Body** (raw):
   ```xml
   <speak version='1.0' xml:lang='zh-TW'>
     <voice name='zh-TW-HsiaoChenNeural'>你好</voice>
   </speak>
   ```
5. **Send** → Save response as `test.mp3`

---

## 📊 Usage Monitoring

### Azure Portal

1. 前往 Azure Portal → Speech Service
2. 點擊「Metrics」
3. 查看:
   - Total Calls
   - Successful Calls
   - Failed Calls
   - Data In (characters)

### Application Insights (建議)

```typescript
import { ApplicationInsights } from '@microsoft/applicationinsights-web';

const appInsights = new ApplicationInsights({ config: {...} });

// Log TTS API call
appInsights.trackEvent({
  name: 'TTS_API_Call',
  properties: {
    textLength: text.length,
    voice: 'zh-TW-HsiaoChenNeural',
    success: true,
  },
  measurements: {
    duration: responseTime,
  },
});
```

---

## 💰 Cost Estimation

### Pricing (as of 2025-01)

| Tier | Price | Characters/Month |
|------|-------|------------------|
| Free | NT$ 0 | 5 million |
| Standard | NT$ 16/million | Unlimited |

### Cost Examples

**Scenario 1**: 1000 users, 10 messages/day, 20 chars/message
- Characters/month: 1000 × 10 × 20 × 30 = 6 million
- Cost: NT$ 16 (超過 Free tier 1 million)

**Scenario 2**: 100 users, 5 messages/day, 30 chars/message
- Characters/month: 100 × 5 × 30 × 30 = 450K
- Cost: NT$ 0 (Free tier)

**本專案 (POC)**: ~100K characters/month → **NT$ 0** ✅

---

## 🔒 Security Best Practices

### ❌ Don't (POC - Insecure)
```typescript
// Exposing API Key in frontend
const apiKey = process.env.NEXT_PUBLIC_AZURE_TTS_API_KEY;
```

### ✅ Do (MVP - Secure)
```typescript
// Frontend calls internal API
const response = await fetch('/api/tts', {
  method: 'POST',
  body: JSON.stringify({ text }),
});

// Backend (Azure Functions) holds API Key
export default async function handler(req, res) {
  const apiKey = process.env.AZURE_TTS_API_KEY; // Server-side only
  // Call Azure TTS API...
}
```

### Rate Limiting
```typescript
// Implement rate limiting (Redis)
const rateLimiter = rateLimit({
  windowMs: 60 * 1000, // 1 minute
  max: 10, // 10 requests per minute
});
```

---

## 📚 References

- [Azure TTS Documentation](https://learn.microsoft.com/azure/cognitive-services/speech-service/text-to-speech)
- [SSML Reference](https://learn.microsoft.com/azure/cognitive-services/speech-service/speech-synthesis-markup)
- [Voice Gallery](https://speech.microsoft.com/portal/voicegallery)
- [Pricing Calculator](https://azure.microsoft.com/pricing/calculator/)

---

**Last Updated**: 2025-10-14
```

**驗證方式**:
- [ ] API 使用說明完整
- [ ] 程式碼範例可執行
- [ ] 錯誤處理說明清楚
- [ ] 安全性建議明確

---

### Task 3: 撰寫部署指南

**描述**: 撰寫完整的 Azure Static Web Apps 部署指南（已在 Story 5.5 建立，此處整合）

**檔案**: `docs/deployment/deployment-checklist.md`

**程式碼實作**:
```markdown
# Deployment Checklist

部署前的完整檢查清單，確保所有步驟都已完成。

---

## 📋 Pre-Deployment Checklist

### Code Quality

- [ ] **所有測試通過**
  ```bash
  npm run test
  npm run test:e2e
  ```

- [ ] **Lint 檢查通過**
  ```bash
  npm run lint
  ```

- [ ] **TypeScript 編譯成功**
  ```bash
  npm run build
  ```

- [ ] **無 console.log 或 debugger**
  ```bash
  grep -r "console.log\|debugger" src/
  ```

### Configuration

- [ ] **Environment Variables 已設定**
  - Azure Portal → Configuration → Application settings
  - `AZURE_TTS_API_KEY`
  - `NEXT_PUBLIC_AZURE_TTS_REGION`

- [ ] **next.config.js 正確設定**
  ```javascript
  output: 'export',
  images: { unoptimized: true },
  trailingSlash: true,
  ```

- [ ] **GitHub Secrets 已設定**
  - `AZURE_STATIC_WEB_APPS_API_TOKEN`
  - `AZURE_TTS_API_KEY` (for build)

### Security

- [ ] **API Key 不在程式碼中**
  ```bash
  grep -r "YOUR_API_KEY\|sk-" src/
  ```

- [ ] **Secrets 不在 git history**
  ```bash
  git log -p --all -S "API_KEY"
  ```

- [ ] **HTTPS 強制啟用**
  - Azure Portal → Configuration → HTTPS only: Yes

### Performance

- [ ] **Bundle size 檢查**
  ```bash
  npm run build
  du -sh out/
  # Target: ≤500KB
  ```

- [ ] **Lighthouse score 檢查**
  ```bash
  lhci autorun
  # Target: Performance ≥70
  ```

---

## 🚀 Deployment Steps

### Step 1: Final Testing

```bash
# Run all tests
npm run test
npm run test:e2e

# Build and test locally
npm run build
npx serve out

# Manual smoke test
open http://localhost:3000
```

### Step 2: Commit and Push

```bash
# Commit changes
git add .
git commit -m "feat: ready for deployment"

# Push to main branch (triggers CI/CD)
git push origin main
```

### Step 3: Monitor Deployment

1. **GitHub Actions**
   - 前往: https://github.com/your-org/smart-ai-avatar-agent/actions
   - 查看最新 workflow run
   - 確認所有步驟成功 ✅

2. **Azure Portal**
   - 前往: Static Web Apps → Deployments
   - 查看最新部署狀態
   - 確認 "Ready" 狀態

### Step 4: Verify Production

```bash
# Test production URL
curl -I https://your-app.azurestaticapps.net

# Expected response:
# HTTP/2 200
# x-azure-ref: ...
# x-cache: HIT
```

**Manual Testing**:
- [ ] 首頁載入正常
- [ ] 3D Avatar 渲染正常
- [ ] TTS 語音生成正常
- [ ] Lip Sync 動畫正常
- [ ] 所有功能測試通過

### Step 5: Post-Deployment Validation

```bash
# Run E2E tests against production
PLAYWRIGHT_BASE_URL=https://your-app.azurestaticapps.net npm run test:e2e

# Run Lighthouse against production
lhci autorun --collect.url=https://your-app.azurestaticapps.net
```

---

## 🔄 Rollback Procedure

### Quick Rollback (GitHub Revert)

```bash
# Find commit to revert
git log --oneline -n 5

# Revert commit
git revert <commit-hash>
git push origin main

# Wait for auto-deployment (~3 min)
```

### Manual Rollback (Azure Portal)

1. Azure Portal → Static Web Apps → Deployments
2. 選擇先前的成功部署
3. 點擊「Activate」
4. 等待切換完成 (~1 min)

### Emergency Rollback

```bash
# Force push previous commit
git reset --hard HEAD~1
git push --force origin main

# ⚠️ Use with caution - only in emergencies
```

---

## 📊 Post-Deployment Monitoring

### First 24 Hours

**Check Every 2 Hours**:
- [ ] Uptime status (Azure Monitor)
- [ ] Error rate (Application Insights)
- [ ] Performance metrics (FPS, Load time)
- [ ] User feedback (Support tickets)

**Key Metrics**:
- Uptime: ≥99.9%
- Error rate: ≤1%
- Average response time: ≤2s
- Lighthouse Performance: ≥70

### First Week

**Daily Checks**:
- [ ] Monitor costs (Azure Cost Management)
- [ ] Review error logs (Application Insights)
- [ ] Check user feedback
- [ ] Verify CDN cache hit rate (≥80%)

### Ongoing

**Weekly Review**:
- Review Application Insights dashboard
- Analyze user behavior (if analytics enabled)
- Plan optimizations based on data

---

## 🚨 Common Deployment Issues

### Issue 1: Build Failed

**Symptom**: GitHub Actions fails at "Build Next.js" step

**Solutions**:
```bash
# Check local build
npm run build

# If succeeds locally, check:
# 1. GitHub Secrets are set
# 2. Node version matches (18.x)
# 3. Dependencies are up to date
```

### Issue 2: Page 404

**Symptom**: Production URL returns 404

**Solutions**:
1. Check `output_location` in workflow: should be `out`
2. Check `next.config.js`: should have `output: 'export'`
3. Rebuild and redeploy

### Issue 3: Environment Variables Not Working

**Symptom**: TTS API calls fail in production

**Solutions**:
1. Azure Portal → Configuration → Application settings
2. Verify `AZURE_TTS_API_KEY` is set
3. Restart app (trigger new deployment)

### Issue 4: CORS Error

**Symptom**: Console shows CORS error

**Solutions**:
- Azure Static Web Apps handles CORS automatically
- Check API endpoint URL (should be same origin or Azure endpoint)

---

## 📝 Deployment Log Template

```markdown
## Deployment Log - [Date]

**Deployed By**: [Name]
**Commit**: [Git commit hash]
**Deployment Time**: [Start time] - [End time]

### Pre-Deployment
- [ ] All tests passed
- [ ] Code review completed
- [ ] Environment variables verified

### Deployment
- [ ] GitHub Actions succeeded
- [ ] Azure deployment completed
- [ ] Production URL accessible

### Post-Deployment
- [ ] Smoke tests passed
- [ ] E2E tests passed
- [ ] Lighthouse score: [Score]
- [ ] No errors in first hour

### Issues Encountered
- [None / List issues and resolutions]

### Rollback Required
- [Yes / No]
- [If yes, reason and procedure]

**Status**: ✅ Success / ⚠️ Partial / ❌ Failed
```

---

## 🎉 Success Criteria

Deployment is considered successful when:

- ✅ All pre-deployment checks passed
- ✅ GitHub Actions workflow succeeded
- ✅ Production URL accessible via HTTPS
- ✅ All功能測試通過 (smoke tests)
- ✅ E2E tests passed against production
- ✅ Lighthouse Performance ≥70
- ✅ No critical errors in first 2 hours
- ✅ Rollback procedure verified and documented

---

**Last Updated**: 2025-10-14
```

**驗證方式**:
- [ ] Checklist 完整可執行
- [ ] Rollback 步驟清楚
- [ ] 常見問題有解決方案

---

### Task 4: 撰寫故障排除指南

**描述**: 撰寫常見問題與故障排除方法

**檔案**: `docs/troubleshooting/common-issues.md`

**程式碼實作**:
```markdown
# Common Issues & Troubleshooting

本文件列出常見問題與解決方案。

---

## 🔍 Quick Diagnosis

### Step 1: Identify the Problem Category

| Symptom | Category | Jump To |
|---------|----------|---------|
| 看不到 3D Avatar | [3D Rendering](#3d-rendering-issues) |
| 聽不到語音 | [Audio Issues](#audio-issues) |
| Lip Sync 不同步 | [Lip Sync Issues](#lip-sync-issues) |
| 頁面載入很慢 | [Performance Issues](#performance-issues) |
| 應用程式當掉 | [Crash Issues](#crash-issues) |
| API 錯誤 | [API Issues](#api-issues) |

### Step 2: Check Browser Console

**開啟 Console**:
- Chrome/Edge: F12 → Console tab
- Safari: Develop → Show Web Inspector → Console
- Firefox: F12 → Console tab

**Look for**:
- 🔴 Red error messages
- 🟡 Yellow warnings
- 網路請求失敗 (Network errors)

---

## 🎨 3D Rendering Issues

### Issue 1: Avatar 不顯示 (黑屏)

**Symptoms**:
- 頁面載入完成但看不到 Avatar
- Canvas 區域全黑或全白

**Possible Causes & Solutions**:

#### Cause 1: WebGL Not Supported

**Check**:
```javascript
// Open console and run:
const canvas = document.createElement('canvas');
const gl = canvas.getContext('webgl');
console.log('WebGL supported:', !!gl);
```

**Solution**:
- ✅ Update browser to latest version
- ✅ Enable hardware acceleration:
  - Chrome: Settings → System → "Use hardware acceleration"
  - Check and restart browser
- ✅ Update graphics driver

**Still not working?** Try a different browser (Chrome/Edge recommended).

#### Cause 2: Model Loading Failed

**Check Console**:
```
Error: Failed to load VRM model
```

**Solution**:
- Check network connection
- Clear browser cache (Ctrl+Shift+Del)
- Reload page (F5)

#### Cause 3: GPU Memory Insufficient (rare)

**Symptoms**: Avatar loads but crashes after few seconds

**Solution**:
- Close other GPU-intensive applications
- Reduce window size
- Use lower resolution display

### Issue 2: Avatar 很模糊

**Symptoms**:
- Avatar displays but textures are blurry
- Low resolution appearance

**Cause**: Auto LOD downgrade (Safari or low-end device)

**Solution**:
- This is expected behavior for performance
- Use Chrome/Edge for better quality
- On mobile: this is normal (optimized for performance)

**Not a bug** ✅ - Working as designed for compatibility.

### Issue 3: FPS 很低 (<20)

**Symptoms**:
- Choppy animation
- Laggy interaction

**Solutions**:

**Desktop**:
1. Close other applications
2. Reduce browser zoom (Ctrl+0 to reset)
3. Update graphics driver
4. Lower screen resolution

**Mobile**:
1. Close other apps
2. Enable "Low Power Mode" (iPhone) or "Battery Saver" (Android)
3. Use WiFi instead of cellular
4. Restart device

**Check Performance**:
```bash
# Chrome DevTools → Performance
# Record 10 seconds
# Look for:
# - FPS graph (should be mostly green/yellow)
# - CPU usage (should be <80%)
```

---

## 🔊 Audio Issues

### Issue 1: 完全沒有聲音

**Symptoms**:
- TTS generates but no audio plays
- No error messages

**Diagnostic Checklist**:

#### Step 1: Check System Volume

- Windows: 右下角音量圖示 → 確認非靜音
- macOS: 頂部選單列 → 音量控制
- Mobile: 側邊音量鍵 + 檢查靜音開關

#### Step 2: Check Browser Tab Audio

- Chrome: Right-click tab → Check if "Mute site" is enabled
- Safari: Address bar → Website Settings → Auto-Play: Allow
- Firefox: Address bar → Permissions → Autoplay: Allow Audio and Video

#### Step 3: Check AudioContext Activation (Safari/Firefox)

**Expected**: "啟用音訊" button should appear

**If button doesn't appear but no sound**:
```javascript
// Console check:
const AudioContext = window.AudioContext || window.webkitAudioContext;
const ctx = new AudioContext();
console.log('AudioContext state:', ctx.state);
// Expected: "suspended" (needs activation)
// After clicking button: "running"
```

**Solution**:
- Reload page (F5)
- Click "啟用音訊" button when it appears
- If button never appears, try different browser

#### Step 4: Check Network (TTS API)

**Console check**:
```
Network tab → Filter: "tts" or "speech"
Look for failed requests (red)
```

**If API fails**:
- Check internet connection
- Check Azure TTS service status
- Try again in a few minutes

### Issue 2: 聲音斷斷續續

**Symptoms**:
- Audio plays but keeps buffering/stuttering
- Incomplete sentences

**Causes & Solutions**:

**Network**:
- Check internet speed (speedtest.net)
- Required: ≥1 Mbps
- Recommended: ≥5 Mbps

**Browser**:
- Close unused tabs (free memory)
- Clear cache and reload

**Device**:
- Close background apps
- Restart browser

### Issue 3: 聲音延遲很久才播放

**Symptoms**:
- Click send → wait 5-10 seconds → audio plays

**Expected**: ~2 seconds delay

**Causes**:
1. **Network latency**: Check ping to Azure
   ```bash
   ping eastus.tts.speech.microsoft.com
   # Expected: <100ms
   ```

2. **Azure API slow**: Check Azure service status
   - https://status.azure.com/

3. **Browser caching disabled**: Enable cache for better performance

---

## 👄 Lip Sync Issues

### Issue 1: 嘴型完全不動

**Symptoms**:
- Audio plays but Avatar mouth doesn't move
- No animation

**Diagnostic**:

**Console check**:
```javascript
// Look for errors related to:
// - "morphTargetInfluences"
// - "Blendshape"
// - "Viseme"
```

**Causes & Solutions**:

#### Cause 1: Model doesn't have blendshapes

**Check**:
```javascript
// Console:
// Should see: "VRM model loaded with X blendshapes"
// If 0 blendshapes → model issue
```

**Solution**: This shouldn't happen with provided model. If it does, report as bug.

#### Cause 2: Lip Sync disabled due to error

**Check Console**: Look for "Lip Sync fallback activated"

**Solution**: Reload page. If persists, lip sync feature may be temporarily disabled for stability.

### Issue 2: 嘴型不同步 (延遲)

**Symptoms**:
- Audio plays first, mouth moves later
- Or vice versa

**Expected Delay**: <100ms (barely noticeable)

**If delay >200ms**:

**Causes**:
1. **High CPU usage**: Check Task Manager/Activity Monitor
   - Close other apps to free CPU

2. **Low FPS**: Avatar rendering too slow
   - See [FPS Issues](#issue-3-fps-很低-20)

3. **Network jitter**: Unstable connection
   - Use WiFi instead of cellular
   - Check other devices on network

### Issue 3: 某些音不準確

**Symptoms**:
- Most phonemes sync well
- But specific sounds (e.g., ㄙ, ㄕ) don't match well

**Expected**: 70% accuracy (POC phase)

**This is normal** ✅ - Simplified viseme mapping limitation.

**Workaround**: None for POC. MVP will use Azure Speech Viseme API for 90%+ accuracy.

---

## ⚡ Performance Issues

### Issue 1: 首屏載入很慢 (>5s)

**Symptoms**:
- Long wait before seeing anything
- "Loading..." stays for a long time

**Target**: <3 seconds

**Diagnostic**:

**Check Network**:
- Chrome DevTools → Network tab
- Look for slow requests (>2s)
- Look for large files (>1MB)

**Solutions**:

**Slow network**:
- Use faster connection (WiFi > Cellular)
- Wait for download to complete
- Consider using during off-peak hours

**Large initial bundle**:
- This is expected for first visit
- Subsequent visits should be faster (cached)

**Check**:
```bash
# Force reload (bypass cache):
Ctrl+Shift+R (Windows)
Cmd+Shift+R (Mac)

# If still slow, report as performance issue
```

### Issue 2: Memory 使用量很高

**Symptoms**:
- Browser becomes slow after 10-15 minutes
- Other tabs lag
- Device fan running loud

**Check Memory**:
```bash
# Chrome: Task Manager (Shift+Esc)
# Look for: [Tab] Smart AI Avatar
# Expected: <500MB
# If >800MB: Memory leak possible
```

**Solutions**:
- **Short-term**: Reload page (F5)
- **Long-term**: Report as bug with steps to reproduce

### Issue 3: Mobile 很燙

**Symptoms**:
- Phone gets very hot
- Battery drains quickly

**Causes**: High GPU/CPU usage (3D rendering)

**Solutions**:
1. **Reduce quality**:
   - App auto-reduces LOD on mobile
   - If still hot, close other apps

2. **Limit usage time**:
   - Take breaks every 5-10 minutes
   - Let device cool down

3. **Use Desktop version**:
   - For extended use, desktop recommended

---

## 💥 Crash Issues

### Issue 1: 頁面突然白屏

**Symptoms**:
- App was working, suddenly shows white screen
- Or shows error message: "發生了一些問題"

**Cause**: JavaScript error caught by Error Boundary

**Solutions**:

**Immediate**:
- Click "重新載入頁面" button
- Or press F5

**If crashes repeatedly**:
1. Clear browser cache:
   ```
   Chrome: Settings → Privacy → Clear browsing data
   Select: Cached images and files
   Time range: All time
   ```

2. Disable browser extensions:
   ```
   Chrome: Extensions → Disable all
   Reload page
   ```

3. Try incognito/private mode:
   ```
   Chrome: Ctrl+Shift+N
   Open app URL
   ```

4. Try different browser

**Still crashing?** Report bug with:
- Browser version
- Steps to reproduce
- Console error messages (F12)

### Issue 2: iOS Safari Crash

**Symptoms**:
- App works fine, then suddenly reloads
- More common after 15-20 minutes

**Cause**: iOS memory limit (~1.5GB)

**Solutions**:
- **Close other Safari tabs**: Free memory
- **Restart Safari**: Double-tap Home → Swipe up Safari
- **Restart device**: Hold Power button → Slide to power off

**Prevention**:
- Don't use app for >30 minutes continuously
- Take breaks to free memory
- Use iPad/Desktop for extended sessions

### Issue 3: Browser Tab Freezes

**Symptoms**:
- Page becomes unresponsive
- Can't click anything
- Browser shows "Page Unresponsive" dialog

**Solutions**:
1. **Wait 10 seconds**: Might recover automatically
2. **Kill tab**: Click "Stop" in dialog
3. **Restart browser**

**Prevention**:
- Don't open too many tabs
- Close unused tabs regularly
- Keep browser updated

---

## 🌐 API Issues

### Issue 1: TTS API 錯誤 (401 Unauthorized)

**Error Message**: "TTS API failed: 401"

**Cause**: Invalid or expired API key

**Solutions**:
- **For users**: This is a server config issue. Report to admin.
- **For admins**:
  ```bash
  # Check Azure Portal:
  # Speech Service → Keys and Endpoint
  # Verify Key 1 or Key 2 is valid
  # Update environment variable in:
  # Azure Static Web Apps → Configuration
  ```

### Issue 2: TTS API 錯誤 (429 Too Many Requests)

**Error Message**: "TTS API failed: 429" or "語音生成服務暫時無法使用"

**Cause**: Rate limit exceeded (20 requests/minute)

**Solutions**:
- **Wait 1 minute** and try again
- **For admins**: Consider upgrading to Standard tier

### Issue 3: TTS API 錯誤 (500 Internal Server Error)

**Error Message**: "TTS API failed: 500"

**Cause**: Azure service issue (rare)

**Solutions**:
1. **Retry**: App auto-retries once
2. **Wait 5 minutes**: Azure may be experiencing temporary issue
3. **Check Azure Status**: https://status.azure.com/
4. **If persists >30min**: Report to Azure Support

---

## 🆘 When to Report a Bug

**Report if**:
- Issue persists after trying all solutions above
- Issue is reproducible (happens every time)
- Issue affects core functionality (Avatar, TTS, Lip Sync)

**Do NOT report if**:
- Issue happens once and doesn't reproduce
- Issue is due to slow internet (not app's fault)
- Issue is a known limitation (e.g., 70% lip sync accuracy)

**How to Report**:

1. **GitHub Issues**: https://github.com/your-org/smart-ai-avatar-agent/issues

2. **Include**:
   - Browser & version
   - OS & version
   - Steps to reproduce
   - Console error messages (screenshot)
   - Expected vs Actual behavior

3. **Template**:
   ```markdown
   **Browser**: Chrome 120 (Windows 11)
   **Issue**: Avatar doesn't load
   **Steps**:
   1. Open app URL
   2. Wait 10 seconds
   3. See black screen

   **Console Error**:
   ```
   Error: Failed to load VRM model
   ```

   **Expected**: Avatar should appear in 2-3 seconds
   **Actual**: Black screen, no Avatar
   ```

---

## 📞 Support Contacts

**Technical Support**:
- 📧 Email: support@example.com
- 💬 GitHub: https://github.com/your-org/smart-ai-avatar-agent/issues

**Response Time**:
- 🔴 Critical (app down): 4 hours
- 🟡 High (feature broken): 24 hours
- 🟢 Medium (minor issue): 3 days
- 🔵 Low (enhancement): Best effort

**Before Contacting Support**:
- ✅ Read this troubleshooting guide
- ✅ Try solutions listed above
- ✅ Prepare bug report with details

---

**Last Updated**: 2025-10-14
```

**驗證方式**:
- [ ] 常見問題完整涵蓋
- [ ] 解決方案清晰可執行
- [ ] Debug 步驟詳細
- [ ] 聯絡方式明確

---

### Task 5: 建立專案 README

**描述**: 建立專案總覽 README

**檔案**: `README.md` (專案根目錄)

**程式碼實作**:
```markdown
# Smart AI Avatar Agent 🤖

一個基於 Web 的智能 3D Avatar 對話應用，整合 Azure TTS 語音生成與 Lip Sync 嘴型同步技術。

![Demo Screenshot](docs/images/demo-screenshot.png)

[![Live Demo](https://img.shields.io/badge/demo-live-green)](https://smart-ai-avatar.azurestaticapps.net)
[![License](https://img.shields.io/badge/license-MIT-blue)](LICENSE)
[![Build Status](https://img.shields.io/github/actions/workflow/status/your-org/smart-ai-avatar-agent/azure-static-web-apps.yml)](https://github.com/your-org/smart-ai-avatar-agent/actions)

---

## ✨ Features

- 🎨 **3D Avatar Rendering**: WebGL-based 3D character with smooth animation (30+ FPS)
- 🗣️ **Azure TTS Integration**: Natural Chinese voice synthesis (~1.8s generation time)
- 👄 **Lip Sync Animation**: Real-time mouth movement synchronized with speech (72% accuracy)
- 📱 **Responsive Design**: Works on Desktop, Tablet, and Mobile
- 🌐 **Cross-Browser**: Chrome, Safari, Edge, Firefox
- ♿ **Accessible**: WCAG AA compliant
- ☁️ **Cloud Deployed**: Azure Static Web Apps with global CDN

---

## 🚀 Quick Start

### For Users

**Try it now**: https://smart-ai-avatar.azurestaticapps.net

**System Requirements**:
- Modern browser (Chrome 120+, Safari 17+, Edge 120+, Firefox 121+)
- Internet connection (5+ Mbps recommended)
- WebGL support (check at https://get.webgl.org/)

**Quick Tutorial**: [Getting Started Guide](docs/user-guide/getting-started.md)

### For Developers

**Prerequisites**:
- Node.js 18+
- npm 9+
- Azure account (for deployment)

**Clone and Run**:
```bash
# Clone repository
git clone https://github.com/your-org/smart-ai-avatar-agent.git
cd smart-ai-avatar-agent

# Install dependencies
npm install

# Set environment variables
cp .env.example .env.local
# Edit .env.local with your Azure TTS API key

# Run development server
npm run dev

# Open http://localhost:3000
```

**Build for Production**:
```bash
# Static export
npm run build

# Test production build
npx serve out
```

---

## 📖 Documentation

### User Documentation
- 📘 [Getting Started Guide](docs/user-guide/getting-started.md)
- 📗 [Features Overview](docs/user-guide/features.md)
- ❓ [FAQ](docs/user-guide/faq.md)
- 🌐 [Browser Compatibility](docs/user-guide/browser-compatibility.md)

### Developer Documentation
- 🏗️ [Architecture Overview](docs/architecture/system-overview.md)
- 📚 [API Reference](docs/api-reference/azure-tts-api.md)
- 🚀 [Deployment Guide](docs/deployment/azure-static-web-apps.md)
- 🔧 [Troubleshooting](docs/troubleshooting/common-issues.md)

### Project Documentation
- 📋 [PRD (Product Requirements)](docs/PRD.md)
- 🏛️ [System Architecture](docs/architecture.md)
- ✅ [Technical Validation Report](docs/validation/technical-validation-report.md)

---

## 🛠️ Technology Stack

### Frontend
- **Framework**: Next.js 14 (App Router, Static Export)
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **3D Rendering**: Three.js + @react-three/fiber
- **Animation**: Framer Motion
- **State Management**: Zustand

### Backend & Services
- **TTS API**: Azure Cognitive Services Speech API
- **Hosting**: Azure Static Web Apps
- **CDN**: Azure CDN (Global)
- **CI/CD**: GitHub Actions

### Testing & Quality
- **Unit Tests**: Jest + React Testing Library
- **E2E Tests**: Playwright
- **Performance**: Lighthouse CI
- **Linting**: ESLint + Prettier

---

## 📊 Performance

| Metric | Target | Actual |
|--------|--------|--------|
| **FPS** | ≥30 | 32-38 (Chrome) |
| **Lighthouse Performance** | ≥70 | 84 |
| **First Contentful Paint** | ≤2s | 1.3s |
| **Lip Sync Accuracy** | ≥70% | 72% |
| **Bundle Size** | ≤500KB | 420KB |
| **TTS Generation Time** | ≤3s | 1.8s |

---

## 🌐 Browser Support

| Browser | Desktop | Mobile | Notes |
|---------|---------|--------|-------|
| Chrome | ✅ 120+ | ✅ 120+ | Best performance |
| Edge | ✅ 120+ | ✅ 120+ | Same as Chrome |
| Safari | ⚠️ 17+ | ⚠️ 17+ | Requires audio activation |
| Firefox | ⚠️ 121+ | ⚠️ 121+ | Requires audio activation |

⚠️ = Fully functional with minor workarounds

---

## 🚀 Deployment

### Deploy to Azure Static Web Apps

**Quick Deploy** (Automated):
```bash
# Push to main branch triggers CI/CD
git push origin main

# GitHub Actions automatically:
# 1. Runs tests
# 2. Builds Next.js
# 3. Deploys to Azure
```

**Manual Deploy**:
```bash
# Using Azure CLI
az staticwebapp create \
  --name smart-ai-avatar-app \
  --resource-group your-rg \
  --source https://github.com/your-org/smart-ai-avatar-agent \
  --branch main \
  --app-location "/" \
  --output-location "out"
```

**Full Guide**: [Deployment Guide](docs/deployment/azure-static-web-apps.md)

---

## 🧪 Testing

### Run Tests
```bash
# Unit tests
npm run test

# E2E tests
npm run test:e2e

# E2E with UI
npm run test:e2e:ui

# Lint
npm run lint

# Type check
npx tsc --noEmit
```

### Performance Testing
```bash
# Lighthouse CI
npm install -g @lhci/cli
lhci autorun --collect.url=http://localhost:3000

# Expected scores:
# Performance: ≥80
# Accessibility: ≥90
# Best Practices: ≥90
# SEO: ≥80
```

---

## 🤝 Contributing

We welcome contributions! Please see [CONTRIBUTING.md](CONTRIBUTING.md) for guidelines.

**Development Workflow**:
1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'feat: add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

**Commit Convention**: [Conventional Commits](https://www.conventionalcommits.org/)
- `feat:` New feature
- `fix:` Bug fix
- `docs:` Documentation
- `style:` Code style (formatting)
- `refactor:` Code refactoring
- `test:` Tests
- `chore:` Build/tooling

---

## 📜 License

This project is licensed under the MIT License - see [LICENSE](LICENSE) file for details.

---

## 🙏 Acknowledgments

- **Azure Cognitive Services**: TTS API provider
- **Three.js Community**: 3D rendering library
- **Pixiv**: VRM character model format
- **Next.js Team**: React framework

---

## 📞 Support

- 📧 **Email**: support@example.com
- 💬 **GitHub Issues**: [Report a bug](https://github.com/your-org/smart-ai-avatar-agent/issues)
- 📖 **Documentation**: [Full docs](docs/)
- 🌐 **Website**: https://example.com

---

## 🗺️ Roadmap

### POC Phase (✅ Completed)
- ✅ 3D Avatar rendering
- ✅ Azure TTS integration
- ✅ Basic Lip Sync (70% accuracy)
- ✅ Azure Static Web Apps deployment

### MVP Phase 1 (Q1 2025)
- 🔐 Secure API key (Azure Functions proxy)
- 📊 Monitoring & alerting
- 👄 Improved Lip Sync (85%+ accuracy with Azure Speech Viseme)

### MVP Phase 2 (Q2 2025)
- 📱 iOS performance optimization
- 🌐 Multi-language support (EN, JA)
- 💾 Offline mode (PWA)

### Future
- 🎨 Avatar customization
- 😀 Emotion detection
- 👥 Multi-avatar scenes
- 🥽 VR/AR support

---

## 📈 Project Stats

![GitHub stars](https://img.shields.io/github/stars/your-org/smart-ai-avatar-agent?style=social)
![GitHub forks](https://img.shields.io/github/forks/your-org/smart-ai-avatar-agent?style=social)
![GitHub issues](https://img.shields.io/github/issues/your-org/smart-ai-avatar-agent)
![GitHub pull requests](https://img.shields.io/github/issues-pr/your-org/smart-ai-avatar-agent)

**Built with ❤️ by the Smart AI Avatar Team**

---

**Last Updated**: 2025-10-14
```

**驗證方式**:
- [ ] README 清晰專業
- [ ] 快速開始說明完整
- [ ] Badges 與連結正確
- [ ] 涵蓋所有關鍵資訊

---

## 📊 Dev Notes

### 文件撰寫最佳實踐

**KISS Principle**:
- 使用簡單語言
- 避免術語過載
- 一個概念一個段落

**Visual First**:
- 截圖 > 文字
- 流程圖 > 長段落
- 程式碼範例 > 抽象說明

**User-Centric**:
- 以使用者目標為導向
- 提供實際使用情境
- 包含預期結果

**Maintainability**:
- 文件與程式碼同步更新
- 使用版本控制
- 定期審查與更新

---

## 🧪 Testing Strategy

**文件測試**:
- [ ] 所有程式碼範例可執行
- [ ] 所有連結有效
- [ ] 所有截圖清晰
- [ ] 步驟可重現

**User Testing**:
- [ ] 新使用者可依文件上手
- [ ] 開發者可依文件部署
- [ ] 維運人員可依文件排除故障

---

## 📈 Success Metrics

### 量化指標

1. **文件完整性**: 100% 功能有文件
2. **文件準確性**: 程式碼範例 100% 可執行
3. **可讀性**: Flesch Reading Ease ≥60
4. **使用率**: ≥80% 使用者查閱文件解決問題

### 質化指標

1. **使用者反饋**: "文件清楚易懂，快速上手"
2. **開發者反饋**: "部署步驟完整，無需詢問"
3. **維運反饋**: "故障排除指南有效，節省時間"

---

## 🔗 Dependencies

### Epic Dependencies
- **Depends on**: All Epic 1-5 Stories completed

### Story Dependencies
- **Must Complete Before**: Epic 5 PO Review Request

---

## 📦 Deliverables

1. **User Documentation**:
   - `docs/user-guide/getting-started.md` ✅
   - `docs/user-guide/features.md` (based on getting-started)
   - `docs/user-guide/faq.md` (based on getting-started)
   - `docs/user-guide/browser-compatibility.md` (based on Story 5.4)

2. **API Documentation**:
   - `docs/api-reference/azure-tts-api.md` ✅
   - `docs/api-reference/internal-api.md` (if needed)
   - `docs/api-reference/error-codes.md` (based on azure-tts-api)

3. **Deployment Documentation**:
   - `docs/deployment/azure-static-web-apps.md` (Story 5.5)
   - `docs/deployment/deployment-checklist.md` ✅
   - `docs/deployment/environment-variables.md` (based on Story 5.5)

4. **Troubleshooting Documentation**:
   - `docs/troubleshooting/common-issues.md` ✅
   - `docs/troubleshooting/error-messages.md` (based on common-issues)
   - `docs/troubleshooting/debug-guide.md` (based on common-issues)

5. **Project README**:
   - `README.md` ✅

---

## ✅ Definition of Done

- [ ] 使用者快速開始指南完整撰寫
- [ ] API 參考文件完整（Azure TTS API）
- [ ] 部署檢查清單完整可執行
- [ ] 故障排除指南涵蓋所有常見問題
- [ ] 專案 README 專業完整
- [ ] 所有程式碼範例經過測試可執行
- [ ] 所有連結有效無死連結
- [ ] 截圖清晰標註完整（需後續補充）
- [ ] 文件 peer review 通過
- [ ] 非技術人員可理解使用者文件
- [ ] 開發者可依文件獨立部署
- [ ] PO review 通過

---

## 📚 References

- [Write the Docs](https://www.writethedocs.org/)
- [Google Developer Documentation Style Guide](https://developers.google.com/style)
- [Microsoft Writing Style Guide](https://learn.microsoft.com/style-guide/)
- [README Best Practices](https://github.com/jehna/readme-best-practices)

---

**Story 建立日期**: 2025-10-14
**最後更新**: 2025-10-14
**INVEST Score**: ⭐⭐⭐⭐⭐⭐ (6/6)
- ✅ Independent: 可獨立撰寫（基於完成的功能）
- ✅ Negotiable: 文件詳細程度與格式可調整
- ✅ Valuable: 支援使用者上手、開發者維護、團隊協作
- ✅ Estimable: 6 小時預估時間合理
- ✅ Small: 範圍明確，可在一天內完成
- ✅ Testable: 可透過 user testing 與 peer review 驗證
