# Story 1.3: 基礎 UI 框架與全域樣式設定

## Status
Draft

---

## Story

**As a** 開發者,
**I want** 建立專案的 UI 基礎框架與全域樣式,
**so that** 後續頁面開發有一致的視覺風格與佈局基礎。

---

## Acceptance Criteria

1. 在 `app/layout.tsx` 設定全域佈局,包含 `<html>`, `<body>` 基本結構
2. 在 `app/globals.css` 配置 Tailwind CSS,設定專案主題色彩(深藍、白色、青色)
3. 自訂 Tailwind 配置(`tailwind.config.ts`),加入專案色彩變數
4. 建立 `components/ui/Button.tsx` 通用按鈕組件(含 Loading 狀態)
5. 建立 `components/ui/Input.tsx` 通用輸入框組件
6. 在 `app/page.tsx` 建立暫時首頁,顯示「3D Avatar 對話系統 - 開發中」與專案 Logo
7. 頁面在瀏覽器中正常顯示,樣式符合設計規範(深藍背景、白色文字)

---

## Tasks / Subtasks

- [ ] **Task 1: 全域佈局設定** (AC: 1)
  - [ ] 修改 `app/layout.tsx`,設定基礎 HTML 結構
  - [ ] 加入 Google Fonts (Noto Sans TC + Inter):
    ```tsx
    import { Noto_Sans_TC, Inter } from 'next/font/google'

    const notoSansTC = Noto_Sans_TC({
      subsets: ['chinese-traditional'],
      variable: '--font-noto-sans-tc',
    })

    const inter = Inter({
      subsets: ['latin'],
      variable: '--font-inter',
    })
    ```
  - [ ] 設定 `<html lang="zh-TW">`
  - [ ] 在 `<body>` 加入字體 className
  - [ ] 設定基礎 metadata (title, description)

- [ ] **Task 2: Tailwind CSS 全域樣式配置** (AC: 2)
  - [ ] 編輯 `app/globals.css`,加入自訂 CSS 變數:
    ```css
    @tailwind base;
    @tailwind components;
    @tailwind utilities;

    @layer base {
      :root {
        /* 主題色彩 */
        --color-primary: 30 58 138;      /* 深藍 #1E3A8A */
        --color-secondary: 6 182 212;    /* 青色 #06B6D4 */
        --color-accent: 255 255 255;     /* 白色 #FFFFFF */
        --color-background: 15 23 42;    /* 深色背景 #0F172A */
        --color-text: 248 250 252;       /* 淡灰文字 #F8FAFC */
      }
    }

    body {
      @apply bg-background text-text font-sans antialiased;
    }
    ```
  - [ ] 加入全域滾動條樣式(自訂 scrollbar)
  - [ ] 設定基礎動畫過渡 (transitions)

- [ ] **Task 3: Tailwind 配置檔客製化** (AC: 3)
  - [ ] 編輯 `tailwind.config.ts`,加入主題色彩:
    ```ts
    import type { Config } from 'tailwindcss'

    const config: Config = {
      content: [
        './pages/**/*.{js,ts,jsx,tsx,mdx}',
        './components/**/*.{js,ts,jsx,tsx,mdx}',
        './app/**/*.{js,ts,jsx,tsx,mdx}',
      ],
      theme: {
        extend: {
          colors: {
            primary: 'rgb(var(--color-primary) / <alpha-value>)',
            secondary: 'rgb(var(--color-secondary) / <alpha-value>)',
            accent: 'rgb(var(--color-accent) / <alpha-value>)',
            background: 'rgb(var(--color-background) / <alpha-value>)',
            text: 'rgb(var(--color-text) / <alpha-value>)',
          },
          fontFamily: {
            sans: ['var(--font-noto-sans-tc)', 'var(--font-inter)', 'sans-serif'],
          },
          borderRadius: {
            DEFAULT: '12px', // 專案預設圓角
          },
        },
      },
      plugins: [],
    }
    export default config
    ```
  - [ ] 驗證配置檔語法正確
  - [ ] 執行 `pnpm build` 確認 Tailwind 編譯成功

- [ ] **Task 4: Button 通用組件** (AC: 4)
  - [ ] 建立 `components/ui/` 目錄
  - [ ] 建立 `components/ui/Button.tsx`:
    ```tsx
    import { ButtonHTMLAttributes, FC } from 'react'
    import { cn } from '@/lib/utils' // 待建立 utility

    interface ButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {
      variant?: 'primary' | 'secondary' | 'outline'
      size?: 'sm' | 'md' | 'lg'
      isLoading?: boolean
    }

    export const Button: FC<ButtonProps> = ({
      children,
      variant = 'primary',
      size = 'md',
      isLoading = false,
      disabled,
      className,
      ...props
    }) => {
      const baseStyles = 'rounded font-medium transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed'

      const variantStyles = {
        primary: 'bg-primary text-white hover:bg-primary/90',
        secondary: 'bg-secondary text-white hover:bg-secondary/90',
        outline: 'border-2 border-primary text-primary hover:bg-primary hover:text-white',
      }

      const sizeStyles = {
        sm: 'px-3 py-1.5 text-sm',
        md: 'px-4 py-2 text-base',
        lg: 'px-6 py-3 text-lg',
      }

      return (
        <button
          className={cn(
            baseStyles,
            variantStyles[variant],
            sizeStyles[size],
            isLoading && 'relative cursor-wait',
            className
          )}
          disabled={disabled || isLoading}
          {...props}
        >
          {isLoading ? (
            <>
              <span className="opacity-0">{children}</span>
              <span className="absolute inset-0 flex items-center justify-center">
                <svg className="animate-spin h-5 w-5" viewBox="0 0 24 24">
                  <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" fill="none" />
                  <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
                </svg>
              </span>
            </>
          ) : children}
        </button>
      )
    }
    ```
  - [ ] 建立 `lib/utils.ts` (cn 輔助函式):
    ```ts
    import { clsx, type ClassValue } from 'clsx'
    import { twMerge } from 'tailwind-merge'

    export function cn(...inputs: ClassValue[]) {
      return twMerge(clsx(inputs))
    }
    ```
  - [ ] 安裝依賴: `pnpm add clsx tailwind-merge`
  - [ ] 測試按鈕組件在不同狀態下的顯示

- [ ] **Task 5: Input 通用組件** (AC: 5)
  - [ ] 建立 `components/ui/Input.tsx`:
    ```tsx
    import { InputHTMLAttributes, FC, forwardRef } from 'react'
    import { cn } from '@/lib/utils'

    interface InputProps extends InputHTMLAttributes<HTMLInputElement> {
      label?: string
      error?: string
    }

    export const Input = forwardRef<HTMLInputElement, InputProps>(
      ({ label, error, className, ...props }, ref) => {
        return (
          <div className="w-full">
            {label && (
              <label className="block text-sm font-medium mb-1.5 text-text">
                {label}
              </label>
            )}
            <input
              ref={ref}
              className={cn(
                'w-full px-4 py-2 rounded border-2 border-gray-600',
                'bg-gray-800 text-white placeholder:text-gray-400',
                'focus:border-secondary focus:outline-none focus:ring-2 focus:ring-secondary/20',
                'disabled:opacity-50 disabled:cursor-not-allowed',
                'transition-all duration-200',
                error && 'border-red-500 focus:border-red-500 focus:ring-red-500/20',
                className
              )}
              {...props}
            />
            {error && (
              <p className="mt-1.5 text-sm text-red-400">{error}</p>
            )}
          </div>
        )
      }
    )

    Input.displayName = 'Input'
    ```
  - [ ] 測試輸入框在不同狀態下的顯示(normal, focus, error, disabled)

- [ ] **Task 6: 暫時首頁建立** (AC: 6)
  - [ ] 編輯 `app/page.tsx`,建立暫時首頁:
    ```tsx
    import { Button } from '@/components/ui/Button'

    export default function Home() {
      return (
        <main className="min-h-screen flex flex-col items-center justify-center bg-gradient-to-b from-background to-gray-900">
          <div className="text-center space-y-8 p-8">
            {/* Logo / Title */}
            <div className="space-y-4">
              <h1 className="text-6xl font-bold text-white">
                3D Avatar <span className="text-secondary">對話系統</span>
              </h1>
              <p className="text-xl text-gray-300">
                POC 開發中 - Powered by Next.js + Three.js + Azure AI
              </p>
            </div>

            {/* Status Badge */}
            <div className="inline-flex items-center gap-2 px-4 py-2 bg-secondary/10 border border-secondary rounded-full">
              <div className="w-2 h-2 bg-secondary rounded-full animate-pulse" />
              <span className="text-secondary font-medium">系統開發中</span>
            </div>

            {/* Feature List */}
            <div className="max-w-2xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-4 mt-12">
              <div className="p-6 bg-gray-800/50 rounded-lg border border-gray-700">
                <div className="text-4xl mb-2">🎨</div>
                <h3 className="text-lg font-semibold text-white mb-1">3D Avatar 渲染</h3>
                <p className="text-sm text-gray-400">Three.js + Ready Player Me</p>
              </div>

              <div className="p-6 bg-gray-800/50 rounded-lg border border-gray-700">
                <div className="text-4xl mb-2">💬</div>
                <h3 className="text-lg font-semibold text-white mb-1">LLM 對話</h3>
                <p className="text-sm text-gray-400">Azure OpenAI GPT-4 Turbo</p>
              </div>

              <div className="p-6 bg-gray-800/50 rounded-lg border border-gray-700">
                <div className="text-4xl mb-2">🔊</div>
                <h3 className="text-lg font-semibold text-white mb-1">語音合成</h3>
                <p className="text-sm text-gray-400">Azure Speech Services TTS</p>
              </div>

              <div className="p-6 bg-gray-800/50 rounded-lg border border-gray-700">
                <div className="text-4xl mb-2">👄</div>
                <h3 className="text-lg font-semibold text-white mb-1">Lip Sync</h3>
                <p className="text-sm text-gray-400">Web Audio API 音訊分析</p>
              </div>
            </div>

            {/* Demo Button (暫時禁用) */}
            <div className="pt-8">
              <Button size="lg" disabled>
                即將推出
              </Button>
            </div>
          </div>
        </main>
      )
    }
    ```
  - [ ] 確認頁面在瀏覽器中正常顯示

- [ ] **Task 7: 視覺驗證與樣式微調** (AC: 7)
  - [ ] 啟動開發伺服器: `pnpm dev`
  - [ ] 在瀏覽器開啟 `http://localhost:3000`
  - [ ] 驗證以下視覺效果:
    - ✅ 背景漸層 (深藍到黑)
    - ✅ 白色文字清晰可讀
    - ✅ 青色強調色正確顯示
    - ✅ 圓角設計一致 (12px)
    - ✅ 字體正確載入 (Noto Sans TC)
    - ✅ 動畫效果流暢 (pulse, transitions)
  - [ ] 測試響應式設計:
    - 桌機 (1920x1080): 佈局正常
    - 筆電 (1366x768): 內容不溢出
    - 平板 (1024x768): 卡片正確排列
  - [ ] 截圖並記錄於開發日誌
  - [ ] 修正任何視覺問題

---

## Dev Notes

### 相關來源樹 (Source Tree)

根據架構文件,UI 框架的檔案結構應如下:

```
avatar-chat-poc/
├── app/
│   ├── layout.tsx              # ✅ 全域佈局 (Task 1)
│   ├── page.tsx                # ✅ 暫時首頁 (Task 6)
│   └── globals.css             # ✅ 全域樣式 (Task 2)
│
├── components/
│   └── ui/                     # ✅ 基礎 UI 組件
│       ├── Button.tsx          # ✅ 按鈕組件 (Task 4)
│       └── Input.tsx           # ✅ 輸入框組件 (Task 5)
│
├── lib/
│   └── utils.ts                # ✅ 工具函式 (Task 4)
│
├── tailwind.config.ts          # ✅ Tailwind 配置 (Task 3)
└── package.json                # 需加入新依賴
```

### 設計規範 (Design Specs)

根據 PRD 的 Branding 章節與 Front-End Spec:

**色彩系統**:
- **主色 (Primary)**: `#1E3A8A` (深藍) - 傳達專業與科技感
- **輔色 (Secondary)**: `#06B6D4` (青色) - 用於互動元素、強調
- **強調色 (Accent)**: `#FFFFFF` (白色) - 文字與高亮
- **背景色 (Background)**: `#0F172A` (深色背景) - Slate 900
- **文字色 (Text)**: `#F8FAFC` (淡灰) - Slate 50

**字體系統**:
- **繁中**: Noto Sans TC (Google Fonts) - 繁中支援完善
- **英數**: Inter (Google Fonts) - 現代感、可讀性高
- **Fallback**: system-ui, sans-serif

**視覺風格**:
- **圓角設計**: 統一使用 `12px` (柔化科技感)
- **陰影系統**: 使用 Tailwind 的 `shadow-lg` (層次感)
- **漸層背景**: `from-background to-gray-900` (Avatar 區域視覺豐富度)
- **動畫原則**: 流暢過渡 200ms, 避免過度動畫

### 技術實作細節

**Tailwind CSS 配置策略**:
1. **CSS 變數模式**: 使用 RGB 格式支援 alpha 透明度
   ```css
   --color-primary: 30 58 138;  /* 可用於 rgb(30 58 138 / 0.5) */
   ```

2. **Dark Mode 準備**: POC 階段強制 Dark Mode,未來可擴展
   ```ts
   // tailwind.config.ts
   darkMode: 'class', // 未來可切換
   ```

3. **工具類別擴展**: 使用 `@layer` 組織自訂樣式
   ```css
   @layer components {
     .btn-primary { /* custom button styles */ }
   }
   ```

**組件設計原則**:
1. **組合優於繼承**: Button/Input 使用組合模式,支援擴展
2. **Controlled vs Uncontrolled**: Input 使用 forwardRef 支援兩種模式
3. **Accessibility**: 加入基本 ARIA 屬性 (label, disabled)
4. **Type Safety**: 所有 Props 使用 TypeScript interface

**效能考量**:
- **字體優化**: 使用 `next/font` 自動優化載入
- **CSS-in-JS 避免**: 使用 Tailwind 避免 runtime CSS
- **動態 Import**: 未來大型組件使用 `next/dynamic`

### 設計決策記錄

1. **為何使用 CSS 變數而非直接 Hex 色碼？**
   - ✅ 支援 alpha 透明度 (`bg-primary/50`)
   - ✅ 便於主題切換 (未來 Light Mode)
   - ✅ 統一管理,減少維護成本

2. **為何使用 clsx + tailwind-merge？**
   - ✅ `clsx`: 條件式 className 組合
   - ✅ `tailwind-merge`: 避免衝突 class (如 `px-4 px-6` → 保留後者)
   - ✅ 業界標準組合 (Shadcn/UI 同款)

3. **為何 Button 使用 Loading Spinner 而非 Disabled？**
   - ✅ 視覺回饋更佳 (使用者知道「處理中」)
   - ✅ 避免連點問題
   - ✅ 符合現代 Web App UX 標準

4. **為何使用 forwardRef for Input？**
   - ✅ 支援 React Hook Form (未來表單驗證)
   - ✅ 支援 focus() 等 DOM 操作
   - ✅ 遵循 React 最佳實踐

### Testing

**測試框架**: Vitest + React Testing Library

**測試範圍**:
1. ✅ Button 組件測試:
   - Renders with different variants (primary, secondary, outline)
   - Shows loading spinner when isLoading=true
   - Disabled when disabled=true or isLoading=true
   - Handles onClick events

2. ✅ Input 組件測試:
   - Renders with label and placeholder
   - Shows error message when error prop provided
   - Handles onChange events
   - ForwardRef works correctly

3. ✅ 視覺回歸測試:
   - Homepage snapshot test (確保佈局不意外改變)

**測試執行方式**:
```bash
# 執行所有測試
pnpm test

# 執行組件測試
pnpm test components/ui

# 測試涵蓋率報告
pnpm test --coverage
```

### 依賴關係

**前置條件**:
- ✅ Story 1.1 已完成 (Next.js 專案已初始化,Tailwind CSS 已安裝)

**新增依賴**:
```bash
pnpm add clsx tailwind-merge
```

**後續 Story 依賴**:
- Story 1.4: Health Check UI 會使用 Button 組件
- Story 2.1: Avatar Canvas 會使用相同的色彩系統
- Story 3.1: Chat Interface 會使用 Button + Input 組件

### 相容性注意事項

**瀏覽器支援**:
- Chrome 90+: 完整支援
- Edge 90+: 完整支援
- Safari 14+: 支援 (CSS Variables 可能需要 -webkit- prefix)
- Firefox 88+: 完整支援

**Tailwind JIT 模式**:
- Next.js 14 預設啟用 JIT (Just-In-Time)
- 動態 className 需要完整字串 (避免 `bg-${color}` 寫法)

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-14 | 1.0 | 建立 Story 1.3 草稿 | SM Agent |

---

## Dev Agent Record

*(此部分由 Dev Agent 在實作時填寫)*

### Agent Model Used
_待填寫_

### Debug Log References
_待填寫_

### Completion Notes List
_待填寫_

### File List
_待填寫_

---

## QA Results

*(此部分由 QA Agent 在審核時填寫)*

_待填寫_
