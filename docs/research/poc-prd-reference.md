# POC 產品需求文件（PRD）
## 3D Avatar 即時對話系統 - 概念驗證階段

**文件版本**: v1.0  
**建立日期**: 2025-10-14  
**負責人**: Product Manager (John)  
**專案類型**: POC（Proof of Concept）技術驗證

---

## 📋 文件目的

本 PRD 專為 **POC（概念驗證）階段** 設計，目的是：
1. 驗證核心技術可行性
2. 測試關鍵技術整合
3. 評估性能表現
4. 為後續產品化決策提供依據

**重要**: 此 POC 非完整產品，不包含生產級功能（如用戶管理、角色庫、多用戶支援等）。

---

## 🎯 POC 目標與成功標準

### 主要目標
驗證「即時 3D Avatar 對話系統」的技術可行性，確認以下核心技術能夠成功整合：
- 3D Avatar 即時渲染
- LLM 即時對話
- TTS 語音合成
- Lip Sync 嘴型同步
- （選做）STT 語音輸入

### 成功標準

| 標準項目 | 驗證指標 | 目標值 |
|---------|---------|--------|
| **技術可行性** | 所有核心功能可運作 | 100% |
| **3D 渲染** | 瀏覽器正常顯示 Avatar | 主流瀏覽器支援 |
| **渲染效能** | FPS（每秒幀數） | ≥ 30 FPS |
| **對話延遲** | 文字輸入到語音播放 | < 2 秒 |
| **Lip Sync 準確度** | 視覺上嘴型與語音同步 | ≥ 70% 匹配度 |
| **系統穩定性** | 連續對話不崩潰 | 10 輪對話無錯誤 |
| **瀏覽器相容性** | 主流瀏覽器測試 | Chrome, Edge, Safari |

### 失敗條件（若發生則 POC 失敗）
- ❌ 3D Avatar 無法在瀏覽器正常顯示
- ❌ 端到端延遲 > 5 秒（使用者體驗過差）
- ❌ Lip Sync 完全無法同步（視覺上不可接受）
- ❌ 渲染 FPS < 15（畫面明顯卡頓）

---

## 🔍 背景脈絡

### 專案起源
建立一個類似 **ANAM.ai** 的系統，實現真人般的 3D Avatar 即時對話體驗。

### 技術挑戰
1. **即時性**: 語音、渲染、LLM 的端到端延遲需控制在可接受範圍
2. **同步性**: 嘴型動畫必須與語音精確同步
3. **效能**: 3D 渲染需在一般設備流暢運行
4. **整合**: 多個異質服務（Azure OpenAI, Speech, 3D 引擎）需無縫整合

### Phase 1 研究結論（參考依據）
- ✅ 技術完全可行
- ✅ 推薦技術棧: Next.js + Three.js + Azure 服務
- ✅ 預估成本: NT$4,492/月（POC 階段）

---

## 🎬 核心功能定義（POC 範圍）

### 功能 1: 3D Avatar 顯示與基礎動畫 ⭐⭐⭐⭐⭐

**功能描述**:  
在網頁中顯示一個 3D Avatar，並能播放基本的待機動畫（如呼吸、眨眼）。

**使用者故事**:
> 作為一個使用者，我希望能在網頁上看到一個逼真的 3D 虛擬角色，並且角色會有自然的待機動作，讓我感覺像在與真人視訊。

**技術需求**:
- 使用 **Three.js** 渲染 3D 模型
- 整合 **Ready Player Me** 獲取 Avatar 模型
- 實作基本骨骼動畫（待機、呼吸、眨眼）
- 支援 WebGL 的瀏覽器

**驗收標準**:
- [ ] Avatar 在 Chrome, Edge, Safari 正常顯示
- [ ] 待機動畫流暢播放（FPS ≥ 30）
- [ ] 模型載入時間 < 5 秒
- [ ] 無 3D 渲染錯誤或黑畫面

**技術參考**（Phase 1 研究）:
- 使用 Ready Player Me 免費層（無需付費）
- React Three Fiber 簡化 Three.js 整合
- GLTF/GLB 格式模型

---

### 功能 2: LLM 即時對話（文字輸入） ⭐⭐⭐⭐⭐

**功能描述**:  
使用者透過文字輸入與 Avatar 對話，系統使用 LLM 生成回應。

**使用者故事**:
> 作為一個使用者，我希望能在輸入框輸入問題，Avatar 能理解我的問題並給出智能的回應。

**技術需求**:
- 整合 **Azure OpenAI Service (GPT-4 Turbo)**
- 實作 Server-Sent Events (SSE) 串流回應
- 顯示 LLM 回應文字（先不轉語音）
- 錯誤處理（API 失敗、超時）

**驗收標準**:
- [ ] 文字輸入後能獲得 LLM 回應
- [ ] 回應延遲 < 3 秒（首字元出現）
- [ ] 支援多輪對話（保留上下文）
- [ ] 錯誤時顯示友善提示訊息

**範例對話**:
```
使用者: 你好，你是誰？
Avatar: 你好！我是一個 AI 虛擬助手，很高興認識你。有什麼我可以幫助你的嗎？
```

---

### 功能 3: TTS 語音播放 ⭐⭐⭐⭐⭐

**功能描述**:  
將 LLM 的文字回應轉換為語音，並透過瀏覽器播放。

**使用者故事**:
> 作為一個使用者，我希望 Avatar 能用語音回答我的問題，而不只是顯示文字，讓對話更自然。

**技術需求**:
- 整合 **Azure Cognitive Services TTS**
- 選擇自然的繁體中文語音（Neural Voice）
- 實作音訊播放（Web Audio API）
- 音訊佇列管理（避免重疊）

**驗收標準**:
- [ ] LLM 回應自動轉為語音播放
- [ ] 語音清晰自然（非機械音）
- [ ] 音訊延遲 < 1 秒（文字到語音開始）
- [ ] 支援暫停/繼續播放（進階）

**語音參數**:
- 語言: zh-TW（繁體中文）
- 語音: Azure Neural Voice（如 zh-TW-HsiaoChenNeural）
- 語速: 正常（可調整）

---

### 功能 4: Lip Sync 嘴型同步 ⭐⭐⭐⭐

**功能描述**:  
Avatar 的嘴型動作與 TTS 語音精確同步，模擬真人說話效果。

**使用者故事**:
> 作為一個使用者，我希望看到 Avatar 說話時嘴巴會動，而不是像木偶一樣靜止不動。

**技術需求**:
- 使用 **Oculus Lipsync SDK** 或音素分析
- 分析 TTS 音訊產生 viseme 數據
- 驅動 3D 模型的嘴型 blendshapes
- 時間軸同步（音訊與動畫）

**驗收標準**:
- [ ] 嘴型動作與語音節奏一致
- [ ] 視覺上至少 70% 的音節匹配
- [ ] 無明顯延遲或不同步
- [ ] 支援繁體中文音素

**技術難點**:
- 繁體中文音素映射（與英文不同）
- 即時音素分析（低延遲）
- Blendshape 權重調整

---

### 功能 5: STT 語音輸入（選做，進階） ⭐⭐⭐

**功能描述**:  
使用者可以用語音（而非文字）與 Avatar 對話。

**使用者故事**:
> 作為一個使用者，我希望能直接說話與 Avatar 互動，而不用打字。

**技術需求**:
- 整合 **Web Speech API**（POC 階段）或 **Azure Speech STT**
- 即時語音辨識
- 將語音轉文字後送到 LLM

**驗收標準**:
- [ ] 語音輸入能正確轉為文字
- [ ] 支援繁體中文辨識
- [ ] 辨識準確率 ≥ 80%
- [ ] 辨識延遲 < 2 秒

**備註**: 此功能為「選做」，若時間不足可延後實作。

---

## 🚫 POC 範圍外（明確排除）

為專注於技術驗證，以下功能**不包含在 POC 中**：

### 不做的功能
- ❌ 用戶註冊/登入系統
- ❌ 個人化角色庫（儲存自訂 Avatar）
- ❌ 多用戶支援（僅單一測試用戶）
- ❌ 聊天記錄儲存
- ❌ Avatar 表情變化（情緒系統）
- ❌ 多語言切換（僅支援繁體中文）
- ❌ 行動裝置 App（僅網頁版）
- ❌ 付費/訂閱機制
- ❌ 進階安全性（僅基本 API 金鑰保護）
- ❌ 效能監控儀表板

### 不做的原因
這些功能屬於「產品化」階段，POC 的目標是驗證核心技術，而非建立完整產品。

---

## 🏗️ 技術架構概覽（簡化版）

### 技術棧決策（基於 Phase 1 研究）

| 層級 | 技術選擇 | 版本 | 用途 |
|-----|---------|------|------|
| **前端框架** | Next.js | 14 | React 全端框架 |
| **3D 渲染** | Three.js + React Three Fiber | 最新穩定版 | WebGL 渲染 |
| **Avatar** | Ready Player Me | 免費層 | 3D 模型來源 |
| **LLM** | Azure OpenAI | GPT-4 Turbo | 對話引擎 |
| **TTS** | Azure Cognitive Services | Neural Voice | 語音合成 |
| **STT（選做）** | Web Speech API | 瀏覽器原生 | 語音輸入 |
| **Lip Sync** | Oculus Lipsync | 開源 | 嘴型同步 |
| **狀態管理** | Zustand | 最新版 | React 狀態 |
| **部署** | Azure Static Web Apps | - | 託管平台 |

### 系統架構圖（簡化）

```
┌─────────────────────────────────────────────────┐
│                  使用者瀏覽器                      │
│                                                 │
│  ┌──────────────┐  ┌──────────────────────┐    │
│  │  使用者介面   │  │   3D Avatar 渲染層    │    │
│  │  (Next.js)   │  │   (Three.js)         │    │
│  └──────┬───────┘  └──────────┬───────────┘    │
│         │                     │                 │
│         ↓                     ↓                 │
│  ┌──────────────────────────────────────┐      │
│  │      狀態管理層 (Zustand)              │      │
│  └──────────────┬───────────────────────┘      │
│                 │                               │
└─────────────────┼───────────────────────────────┘
                  │
                  ↓ HTTPS/WebSocket
┌─────────────────────────────────────────────────┐
│           Next.js API Routes (後端)              │
│                                                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────┐ │
│  │ Azure OpenAI│  │ Azure Speech│  │ Lip Sync│ │
│  │  整合層      │  │  整合層      │  │ 處理器  │ │
│  └─────────────┘  └─────────────┘  └─────────┘ │
└─────────────────────────────────────────────────┘
                  │
                  ↓ Azure API
┌─────────────────────────────────────────────────┐
│              Azure 雲端服務                       │
│  ┌──────────────┐         ┌──────────────┐     │
│  │ Azure OpenAI │         │ Azure Speech │     │
│  │  Service     │         │  Services    │     │
│  └──────────────┘         └──────────────┘     │
└─────────────────────────────────────────────────┘
```

### 資料流程

**對話流程（文字輸入）**:
1. 使用者輸入文字 → Next.js 前端
2. 前端送出請求 → Next.js API Route
3. API Route → Azure OpenAI（SSE 串流）
4. LLM 回應 → API Route → 前端顯示
5. 前端文字 → Azure TTS API
6. TTS 返回音訊 → Web Audio 播放
7. 音訊分析 → Lip Sync 處理 → Avatar 嘴型動畫

**延遲目標**:
- 步驟 1-4: < 1.5 秒
- 步驟 5-6: < 0.8 秒
- 步驟 7: < 0.2 秒
- **總延遲**: < 2.5 秒

---

## 🎨 使用者介面（POC 簡化版）

### UI 組成（極簡設計）

```
┌─────────────────────────────────────────────────┐
│                    頁首                          │
│         POC: 3D Avatar 對話系統                  │
└─────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────┐
│                                                 │
│                                                 │
│           3D Avatar 顯示區域                     │
│                                                 │
│              (全螢幕 3D Canvas)                  │
│                                                 │
│                                                 │
└─────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────┐
│  對話記錄：                                       │
│  使用者: 你好                                     │
│  Avatar: 你好！很高興見到你                       │
└─────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────┐
│  [ 文字輸入框 ]              [🎤 語音] [送出]     │
└─────────────────────────────────────────────────┘
```

### 關鍵 UI 元素

1. **3D Avatar 顯示區**
   - 佔據主要畫面（60-70% 高度）
   - 深色背景突顯 Avatar
   - Loading 動畫（模型載入時）

2. **對話記錄區**
   - 顯示最近 5 則對話
   - 自動捲動到最新訊息
   - 簡單的文字氣泡

3. **輸入區**
   - 文字輸入框（主要）
   - 語音按鈕（選做）
   - 送出按鈕

4. **狀態指示器**
   - Loading: 「Avatar 思考中...」
   - Speaking: 「Avatar 說話中...」
   - Error: 「發生錯誤，請重試」

---

## 📊 非功能需求

### 效能需求

| 項目 | 目標 | 測試方式 |
|-----|------|---------|
| **3D 渲染 FPS** | ≥ 30 FPS | Chrome DevTools Performance |
| **LLM 首字延遲** | < 3 秒 | 手動計時 |
| **TTS 音訊延遲** | < 1 秒 | 手動計時 |
| **端到端延遲** | < 2.5 秒 | 完整流程計時 |
| **模型載入時間** | < 5 秒 | Network tab |
| **記憶體使用** | < 500 MB | Chrome Task Manager |

### 相容性需求

| 瀏覽器 | 版本 | 必須支援 |
|--------|------|---------|
| Chrome | 最新穩定版 | ✅ 是 |
| Edge | 最新穩定版 | ✅ 是 |
| Safari | 最新穩定版 | ✅ 是 |
| Firefox | 最新穩定版 | ⭐ 建議支援 |
| Mobile | - | ❌ 不支援（POC 階段）|

### 安全性需求（基本）

- ✅ HTTPS 連線
- ✅ Azure API 金鑰透過環境變數
- ✅ 不儲存用戶對話記錄
- ❌ 無用戶認證（POC 階段可接受）

---

## 🧪 測試計劃

### 功能測試清單

**3D Avatar 渲染測試**:
- [ ] Avatar 正常顯示（無黑畫面）
- [ ] 待機動畫流暢
- [ ] 不同瀏覽器測試

**LLM 對話測試**:
- [ ] 文字輸入獲得回應
- [ ] 多輪對話上下文正確
- [ ] 錯誤處理（API 失敗）

**TTS 語音測試**:
- [ ] 語音清晰自然
- [ ] 繁體中文正確發音
- [ ] 音訊播放穩定

**Lip Sync 測試**:
- [ ] 嘴型與語音同步
- [ ] 視覺匹配度 ≥ 70%
- [ ] 無明顯延遲

### 效能測試

**測試環境**:
- 裝置: 一般筆記型電腦（非高階遊戲機）
- 網路: 4G/家用寬頻
- 瀏覽器: Chrome 最新版

**測試案例**:
1. 連續對話 10 輪，記錄每輪延遲
2. 長時間運行（30 分鐘），檢查記憶體洩漏
3. 網路慢速模擬（3G），評估體驗

---

## 📅 開發時程（預估）

### Sprint 規劃（3-4 週）

| Sprint | 週次 | 主要任務 | 交付成果 |
|--------|-----|---------|---------|
| **Sprint 0** | 第 1 週 | 專案初始化、環境設定 | Next.js 專案 + Azure 設定 |
| **Sprint 1** | 第 1-2 週 | 3D Avatar 渲染 + 基礎動畫 | 可顯示 Avatar |
| **Sprint 2** | 第 2 週 | LLM 整合 + TTS 整合 | 文字對話 + 語音播放 |
| **Sprint 3** | 第 3 週 | Lip Sync 實作 | 嘴型同步功能 |
| **Sprint 4** | 第 3-4 週 | STT（選做）+ 整合測試 | 完整 POC 原型 |

### 里程碑

- **Week 1 End**: 專案架構完成，Avatar 可顯示
- **Week 2 End**: 文字對話 + 語音播放可運作
- **Week 3 End**: Lip Sync 基本完成
- **Week 4 End**: 完整 POC 驗證完成

---

## 💰 成本預估（POC 階段）

### Azure 服務成本（3 個月）

| 服務 | 月成本 | 3 個月總計 |
|-----|--------|-----------|
| Azure OpenAI | ~NT$ 1,600 | NT$ 4,800 |
| Azure Speech | ~NT$ 600 | NT$ 1,800 |
| Azure Static Web Apps | NT$ 0 | NT$ 0 |
| **總計** | **NT$ 2,200** | **NT$ 6,600** |

### 第三方服務
- Ready Player Me: 免費層（NT$ 0）

### 開發人力（假設外包）
- 全端工程師: 4 週 x NT$ 80,000/週 = **NT$ 320,000**

### POC 總成本
- **雲端成本**: NT$ 6,600
- **人力成本**: NT$ 320,000
- **總計**: **NT$ 326,600**（約 USD $10,200）

---

## ⚠️ 風險與應對

### 技術風險

| 風險 | 機率 | 影響 | 應對策略 |
|-----|------|------|---------|
| Lip Sync 準確度不足 | 中 | 高 | 備選方案: 關閉 Lip Sync，僅播放語音 |
| 3D 渲染效能差 | 低 | 高 | 降低模型精度，調整 LOD |
| Azure API 超支 | 中 | 中 | 設定成本警報，限制測試次數 |
| 瀏覽器相容性問題 | 低 | 中 | 提供 Polyfill，降級為 2D Avatar |

### 時程風險

| 風險 | 機率 | 應對策略 |
|-----|------|---------|
| Lip Sync 開發超時 | 高 | 將 Lip Sync 設為 Sprint 3，可選做 |
| Azure 整合困難 | 中 | 預留 Debug 時間，參考官方範例 |

---

## 📝 驗收與下一步

### POC 驗收會議

**參與者**: PM, 技術主管, 投資人（若適用）

**驗收項目**:
1. ✅ 展示 3D Avatar 顯示與動畫
2. ✅ 展示文字對話功能
3. ✅ 展示 TTS 語音播放
4. ✅ 展示 Lip Sync 效果
5. ✅ 報告效能測試結果
6. ✅ 報告成本與時程

### 決策點

**若 POC 成功（符合成功標準）**:
- ➡️ 進入 MVP 開發階段
- ➡️ 撰寫完整 PRD（包含產品化功能）
- ➡️ 規劃使用者測試與市場驗證

**若 POC 部分成功（核心功能可行，但有瑕疵）**:
- ➡️ 優化特定功能（如 Lip Sync）
- ➡️ 調整技術方案（如改用其他 TTS）
- ➡️ 延長 POC 時間 1-2 週

**若 POC 失敗（無法達成核心功能）**:
- ➡️ 分析失敗原因
- ➡️ 評估替代技術方案
- ➡️ 重新評估專案可行性

---

## 附錄

### A. 參考文件
- `docs/tech-research.md` - 技術研究報告
- `docs/tech-comparison-matrix.md` - 技術方案對照
- `docs/cost-analysis.md` - 成本分析

### B. 相關資源
- [Ready Player Me 文件](https://docs.readyplayer.me/)
- [Azure OpenAI 快速開始](https://learn.microsoft.com/azure/ai-services/openai/)
- [Three.js 官方教學](https://threejs.org/docs/)

### C. 專案術語
- **POC**: Proof of Concept，概念驗證
- **Lip Sync**: Lip Synchronization，嘴型同步
- **TTS**: Text-to-Speech，文字轉語音
- **STT**: Speech-to-Text，語音轉文字
- **Viseme**: 視覺音素，嘴型的基本單位
- **Blendshape**: 3D 模型的形變權重

---

**文件狀態**: ✅ 完成  
**下一步**: 由 Architect 設計詳細技術架構（`docs/poc-architecture.md`）  
**最後更新**: 2025-10-14

