# Story 1.1: Next.js 專案初始化與開發環境設定

## Status
Approved

---

## Story

**As a** 開發者,  
**I want** 建立一個配置完善的 Next.js 14 專案（App Router + TypeScript），  
**so that** 我可以在穩定的開發環境中開始功能開發。

---

## Acceptance Criteria

1. 使用 `create-next-app@latest` 建立 Next.js 14 專案，啟用 TypeScript、App Router、Tailwind CSS
2. 專案結構符合 BMad 最佳實踐：`app/`, `components/`, `lib/`, `types/`, `public/` 目錄已建立
3. 安裝並配置 ESLint + Prettier，執行 `pnpm lint` 無錯誤
4. 配置 `tsconfig.json`，啟用嚴格模式（`strict: true`）
5. 建立 `.env.local.example` 示範環境變數檔案
6. 建立 `README.md` 包含專案說明、安裝步驟、執行指令
7. 執行 `pnpm dev`，專案在 `http://localhost:3000` 正常啟動
8. Git 初始化，首次 commit 完成

---

## Tasks / Subtasks

- [ ] **Task 1: Next.js 專案初始化** (AC: 1, 2)
  - [ ] 執行 `npx create-next-app@latest avatar-chat-poc --typescript --tailwind --app --import-alias "@/*"`
  - [ ] 驗證專案建立成功，確認 Next.js 14, TypeScript, Tailwind CSS 已啟用
  - [ ] 檢查專案結構，確認 `app/` 目錄使用 App Router
  - [ ] 建立缺少的目錄：`components/`, `lib/`, `types/`, `public/`（如未自動生成）
  - [ ] 刪除 `create-next-app` 預設的範例頁面內容（保留檔案結構）

- [ ] **Task 2: 開發工具鏈配置** (AC: 3)
  - [ ] 安裝 ESLint 與 Prettier：`pnpm add -D prettier eslint-config-prettier`
  - [ ] 建立 `.prettierrc` 配置檔案（設定：單引號、2 空格縮排、尾逗號 es5）
  - [ ] 建立 `.eslintrc.json`，擴展 Next.js 預設配置 + Prettier 整合
  - [ ] 在 `package.json` 新增腳本：`"format": "prettier --write \"**/*.{ts,tsx,js,jsx,json,md}\""`
  - [ ] 執行 `pnpm lint` 與 `pnpm format`，確認無錯誤

- [ ] **Task 3: TypeScript 嚴格模式配置** (AC: 4)
  - [ ] 修改 `tsconfig.json`，設定 `"strict": true`
  - [ ] 檢查所有自動生成的檔案，修正因嚴格模式產生的型別錯誤（如有）
  - [ ] 執行 `pnpm build` 驗證 TypeScript 編譯成功

- [ ] **Task 4: 環境變數與文件準備** (AC: 5, 6)
  - [ ] 建立 `.env.local.example` 檔案，包含：
    ```
    # Azure OpenAI
    AZURE_OPENAI_API_KEY=your_key_here
    AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com/
    AZURE_OPENAI_DEPLOYMENT_NAME=gpt-4-turbo
    
    # Azure Speech Services
    AZURE_SPEECH_KEY=your_key_here
    AZURE_SPEECH_REGION=eastasia
    ```
  - [ ] 建立 `README.md`，包含以下內容：
    - 專案簡介：「3D Avatar 即時對話系統 - POC 階段」
    - 技術棧：Next.js 14, TypeScript, Tailwind CSS, Three.js, Azure Services
    - 安裝步驟：`pnpm install`, 設定 `.env.local`, `pnpm dev`
    - 執行指令：開發、建置、測試
    - 專案結構說明（簡要）
  - [ ] 將 `.env.local` 加入 `.gitignore`（確認已存在）

- [ ] **Task 5: 本地執行驗證** (AC: 7)
  - [ ] 安裝 pnpm (如未安裝)：`npm install -g pnpm`
  - [ ] 執行 `pnpm install` 安裝所有依賴
  - [ ] 執行 `pnpm dev`
  - [ ] 在瀏覽器開啟 `http://localhost:3000`
  - [ ] 驗證 Next.js 預設頁面正常顯示
  - [ ] 檢查終端機無錯誤訊息

- [ ] **Task 6: Git 初始化與首次提交** (AC: 8)
  - [ ] 執行 `git init`（如尚未初始化）
  - [ ] 執行 `git add .`
  - [ ] 執行 `git commit -m "feat: 初始化 Next.js 14 專案（TypeScript + Tailwind CSS + App Router）"`
  - [ ] 驗證 commit 成功，檢查 `git log`

---

## Dev Notes

### 相關來源樹（Source Tree）

根據架構文件，專案目錄結構應如下：

```
avatar-chat-poc/                    # 專案根目錄
├── app/                            # Next.js App Router 目錄
│   ├── layout.tsx                  # 根佈局
│   ├── page.tsx                    # 首頁
│   ├── globals.css                 # 全域樣式
│   └── api/                        # API Routes（後續新增）
├── components/                     # React 組件
│   ├── ui/                         # 通用 UI 組件（後續新增）
│   └── avatar/                     # Avatar 相關組件（後續新增）
├── lib/                            # 工具函式與配置
│   ├── azure/                      # Azure 服務客戶端（後續新增）
│   └── utils/                      # 通用工具函式（後續新增）
├── types/                          # TypeScript 型別定義
├── public/                         # 靜態資源
├── .env.local.example              # 環境變數範例
├── .eslintrc.json                  # ESLint 配置
├── .prettierrc                     # Prettier 配置
├── tsconfig.json                   # TypeScript 配置
├── tailwind.config.ts              # Tailwind CSS 配置
├── next.config.js                  # Next.js 配置
├── package.json                    # 專案依賴
└── README.md                       # 專案說明
```

### 技術棧詳細資訊

**核心框架**:
- **Next.js**: 14.2+ (App Router)
- **TypeScript**: 5.3+
- **Tailwind CSS**: 3.4+

**開發工具**:
- **ESLint**: Next.js 預設配置 + Prettier 整合
- **Prettier**: 程式碼格式化（單引號、2 空格、尾逗號 es5）

**環境變數管理**:
- 使用 `.env.local` 儲存敏感資訊（本地開發）
- 使用 `.env.local.example` 提供範例（版控）
- Next.js 自動載入環境變數（`process.env.VARIABLE_NAME`）

**專案初始化指令**（來自架構文件）:
```bash
npx create-next-app@latest avatar-chat-poc \
  --typescript \
  --tailwind \
  --app \
  --import-alias "@/*"
```

### 重要架構決策

1. **App Router vs Pages Router**: 
   - 使用 Next.js 14 **App Router**（非 Pages Router）
   - 原因：更現代、支援 React Server Components、更好的佈局系統

2. **TypeScript 嚴格模式**:
   - 啟用 `"strict": true`
   - 強制型別安全，減少執行時錯誤

3. **Monorepo 結構**:
   - POC 階段使用簡化的 Monorepo（僅 `apps/web` + `packages/shared`）
   - 本 Story 僅初始化 `apps/web`（Next.js 主應用）
   - 後續 Story 會建立 `packages/shared`（共享型別）

4. **Import Alias**:
   - 使用 `@/*` 作為專案根目錄別名
   - 範例：`import { Button } from '@/components/ui/Button'`

### Testing

**測試框架**: Jest + React Testing Library

**測試標準**（來自架構文件）:
- **單元測試**: 使用 Jest 測試工具函式與組件邏輯
- **測試檔案位置**: `__tests__/` 或 `.test.ts/.test.tsx`（與源碼同目錄）
- **測試命名**: 描述性命名，使用 `describe` 與 `it` 區塊

**本 Story 測試要求**:
- ✅ 驗證專案結構存在（檢查目錄與關鍵檔案）
- ✅ 驗證 ESLint 與 Prettier 配置正確
- ✅ 驗證 TypeScript 編譯無錯誤（`pnpm build`）
- ✅ 驗證本地開發伺服器啟動成功（`pnpm dev`）

**測試執行方式**:
```bash
# 執行所有測試
pnpm test

# 執行特定測試檔案
pnpm test __tests__/setup.test.ts

# 測試涵蓋率報告
pnpm test --coverage
```

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-14 | 1.0 | 建立 Story 1.1 草稿 | SM Agent |

---

## Dev Agent Record

*(此部分由 Dev Agent 在實作時填寫)*

### Agent Model Used
_待填寫_

### Debug Log References
_待填寫_

### Completion Notes List
_待填寫_

### File List
_待填寫_

---

## QA Results

*(此部分由 QA Agent 在審核時填寫)*

_待填寫_

