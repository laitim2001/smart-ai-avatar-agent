# Story 5.3: UI/UX ç´°ç¯€æ‰“ç£¨

**Epic**: Epic 5 - Polish & Deployment
**Story ID**: 5.3
**Story åç¨±**: UI/UX ç´°ç¯€æ‰“ç£¨
**å„ªå…ˆé †åº**: Medium
**é ä¼°æ™‚é–“**: 7 å°æ™‚
**ç‹€æ…‹**: Draft

---

## ğŸ“‹ Story æè¿°

### User Story
**As a** ä½¿ç”¨è€…
**I want** ä»‹é¢ç¾è§€ã€å‹•ç•«æµæš¢ã€äº’å‹•ç´°ç¯€å®Œå–„
**So that** æˆ‘èƒ½äº«å—å°ˆæ¥­ç´šçš„æ‡‰ç”¨ç¨‹å¼é«”é©—ï¼Œè€ŒéåŠæˆå“æ„Ÿè¦º

### Business Value
- **å°ˆæ¥­å½¢è±¡**: ç²¾ç·»çš„ UI/UX æå‡ç”¢å“å°ˆæ¥­åº¦ï¼Œå¢å¼·ä½¿ç”¨è€…ä¿¡ä»»
- **ä½¿ç”¨é«”é©—**: æµæš¢çš„å‹•ç•«èˆ‡éæ¸¡æ•ˆæœè®“æ‡‰ç”¨ç¨‹å¼æ„Ÿè¦ºæ›´å¿«ã€æ›´è‡ªç„¶
- **ç´°ç¯€å®Œå–„**: èšç„¦ç‹€æ…‹ã€Hover æ•ˆæœã€éæ¸¡å‹•ç•«ç­‰ç´°ç¯€è®“æ‡‰ç”¨ç¨‹å¼æ›´ç²¾ç·»
- **å“ç‰Œä¸€è‡´æ€§**: çµ±ä¸€çš„è¨­è¨ˆèªè¨€èˆ‡è¦–è¦ºé¢¨æ ¼å»ºç«‹å“ç‰Œè­˜åˆ¥åº¦

### Technical Context
- **CSS Transitions**: ä½¿ç”¨ CSS transition å¯¦ç¾æµæš¢çš„ç‹€æ…‹éæ¸¡
- **Framer Motion**: é€²éšå‹•ç•«åº«ï¼Œæä¾›è²æ˜å¼å‹•ç•« API
- **Responsive Design**: é©é… Desktop/Tablet/Mobile ä¸‰ç¨®è£ç½®
- **Accessibility**: ç¢ºä¿å‹•ç•«ä¸å½±éŸ¿éµç›¤å°èˆªã€screen reader

---

## âœ… Acceptance Criteria

### Functional Requirements
1. **èŠå¤©ä»‹é¢å‹•ç•«**:
   - [ ] è¨Šæ¯é€å‡ºæ™‚æœ‰ Fade-in + Slide-up å‹•ç•«
   - [ ] è¼¸å…¥æ¡†èšç„¦æ™‚æœ‰å¾®å¦™çš„æ”¾å¤§å‹•ç•«ï¼ˆscale 1.02ï¼‰
   - [ ] é€å‡ºæŒ‰éˆ• Hover æ™‚é¡è‰²éæ¸¡æµæš¢ï¼ˆ300msï¼‰
   - [ ] è¨Šæ¯æ¸…å–®æ»¾å‹•å¹³æ»‘ï¼ˆsmooth scroll behaviorï¼‰

2. **Avatar äº’å‹•ç´°ç¯€**:
   - [ ] Avatar é–’ç½®æ™‚æœ‰å¾®å¦™çš„å‘¼å¸å‹•ç•«ï¼ˆY è»¸ä¸Šä¸‹ 0.02 å–®ä½ï¼‰
   - [ ] Avatar èªªè©±æ™‚æœ‰ Bounce å‹•ç•«
   - [ ] 3D å ´æ™¯èƒŒæ™¯é¡è‰²å¯è‡ªè¨‚ï¼ˆæ·ºè‰²/æ·±è‰²æ¨¡å¼ï¼‰
   - [ ] OrbitControls é˜»å°¼æ•ˆæœï¼ˆdamping enabledï¼‰

3. **éŸ¿æ‡‰å¼è¨­è¨ˆ**:
   - [ ] Desktop (â‰¥1024px): å·¦å³åˆ†æ¬„ä½ˆå±€ï¼ˆAvatar å·¦å´ï¼ŒChat å³å´ï¼‰
   - [ ] Tablet (768-1023px): ä¸Šä¸‹ä½ˆå±€ï¼ˆAvatar ä¸Šæ–¹ï¼ŒChat ä¸‹æ–¹ï¼‰
   - [ ] Mobile (â‰¤767px): å…¨è¢å¹• Avatarï¼ŒChat æµ®å‹•åœ¨åº•éƒ¨
   - [ ] æ‰€æœ‰æ–·é»éæ¸¡æµæš¢ï¼ˆç„¡çªç„¶è·³å‹•ï¼‰

4. **Accessibility**:
   - [ ] æ‰€æœ‰äº’å‹•å…ƒç´ èšç„¦æ™‚æœ‰æ˜é¡¯çš„ focus ring
   - [ ] æ”¯æ´ `prefers-reduced-motion` åª’é«”æŸ¥è©¢ï¼ˆå‹•ç•«ç°¡åŒ–ï¼‰
   - [ ] é¡è‰²å°æ¯”åº¦ç¬¦åˆ WCAG AA æ¨™æº–ï¼ˆâ‰¥4.5:1ï¼‰
   - [ ] éµç›¤å°èˆªé †åºåˆç†ï¼ˆTab orderï¼‰

### Non-Functional Requirements
1. **æ•ˆèƒ½**: å‹•ç•«ä¸å½±éŸ¿ FPSï¼Œç¶­æŒ â‰¥ 30 FPS
2. **æµæš¢åº¦**: æ‰€æœ‰éæ¸¡å‹•ç•«åœ¨ 60 FPS ä¸‹æ’­æ”¾
3. **è¼‰å…¥æ™‚é–“**: UI è³‡æºï¼ˆCSS, fontsï¼‰â‰¤ 50KB
4. **ç›¸å®¹æ€§**: æ”¯æ´ Chrome, Edge, Safari, Firefox æœ€æ–°ç‰ˆæœ¬

---

## ğŸ—ï¸ Technical Design

### Animation Strategy

```
Animation Types:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Micro-Interactions (CSS Transitions)            â”‚
â”‚    - Button hover effects                          â”‚
â”‚    - Input focus states                            â”‚
â”‚    - Link underlines                               â”‚
â”‚    Duration: 200-300ms                             â”‚
â”‚    Easing: ease-in-out                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. UI Animations (Framer Motion)                   â”‚
â”‚    - Message fade-in/slide-up                      â”‚
â”‚    - Modal enter/exit                              â”‚
â”‚    - Toast notifications                           â”‚
â”‚    Duration: 300-500ms                             â”‚
â”‚    Easing: spring, easeOut                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. 3D Animations (Three.js useFrame)               â”‚
â”‚    - Avatar breathing animation                    â”‚
â”‚    - Avatar bounce on speech                       â”‚
â”‚    - Camera smooth follow                          â”‚
â”‚    Duration: Continuous loop                       â”‚
â”‚    Easing: Sine wave, damping                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Responsive Breakpoints

```typescript
export const BREAKPOINTS = {
  mobile: 0,      // 0-767px
  tablet: 768,    // 768-1023px
  desktop: 1024,  // 1024px+
} as const;

// Tailwind CSS config
module.exports = {
  theme: {
    screens: {
      'sm': '640px',
      'md': '768px',
      'lg': '1024px',
      'xl': '1280px',
    },
  },
};
```

### Layout Patterns

**Desktop (â‰¥1024px)**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Header                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      â”‚                          â”‚
â”‚   Avatar Canvas      â”‚    Chat Interface        â”‚
â”‚   (50% width)        â”‚    (50% width)           â”‚
â”‚                      â”‚                          â”‚
â”‚   3D Scene           â”‚    Messages              â”‚
â”‚   OrbitControls      â”‚    Input Field           â”‚
â”‚                      â”‚    Send Button           â”‚
â”‚                      â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Mobile (â‰¤767px)**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Avatar Canvas                      â”‚
â”‚              (Full screen)                      â”‚
â”‚                                                 â”‚
â”‚              3D Scene                           â”‚
â”‚                                                 â”‚
â”‚                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    Chat Interface (Fixed bottom overlay)        â”‚
â”‚    Input Field | Send Button                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Tasks

### Task 1: å»ºç«‹å…¨åŸŸ CSS Variables èˆ‡ Design Tokens

**æè¿°**: å®šç¾©è¨­è¨ˆç³»çµ±çš„æ ¸å¿ƒè®Šæ•¸ï¼ˆé¡è‰²ã€é–“è·ã€å­—å‹ã€éæ¸¡æ™‚é–“ï¼‰

**æª”æ¡ˆ**: `src/styles/design-tokens.css`, `tailwind.config.ts`

**ç¨‹å¼ç¢¼å¯¦ä½œ (CSS Variables)**:
```css
/* src/styles/design-tokens.css */
:root {
  /* Colors - Primary */
  --color-primary: #007bff;
  --color-primary-hover: #0056b3;
  --color-primary-active: #004085;

  /* Colors - Neutral */
  --color-background: #ffffff;
  --color-surface: #f8f9fa;
  --color-border: #dee2e6;
  --color-text-primary: #212529;
  --color-text-secondary: #6c757d;

  /* Colors - Semantic */
  --color-success: #28a745;
  --color-error: #dc3545;
  --color-warning: #ffc107;
  --color-info: #17a2b8;

  /* Spacing */
  --spacing-xs: 4px;
  --spacing-sm: 8px;
  --spacing-md: 16px;
  --spacing-lg: 24px;
  --spacing-xl: 32px;
  --spacing-2xl: 48px;

  /* Typography */
  --font-family-base: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  --font-size-xs: 12px;
  --font-size-sm: 14px;
  --font-size-md: 16px;
  --font-size-lg: 18px;
  --font-size-xl: 24px;
  --font-weight-regular: 400;
  --font-weight-medium: 500;
  --font-weight-bold: 700;

  /* Border Radius */
  --radius-sm: 4px;
  --radius-md: 8px;
  --radius-lg: 12px;
  --radius-full: 9999px;

  /* Shadows */
  --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
  --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
  --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
  --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.15);

  /* Transitions */
  --transition-fast: 150ms ease-in-out;
  --transition-base: 300ms ease-in-out;
  --transition-slow: 500ms ease-in-out;

  /* Z-Index */
  --z-dropdown: 1000;
  --z-sticky: 1020;
  --z-fixed: 1030;
  --z-modal-backdrop: 1040;
  --z-modal: 1050;
  --z-tooltip: 1070;
  --z-toast: 9999;
}

/* Dark Mode (optional for MVP, included for future) */
[data-theme='dark'] {
  --color-background: #1a1a1a;
  --color-surface: #2a2a2a;
  --color-border: #3a3a3a;
  --color-text-primary: #ffffff;
  --color-text-secondary: #aaaaaa;
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* Global Styles */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: var(--font-family-base);
  font-size: var(--font-size-md);
  line-height: 1.5;
  color: var(--color-text-primary);
  background-color: var(--color-background);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Focus Styles */
:focus-visible {
  outline: 2px solid var(--color-primary);
  outline-offset: 2px;
}

button:focus-visible,
input:focus-visible,
textarea:focus-visible {
  outline: 2px solid var(--color-primary);
  outline-offset: 2px;
}

/* Smooth Scroll */
html {
  scroll-behavior: smooth;
}
```

**Tailwind Config**:
```typescript
// tailwind.config.ts
import type { Config } from 'tailwindcss';

const config: Config = {
  content: [
    './src/pages/**/*.{js,ts,jsx,tsx,mdx}',
    './src/components/**/*.{js,ts,jsx,tsx,mdx}',
    './src/app/**/*.{js,ts,jsx,tsx,mdx}',
  ],
  theme: {
    extend: {
      colors: {
        primary: {
          DEFAULT: 'var(--color-primary)',
          hover: 'var(--color-primary-hover)',
          active: 'var(--color-primary-active)',
        },
        neutral: {
          background: 'var(--color-background)',
          surface: 'var(--color-surface)',
          border: 'var(--color-border)',
        },
        text: {
          primary: 'var(--color-text-primary)',
          secondary: 'var(--color-text-secondary)',
        },
      },
      spacing: {
        xs: 'var(--spacing-xs)',
        sm: 'var(--spacing-sm)',
        md: 'var(--spacing-md)',
        lg: 'var(--spacing-lg)',
        xl: 'var(--spacing-xl)',
        '2xl': 'var(--spacing-2xl)',
      },
      borderRadius: {
        sm: 'var(--radius-sm)',
        md: 'var(--radius-md)',
        lg: 'var(--radius-lg)',
        full: 'var(--radius-full)',
      },
      boxShadow: {
        sm: 'var(--shadow-sm)',
        md: 'var(--shadow-md)',
        lg: 'var(--shadow-lg)',
        xl: 'var(--shadow-xl)',
      },
      transitionDuration: {
        fast: '150ms',
        base: '300ms',
        slow: '500ms',
      },
    },
  },
  plugins: [],
};

export default config;
```

**Import in Layout**:
```typescript
// src/app/layout.tsx
import '@/styles/design-tokens.css';
import '@/styles/globals.css';
```

**é©—è­‰æ–¹å¼**:
- [ ] CSS variables æ­£ç¢ºè¼‰å…¥ï¼ˆChrome DevTools â†’ Stylesï¼‰
- [ ] Tailwind utilities å¯æ­£å¸¸ä½¿ç”¨ï¼ˆä¾‹å¦‚ `bg-primary`, `text-primary`ï¼‰
- [ ] Dark mode è®Šæ•¸å®šç¾©å®Œæ•´ï¼ˆæœªä¾†æ“´å±•ï¼‰
- [ ] Focus styles åœ¨æ‰€æœ‰äº’å‹•å…ƒç´ æ­£ç¢ºé¡¯ç¤º

---

### Task 2: èŠå¤©ä»‹é¢å‹•ç•«ï¼ˆFramer Motionï¼‰

**æè¿°**: ç‚º ChatInterface åŠ å…¥è¨Šæ¯ Fade-in/Slide-up å‹•ç•«ã€è¼¸å…¥æ¡† Focus å‹•ç•«

**æª”æ¡ˆ**: `src/components/chat/ChatInterface.tsx`

**å®‰è£ä¾è³´**:
```bash
npm install framer-motion
```

**ç¨‹å¼ç¢¼å¯¦ä½œ**:
```typescript
'use client';

import React, { useState, useRef, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';

interface Message {
  id: string;
  role: 'user' | 'assistant';
  content: string;
  timestamp: number;
}

export function ChatInterface() {
  const [messages, setMessages] = useState<Message[]>([]);
  const [input, setInput] = useState('');
  const [isSending, setIsSending] = useState(false);
  const messagesEndRef = useRef<HTMLDivElement>(null);

  // Auto-scroll to bottom when new message
  useEffect(() => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [messages]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!input.trim() || isSending) return;

    const userMessage: Message = {
      id: `user-${Date.now()}`,
      role: 'user',
      content: input,
      timestamp: Date.now(),
    };

    setMessages((prev) => [...prev, userMessage]);
    setInput('');
    setIsSending(true);

    // Simulate assistant response (replace with actual TTS logic)
    setTimeout(() => {
      const assistantMessage: Message = {
        id: `assistant-${Date.now()}`,
        role: 'assistant',
        content: `æ”¶åˆ°æ‚¨çš„è¨Šæ¯: "${input}"`,
        timestamp: Date.now(),
      };
      setMessages((prev) => [...prev, assistantMessage]);
      setIsSending(false);
    }, 1500);
  };

  return (
    <div className="fixed bottom-0 right-0 w-full md:w-1/2 lg:w-1/2 h-screen md:h-auto lg:h-screen flex flex-col bg-white">
      {/* Messages Container */}
      <div className="flex-1 overflow-y-auto p-4 space-y-4">
        <AnimatePresence initial={false}>
          {messages.map((message) => (
            <motion.div
              key={message.id}
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: -20 }}
              transition={{ duration: 0.3, ease: 'easeOut' }}
              className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}
            >
              <div
                className={`max-w-[70%] px-4 py-3 rounded-lg ${
                  message.role === 'user'
                    ? 'bg-primary text-white'
                    : 'bg-neutral-surface text-text-primary'
                }`}
                style={{
                  boxShadow: 'var(--shadow-sm)',
                }}
              >
                <p className="text-sm">{message.content}</p>
                <span className="text-xs opacity-70 mt-1 block">
                  {new Date(message.timestamp).toLocaleTimeString('zh-TW', {
                    hour: '2-digit',
                    minute: '2-digit',
                  })}
                </span>
              </div>
            </motion.div>
          ))}
        </AnimatePresence>
        <div ref={messagesEndRef} />
      </div>

      {/* Input Container */}
      <motion.div
        className="p-4 border-t border-neutral-border bg-white"
        initial={{ y: 100 }}
        animate={{ y: 0 }}
        transition={{ duration: 0.5, ease: 'easeOut' }}
      >
        <form onSubmit={handleSubmit} className="flex gap-3">
          <motion.input
            type="text"
            value={input}
            onChange={(e) => setInput(e.target.value)}
            placeholder="è¼¸å…¥è¨Šæ¯..."
            disabled={isSending}
            className="flex-1 px-4 py-3 text-md border border-neutral-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all"
            whileFocus={{ scale: 1.02 }}
            transition={{ duration: 0.2 }}
          />
          <motion.button
            type="submit"
            disabled={isSending || !input.trim()}
            className="px-6 py-3 bg-primary text-white rounded-lg font-medium disabled:bg-neutral-border disabled:cursor-not-allowed"
            whileHover={{ scale: 1.05 }}
            whileTap={{ scale: 0.95 }}
            transition={{ duration: 0.2 }}
          >
            {isSending ? (
              <span className="flex items-center gap-2">
                <motion.div
                  className="w-4 h-4 border-2 border-white border-t-transparent rounded-full"
                  animate={{ rotate: 360 }}
                  transition={{ duration: 1, repeat: Infinity, ease: 'linear' }}
                />
                é€å‡ºä¸­
              </span>
            ) : (
              'é€å‡º'
            )}
          </motion.button>
        </form>
      </motion.div>
    </div>
  );
}
```

**é©—è­‰æ–¹å¼**:
- [ ] æ–°è¨Šæ¯å‡ºç¾æ™‚æœ‰ Fade-in + Slide-up å‹•ç•«ï¼ˆ300msï¼‰
- [ ] è¼¸å…¥æ¡†èšç„¦æ™‚æœ‰å¾®å¦™çš„æ”¾å¤§æ•ˆæœï¼ˆscale 1.02ï¼‰
- [ ] é€å‡ºæŒ‰éˆ• Hover æ™‚æœ‰æ”¾å¤§æ•ˆæœï¼ˆscale 1.05ï¼‰
- [ ] é€å‡ºæŒ‰éˆ•é»æ“Šæ™‚æœ‰æŒ‰ä¸‹æ•ˆæœï¼ˆscale 0.95ï¼‰
- [ ] è¨Šæ¯æ¸…å–®è‡ªå‹•æ»¾å‹•åˆ°åº•éƒ¨ï¼ˆsmooth scrollï¼‰
- [ ] æ”¯æ´ prefers-reduced-motionï¼ˆå‹•ç•«ç°¡åŒ–ï¼‰

---

### Task 3: Avatar é–’ç½®å‘¼å¸å‹•ç•«

**æè¿°**: åœ¨ Avatar é–’ç½®æ™‚åŠ å…¥å¾®å¦™çš„ä¸Šä¸‹æµ®å‹•å‘¼å¸å‹•ç•«

**æª”æ¡ˆ**: `src/components/avatar/AvatarModel.tsx`

**ç¨‹å¼ç¢¼å¯¦ä½œ**:
```typescript
'use client';

import React, { useRef, useEffect } from 'react';
import { useFrame } from '@react-three/fiber';
import { Group } from 'three';

interface AvatarModelProps {
  isIdle?: boolean; // æ˜¯å¦é–’ç½®ï¼ˆç„¡å°è©±ï¼‰
  isSpeaking?: boolean; // æ˜¯å¦æ­£åœ¨èªªè©±
}

export function AvatarModel({ isIdle = true, isSpeaking = false }: AvatarModelProps) {
  const avatarRef = useRef<Group>(null);
  const timeRef = useRef(0);

  useFrame((state, delta) => {
    if (!avatarRef.current) return;

    timeRef.current += delta;

    if (isSpeaking) {
      // Speaking animation: Bounce effect
      const bounceIntensity = 0.05;
      const bounceSpeed = 10;
      const bounce = Math.sin(timeRef.current * bounceSpeed) * bounceIntensity;
      avatarRef.current.position.y = bounce;
    } else if (isIdle) {
      // Idle animation: Breathing effect (slow up-down)
      const breathingIntensity = 0.02;
      const breathingSpeed = 1.5; // Slow breathing
      const breathing = Math.sin(timeRef.current * breathingSpeed) * breathingIntensity;
      avatarRef.current.position.y = breathing;
    } else {
      // No animation
      avatarRef.current.position.y = 0;
    }
  });

  return (
    <group ref={avatarRef}>
      {/* Avatar mesh will be loaded here */}
      <mesh>
        <boxGeometry args={[1, 2, 1]} />
        <meshStandardMaterial color="#7b68ee" />
      </mesh>
    </group>
  );
}
```

**é€²éšç‰ˆï¼ˆBlendshape + çœ¨çœ¼å‹•ç•«ï¼‰**:
```typescript
'use client';

import React, { useRef, useEffect } from 'react';
import { useFrame } from '@react-three/fiber';
import { Group, Mesh, SkinnedMesh } from 'three';

interface AvatarModelProps {
  isIdle?: boolean;
  isSpeaking?: boolean;
  avatarMesh?: SkinnedMesh; // VRM model's mesh with blendshapes
}

export function AvatarModel({ isIdle = true, isSpeaking = false, avatarMesh }: AvatarModelProps) {
  const avatarRef = useRef<Group>(null);
  const timeRef = useRef(0);
  const blinkTimeRef = useRef(0);

  useFrame((state, delta) => {
    if (!avatarRef.current) return;

    timeRef.current += delta;
    blinkTimeRef.current += delta;

    // Position animation (breathing/bounce)
    if (isSpeaking) {
      const bounceIntensity = 0.05;
      const bounceSpeed = 10;
      const bounce = Math.sin(timeRef.current * bounceSpeed) * bounceIntensity;
      avatarRef.current.position.y = bounce;
    } else if (isIdle) {
      const breathingIntensity = 0.02;
      const breathingSpeed = 1.5;
      const breathing = Math.sin(timeRef.current * breathingSpeed) * breathingIntensity;
      avatarRef.current.position.y = breathing;
    }

    // Blinking animation (if avatar has blendshapes)
    if (avatarMesh && avatarMesh.morphTargetDictionary) {
      const blinkIndex = avatarMesh.morphTargetDictionary['blink'];
      if (blinkIndex !== undefined && avatarMesh.morphTargetInfluences) {
        // Blink every 3-5 seconds
        const blinkInterval = 4; // seconds
        const blinkDuration = 0.15; // seconds

        if (blinkTimeRef.current >= blinkInterval) {
          // Start blink
          const blinkProgress = (blinkTimeRef.current - blinkInterval) / blinkDuration;
          if (blinkProgress <= 1) {
            // Close eyes (0 â†’ 1 â†’ 0)
            avatarMesh.morphTargetInfluences[blinkIndex] =
              Math.sin(blinkProgress * Math.PI);
          } else {
            // Reset blink timer
            blinkTimeRef.current = 0;
            avatarMesh.morphTargetInfluences[blinkIndex] = 0;
          }
        }
      }
    }
  });

  return (
    <group ref={avatarRef}>
      {/* Avatar mesh will be loaded here */}
      <primitive object={avatarMesh} />
    </group>
  );
}
```

**é©—è­‰æ–¹å¼**:
- [ ] é–’ç½®æ™‚ Avatar æœ‰å¾®å¦™çš„ä¸Šä¸‹å‘¼å¸å‹•ç•«ï¼ˆ0.02 å–®ä½ï¼‰
- [ ] èªªè©±æ™‚ Avatar æœ‰æ˜é¡¯çš„ Bounce å‹•ç•«ï¼ˆ0.05 å–®ä½ï¼‰
- [ ] å‘¼å¸å‹•ç•«é€Ÿåº¦ç·©æ…¢ï¼ˆ1.5 rad/sï¼‰
- [ ] çœ¨çœ¼å‹•ç•«æ¯ 3-5 ç§’è§¸ç™¼ä¸€æ¬¡ï¼ˆé€²éšç‰ˆï¼‰
- [ ] å‹•ç•«æµæš¢ä¸å¡é “ï¼ˆ30 FPS+ï¼‰

---

### Task 4: éŸ¿æ‡‰å¼ä½ˆå±€ï¼ˆDesktop/Tablet/Mobileï¼‰

**æè¿°**: å¯¦ä½œé©é…ä¸‰ç¨®è£ç½®çš„éŸ¿æ‡‰å¼ä½ˆå±€

**æª”æ¡ˆ**: `src/app/page.tsx`

**ç¨‹å¼ç¢¼å¯¦ä½œ**:
```typescript
'use client';

import React from 'react';
import { AvatarCanvas } from '@/components/avatar/AvatarCanvas';
import { ChatInterface } from '@/components/chat/ChatInterface';

export default function HomePage() {
  return (
    <div className="flex flex-col lg:flex-row h-screen overflow-hidden">
      {/* Avatar Section */}
      <div className="w-full lg:w-1/2 h-1/2 lg:h-full relative">
        <AvatarCanvas />

        {/* Mobile: Show avatar info overlay */}
        <div className="lg:hidden absolute bottom-4 left-4 right-4 p-4 bg-white/90 backdrop-blur-sm rounded-lg shadow-lg">
          <h2 className="text-lg font-bold text-text-primary">AI Avatar</h2>
          <p className="text-sm text-text-secondary">æ‚¨çš„æ™ºèƒ½å°è©±å¤¥ä¼´</p>
        </div>
      </div>

      {/* Chat Section */}
      <div className="w-full lg:w-1/2 h-1/2 lg:h-full flex flex-col">
        <ChatInterface />
      </div>
    </div>
  );
}
```

**Responsive Styles (Tailwind)**:
```typescript
// Alternative implementation with custom CSS
'use client';

import React from 'react';
import { AvatarCanvas } from '@/components/avatar/AvatarCanvas';
import { ChatInterface } from '@/components/chat/ChatInterface';
import styles from './page.module.css';

export default function HomePage() {
  return (
    <div className={styles.container}>
      <div className={styles.avatarSection}>
        <AvatarCanvas />
      </div>
      <div className={styles.chatSection}>
        <ChatInterface />
      </div>
    </div>
  );
}
```

```css
/* src/app/page.module.css */
.container {
  display: flex;
  height: 100vh;
  overflow: hidden;
}

.avatarSection {
  width: 100%;
  height: 50%;
  position: relative;
}

.chatSection {
  width: 100%;
  height: 50%;
  display: flex;
  flex-direction: column;
}

/* Tablet (â‰¥768px) */
@media (min-width: 768px) {
  .container {
    flex-direction: column;
  }

  .avatarSection {
    height: 60%;
  }

  .chatSection {
    height: 40%;
  }
}

/* Desktop (â‰¥1024px) */
@media (min-width: 1024px) {
  .container {
    flex-direction: row;
  }

  .avatarSection {
    width: 50%;
    height: 100%;
  }

  .chatSection {
    width: 50%;
    height: 100%;
  }
}
```

**é©—è­‰æ–¹å¼**:
- [ ] Desktop: å·¦å³åˆ†æ¬„ä½ˆå±€ï¼ˆ50/50ï¼‰
- [ ] Tablet: ä¸Šä¸‹ä½ˆå±€ï¼ˆ60/40ï¼‰
- [ ] Mobile: ä¸Šä¸‹ä½ˆå±€ï¼ˆ50/50ï¼‰ï¼ŒAvatar æœ‰ info overlay
- [ ] ç€è¦½å™¨è¦–çª— resize æ™‚éæ¸¡æµæš¢
- [ ] æ‰€æœ‰æ–·é»æ–‡å­—æ¸…æ™°å¯è®€

---

### Task 5: Focus Styles èˆ‡ Accessibility

**æè¿°**: ç¢ºä¿æ‰€æœ‰äº’å‹•å…ƒç´ æœ‰æ˜é¡¯çš„ Focus ringï¼Œæ”¯æ´éµç›¤å°èˆª

**æª”æ¡ˆ**: `src/styles/accessibility.css`

**ç¨‹å¼ç¢¼å¯¦ä½œ**:
```css
/* src/styles/accessibility.css */

/* Focus Styles for Interactive Elements */
button:focus-visible,
input:focus-visible,
textarea:focus-visible,
select:focus-visible,
a:focus-visible {
  outline: 2px solid var(--color-primary);
  outline-offset: 2px;
  border-radius: var(--radius-sm);
}

/* High Contrast Focus for Keyboard Users */
@media (prefers-contrast: high) {
  button:focus-visible,
  input:focus-visible,
  textarea:focus-visible,
  a:focus-visible {
    outline-width: 3px;
    outline-color: #000000;
  }
}

/* Skip to Content Link (for screen readers and keyboard users) */
.skip-to-content {
  position: absolute;
  top: -100px;
  left: 0;
  background-color: var(--color-primary);
  color: white;
  padding: 12px 24px;
  text-decoration: none;
  border-radius: var(--radius-md);
  z-index: var(--z-tooltip);
  transition: top var(--transition-base);
}

.skip-to-content:focus {
  top: 10px;
}

/* Remove default focus outline for mouse users (not keyboard) */
*:focus:not(:focus-visible) {
  outline: none;
}

/* Ensure sufficient color contrast */
.text-low-contrast {
  color: var(--color-text-secondary);
}

/* WCAG AA: 4.5:1 for normal text, 3:1 for large text */
.text-high-contrast {
  color: var(--color-text-primary);
}

/* Loading State Accessibility */
[aria-busy='true'] {
  cursor: progress;
}

/* Disabled State Accessibility */
[aria-disabled='true'],
:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  pointer-events: none;
}

/* Screen Reader Only */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}
```

**Skip to Content Component**:
```typescript
// src/components/SkipToContent.tsx
'use client';

import React from 'react';

export function SkipToContent() {
  return (
    <a href="#main-content" className="skip-to-content">
      è·³åˆ°ä¸»è¦å…§å®¹
    </a>
  );
}
```

**ä½¿ç”¨ç¯„ä¾‹**:
```typescript
// src/app/layout.tsx
import { SkipToContent } from '@/components/SkipToContent';

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="zh-TW">
      <body>
        <SkipToContent />
        <main id="main-content">
          {children}
        </main>
      </body>
    </html>
  );
}
```

**é©—è­‰æ–¹å¼**:
- [ ] æ‰€æœ‰æŒ‰éˆ•ã€è¼¸å…¥æ¡†ã€é€£çµæœ‰ focus ring
- [ ] Tab éµå¯ä¾åºå°èˆªæ‰€æœ‰äº’å‹•å…ƒç´ 
- [ ] Skip to Content é€£çµåœ¨ Tab æ™‚é¡¯ç¤º
- [ ] Screen reader å¯æ­£ç¢ºè®€å‡ºæ‰€æœ‰å…§å®¹
- [ ] æ”¯æ´ prefers-reduced-motion

---

### Task 6: Hover Effects èˆ‡ Micro-Interactions

**æè¿°**: ç‚ºæŒ‰éˆ•ã€é€£çµã€å¡ç‰‡åŠ å…¥ Hover æ•ˆæœ

**æª”æ¡ˆ**: `src/components/ui/Button.tsx`

**ç¨‹å¼ç¢¼å¯¦ä½œ (Button Component)**:
```typescript
'use client';

import React from 'react';
import { motion, HTMLMotionProps } from 'framer-motion';

interface ButtonProps extends HTMLMotionProps<'button'> {
  variant?: 'primary' | 'secondary' | 'ghost';
  size?: 'sm' | 'md' | 'lg';
  isLoading?: boolean;
  children: React.ReactNode;
}

export function Button({
  variant = 'primary',
  size = 'md',
  isLoading = false,
  children,
  disabled,
  ...props
}: ButtonProps) {
  const variantStyles = {
    primary: 'bg-primary text-white hover:bg-primary-hover',
    secondary: 'bg-neutral-surface text-text-primary hover:bg-neutral-border',
    ghost: 'bg-transparent text-primary hover:bg-primary/10',
  };

  const sizeStyles = {
    sm: 'px-3 py-1.5 text-sm',
    md: 'px-4 py-2 text-md',
    lg: 'px-6 py-3 text-lg',
  };

  return (
    <motion.button
      className={`
        ${variantStyles[variant]}
        ${sizeStyles[size]}
        rounded-md font-medium
        transition-colors duration-300
        focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2
        disabled:opacity-50 disabled:cursor-not-allowed
      `}
      whileHover={{ scale: disabled || isLoading ? 1 : 1.05 }}
      whileTap={{ scale: disabled || isLoading ? 1 : 0.95 }}
      transition={{ duration: 0.2 }}
      disabled={disabled || isLoading}
      {...props}
    >
      {isLoading ? (
        <span className="flex items-center gap-2">
          <motion.div
            className="w-4 h-4 border-2 border-current border-t-transparent rounded-full"
            animate={{ rotate: 360 }}
            transition={{ duration: 1, repeat: Infinity, ease: 'linear' }}
          />
          è¼‰å…¥ä¸­...
        </span>
      ) : (
        children
      )}
    </motion.button>
  );
}
```

**Card Component with Hover Effect**:
```typescript
'use client';

import React from 'react';
import { motion } from 'framer-motion';

interface CardProps {
  children: React.ReactNode;
  hover?: boolean; // Enable hover effect
  onClick?: () => void;
}

export function Card({ children, hover = false, onClick }: CardProps) {
  return (
    <motion.div
      className="bg-white rounded-lg shadow-md p-6 border border-neutral-border"
      whileHover={hover ? { scale: 1.02, boxShadow: 'var(--shadow-lg)' } : undefined}
      transition={{ duration: 0.2 }}
      onClick={onClick}
      style={{ cursor: onClick ? 'pointer' : 'default' }}
    >
      {children}
    </motion.div>
  );
}
```

**Link Component with Underline Animation**:
```typescript
'use client';

import React from 'react';
import Link from 'next/link';
import { motion } from 'framer-motion';

interface AnimatedLinkProps {
  href: string;
  children: React.ReactNode;
}

export function AnimatedLink({ href, children }: AnimatedLinkProps) {
  return (
    <Link href={href} className="relative inline-block text-primary font-medium">
      {children}
      <motion.span
        className="absolute left-0 bottom-0 w-full h-0.5 bg-primary"
        initial={{ scaleX: 0 }}
        whileHover={{ scaleX: 1 }}
        transition={{ duration: 0.3 }}
        style={{ transformOrigin: 'left' }}
      />
    </Link>
  );
}
```

**é©—è­‰æ–¹å¼**:
- [ ] Button Hover æ™‚æœ‰æ”¾å¤§æ•ˆæœï¼ˆscale 1.05ï¼‰
- [ ] Button é»æ“Šæ™‚æœ‰æŒ‰ä¸‹æ•ˆæœï¼ˆscale 0.95ï¼‰
- [ ] Card Hover æ™‚æœ‰æ”¾å¤§èˆ‡é™°å½±è®ŠåŒ–
- [ ] Link Hover æ™‚æœ‰åº•ç·šå‹•ç•«ï¼ˆscaleX 0 â†’ 1ï¼‰
- [ ] Loading ç‹€æ…‹æŒ‰éˆ•ä¸å¯é»æ“Šï¼Œé¡¯ç¤º spinner
- [ ] æ‰€æœ‰éæ¸¡å‹•ç•«æµæš¢ï¼ˆ300msï¼‰

---

### Task 7: é¡è‰²å°æ¯”åº¦é©—è­‰ (WCAG AA)

**æè¿°**: é©—è­‰æ‰€æœ‰æ–‡å­—èˆ‡èƒŒæ™¯çš„é¡è‰²å°æ¯”åº¦ç¬¦åˆ WCAG AA æ¨™æº–

**æª”æ¡ˆ**: `docs/testing/color-contrast-report.md`

**å·¥å…·**: [WebAIM Contrast Checker](https://webaim.org/resources/contrastchecker/)

**ç¨‹å¼ç¢¼å¯¦ä½œ (Contrast Checker Script)**:
```typescript
// scripts/check-contrast.ts
/**
 * Color Contrast Checker (WCAG AA Standard)
 * Normal text: 4.5:1
 * Large text (â‰¥18pt or 14pt bold): 3:1
 */

interface Color {
  r: number;
  g: number;
  b: number;
}

function hexToRgb(hex: string): Color {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result
    ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16),
      }
    : { r: 0, g: 0, b: 0 };
}

function getLuminance(color: Color): number {
  const { r, g, b } = color;
  const [rs, gs, bs] = [r, g, b].map((c) => {
    c = c / 255;
    return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
  });
  return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;
}

function getContrastRatio(color1: string, color2: string): number {
  const lum1 = getLuminance(hexToRgb(color1));
  const lum2 = getLuminance(hexToRgb(color2));
  const lighter = Math.max(lum1, lum2);
  const darker = Math.min(lum1, lum2);
  return (lighter + 0.05) / (darker + 0.05);
}

function checkWCAG(foreground: string, background: string): {
  ratio: number;
  normalText: boolean;
  largeText: boolean;
} {
  const ratio = getContrastRatio(foreground, background);
  return {
    ratio: Math.round(ratio * 100) / 100,
    normalText: ratio >= 4.5,
    largeText: ratio >= 3.0,
  };
}

// Test Design Tokens
const tests = [
  { name: 'Primary text on white', fg: '#212529', bg: '#ffffff' },
  { name: 'Secondary text on white', fg: '#6c757d', bg: '#ffffff' },
  { name: 'Primary button text', fg: '#ffffff', bg: '#007bff' },
  { name: 'Success text', fg: '#28a745', bg: '#ffffff' },
  { name: 'Error text', fg: '#dc3545', bg: '#ffffff' },
  { name: 'Text on surface', fg: '#212529', bg: '#f8f9fa' },
];

console.log('=== WCAG AA Color Contrast Report ===\n');

tests.forEach((test) => {
  const result = checkWCAG(test.fg, test.bg);
  const status = result.normalText ? 'âœ… PASS' : 'âŒ FAIL';
  console.log(`${status} ${test.name}`);
  console.log(`  Contrast Ratio: ${result.ratio}:1`);
  console.log(`  Normal Text (â‰¥4.5:1): ${result.normalText ? 'âœ…' : 'âŒ'}`);
  console.log(`  Large Text (â‰¥3:1): ${result.largeText ? 'âœ…' : 'âŒ'}`);
  console.log('');
});
```

**åŸ·è¡Œ**:
```bash
npx ts-node scripts/check-contrast.ts
```

**é æœŸè¼¸å‡º**:
```
=== WCAG AA Color Contrast Report ===

âœ… PASS Primary text on white
  Contrast Ratio: 16.89:1
  Normal Text (â‰¥4.5:1): âœ…
  Large Text (â‰¥3:1): âœ…

âœ… PASS Secondary text on white
  Contrast Ratio: 4.68:1
  Normal Text (â‰¥4.5:1): âœ…
  Large Text (â‰¥3:1): âœ…

âœ… PASS Primary button text
  Contrast Ratio: 5.91:1
  Normal Text (â‰¥4.5:1): âœ…
  Large Text (â‰¥3:1): âœ…
```

**é©—è­‰æ–¹å¼**:
- [ ] æ‰€æœ‰æ¸¬è©¦é …ç›®é€šé WCAG AA æ¨™æº–
- [ ] Normal text å°æ¯”åº¦ â‰¥ 4.5:1
- [ ] Large text å°æ¯”åº¦ â‰¥ 3:1
- [ ] è¨˜éŒ„çµæœåˆ°æ–‡ä»¶

---

### Task 8: UI/UX ç´°ç¯€æª¢æŸ¥æ¸…å–®

**æè¿°**: å»ºç«‹å®Œæ•´çš„ UI/UX æª¢æŸ¥æ¸…å–®ï¼Œç¢ºä¿æ‰€æœ‰ç´°ç¯€å®Œå–„

**æª”æ¡ˆ**: `docs/testing/ui-ux-checklist.md`

**ç¨‹å¼ç¢¼å¯¦ä½œ**:
```markdown
# UI/UX Polish Checklist

## âœ… Visual Design

### Typography
- [ ] å­—é«”è¼‰å…¥æ­£å¸¸ï¼ˆInter, ç„¡ FOUT/FOITï¼‰
- [ ] è¡Œé«˜é©ä¸­ï¼ˆ1.5 for body textï¼‰
- [ ] æ¨™é¡Œå±¤ç´šæ¸…æ™°ï¼ˆh1-h6ï¼‰
- [ ] å­—é‡ä½¿ç”¨ä¸€è‡´ï¼ˆ400, 500, 700ï¼‰

### Colors
- [ ] é¡è‰²å°æ¯”åº¦ç¬¦åˆ WCAG AA (â‰¥4.5:1)
- [ ] Primary color ä½¿ç”¨ä¸€è‡´
- [ ] Semantic colors æ­£ç¢ºï¼ˆsuccess, error, warning, infoï¼‰
- [ ] Dark mode è®Šæ•¸å®šç¾©å®Œæ•´ï¼ˆæœªä¾†æ“´å±•ï¼‰

### Spacing
- [ ] å…ƒç´ é–“è·ä¸€è‡´ï¼ˆä½¿ç”¨ design tokensï¼‰
- [ ] Padding/Margin ä½¿ç”¨ 4px å€æ•¸
- [ ] ä½ˆå±€å°é½Šï¼ˆå·¦å°é½Šã€ç½®ä¸­ã€å³å°é½Šæ¸…æ™°ï¼‰
- [ ] ç„¡ç•°å¸¸ç©ºç™½æˆ–æ“æ“ 

### Borders & Shadows
- [ ] Border radius ä¸€è‡´ï¼ˆ4px, 8px, 12pxï¼‰
- [ ] é™°å½±å±¤ç´šæ¸…æ™°ï¼ˆsm, md, lg, xlï¼‰
- [ ] Border é¡è‰²ä¸€è‡´ï¼ˆneutral-borderï¼‰

---

## âœ… Animations & Transitions

### Micro-Interactions
- [ ] Button hover æœ‰é¡è‰²éæ¸¡ï¼ˆ300msï¼‰
- [ ] Input focus æœ‰ scale å‹•ç•«ï¼ˆ200msï¼‰
- [ ] Link hover æœ‰åº•ç·šå‹•ç•«ï¼ˆ300msï¼‰
- [ ] Card hover æœ‰æ”¾å¤§èˆ‡é™°å½±è®ŠåŒ–ï¼ˆ200msï¼‰

### UI Animations
- [ ] è¨Šæ¯ Fade-in/Slide-up æµæš¢ï¼ˆ300msï¼‰
- [ ] Modal enter/exit æµæš¢ï¼ˆ400msï¼‰
- [ ] Toast slide-in æµæš¢ï¼ˆ300msï¼‰
- [ ] Loading spinner æŒçºŒæ—‹è½‰

### 3D Animations
- [ ] Avatar é–’ç½®å‘¼å¸å‹•ç•«ï¼ˆslow, 0.02 unitsï¼‰
- [ ] Avatar èªªè©± Bounce å‹•ç•«ï¼ˆ0.05 unitsï¼‰
- [ ] Avatar çœ¨çœ¼å‹•ç•«ï¼ˆæ¯ 3-5 ç§’ï¼‰

### Performance
- [ ] æ‰€æœ‰å‹•ç•«ç¶­æŒ â‰¥30 FPS
- [ ] ç„¡å¡é “æˆ–æ‰å¹€
- [ ] æ”¯æ´ prefers-reduced-motion

---

## âœ… Responsive Design

### Breakpoints
- [ ] Desktop (â‰¥1024px): å·¦å³åˆ†æ¬„ä½ˆå±€
- [ ] Tablet (768-1023px): ä¸Šä¸‹ä½ˆå±€ï¼ˆ60/40ï¼‰
- [ ] Mobile (â‰¤767px): ä¸Šä¸‹ä½ˆå±€ï¼ˆ50/50ï¼‰

### Layout
- [ ] æ‰€æœ‰æ–·é»æ–‡å­—æ¸…æ™°å¯è®€
- [ ] åœ–ç‰‡/Icon ä¸å¤±çœŸ
- [ ] æŒ‰éˆ•å¤§å°è¶³å¤ ï¼ˆâ‰¥44Ã—44px for touchï¼‰
- [ ] æ©«å‘æ»¾å‹•ç„¡ç•°å¸¸

### Touch Targets
- [ ] æ‰€æœ‰æŒ‰éˆ• â‰¥44Ã—44pxï¼ˆiOS/Android æ¨™æº–ï¼‰
- [ ] é€£çµé–“è·è¶³å¤ ï¼ˆé¿å…èª¤è§¸ï¼‰
- [ ] Swipe gesture æ”¯æ´ï¼ˆæœªä¾†æ“´å±•ï¼‰

---

## âœ… Accessibility

### Keyboard Navigation
- [ ] Tab éµå¯ä¾åºå°èˆªæ‰€æœ‰äº’å‹•å…ƒç´ 
- [ ] Enter/Space å¯è§¸ç™¼æŒ‰éˆ•
- [ ] Escape å¯é—œé–‰ Modal
- [ ] Arrow keys å¯å°èˆªé¸å–®ï¼ˆæœªä¾†æ“´å±•ï¼‰

### Focus Management
- [ ] æ‰€æœ‰äº’å‹•å…ƒç´ æœ‰ focus ring
- [ ] Focus ring æ˜é¡¯ï¼ˆ2px solid primaryï¼‰
- [ ] Modal é–‹å•Ÿæ™‚ focus ç§»è‡³å…§å®¹
- [ ] Modal é—œé–‰æ™‚ focus å›åˆ°è§¸ç™¼å…ƒç´ 

### Screen Reader
- [ ] æ‰€æœ‰åœ–ç‰‡æœ‰ alt text
- [ ] æ‰€æœ‰æŒ‰éˆ•æœ‰ aria-labelï¼ˆåœ–ç¤ºæŒ‰éˆ•ï¼‰
- [ ] Toast ä½¿ç”¨ aria-live region
- [ ] Loading ç‹€æ…‹ä½¿ç”¨ aria-busy
- [ ] Skip to Content é€£çµå­˜åœ¨

### Color Contrast
- [ ] æ‰€æœ‰æ–‡å­—å°æ¯”åº¦ â‰¥4.5:1
- [ ] Large text å°æ¯”åº¦ â‰¥3:1
- [ ] Focus ring å°æ¯”åº¦ â‰¥3:1
- [ ] Disabled ç‹€æ…‹æ¸…æ™°ï¼ˆopacity 0.6ï¼‰

### Motion
- [ ] æ”¯æ´ prefers-reduced-motion
- [ ] å‹•ç•«å¯é¸æ“‡æ€§é—œé–‰ï¼ˆæœªä¾†æ“´å±•ï¼‰

---

## âœ… Performance

### Loading Performance
- [ ] é¦–å±è¼‰å…¥ â‰¤3 ç§’
- [ ] FCP (First Contentful Paint) â‰¤1.5 ç§’
- [ ] LCP (Largest Contentful Paint) â‰¤2.5 ç§’
- [ ] CLS (Cumulative Layout Shift) â‰¤0.1

### Runtime Performance
- [ ] FPS â‰¥30ï¼ˆ3D å ´æ™¯ï¼‰
- [ ] å‹•ç•«æµæš¢ç„¡æ‰å¹€
- [ ] è¨˜æ†¶é«”ä½¿ç”¨ â‰¤500MB
- [ ] CPU ä½¿ç”¨ â‰¤50%

### Asset Optimization
- [ ] åœ–ç‰‡å£“ç¸®ï¼ˆWebP formatï¼‰
- [ ] å­—é«”å­é›†åŒ–ï¼ˆLatin + CJKï¼‰
- [ ] CSS/JS minify
- [ ] Bundle size â‰¤500KB (initial)

---

## âœ… User Experience

### Feedback
- [ ] é»æ“ŠæŒ‰éˆ•æœ‰è¦–è¦ºå›é¥‹ï¼ˆripple/scaleï¼‰
- [ ] Loading ç‹€æ…‹æ¸…æ™°ï¼ˆspinner/progress barï¼‰
- [ ] æˆåŠŸæ“ä½œæœ‰ Toast é€šçŸ¥
- [ ] éŒ¯èª¤æ“ä½œæœ‰å‹å–„è¨Šæ¯

### Error Handling
- [ ] éŒ¯èª¤è¨Šæ¯å‹å–„æ˜“æ‡‚
- [ ] æä¾›é‡è©¦é¸é …
- [ ] ç„¡ç™½å±å´©æ½°
- [ ] Network offline è­¦å‘Š

### Empty States
- [ ] ç„¡è¨Šæ¯æ™‚é¡¯ç¤ºå¼•å°æ–‡å­—
- [ ] Loading æ™‚é¡¯ç¤º Skeleton
- [ ] Error æ™‚é¡¯ç¤ºå‹å–„åœ–ç¤ºèˆ‡è¨Šæ¯

### Consistency
- [ ] æŒ‰éˆ•æ¨£å¼ä¸€è‡´
- [ ] Icon å¤§å°ä¸€è‡´
- [ ] é–“è·ä½¿ç”¨ä¸€è‡´
- [ ] è¡“èªä½¿ç”¨ä¸€è‡´

---

## âœ… Browser Compatibility

### Desktop
- [ ] Chrome (latest)
- [ ] Edge (latest)
- [ ] Safari (latest)
- [ ] Firefox (latest)

### Mobile
- [ ] iOS Safari (latest)
- [ ] Android Chrome (latest)

### Features
- [ ] CSS Grid/Flexbox support
- [ ] CSS Variables support
- [ ] WebGL support (3D scene)
- [ ] Web Audio API support

---

## âœ… Final Polish

### Visual Consistency
- [ ] æ‰€æœ‰é é¢ä½¿ç”¨ç›¸åŒ design system
- [ ] Icon é¢¨æ ¼ä¸€è‡´ï¼ˆoutline vs solidï¼‰
- [ ] é™°å½±æ·±åº¦ä¸€è‡´
- [ ] å‹•ç•«é€Ÿåº¦ä¸€è‡´

### Code Quality
- [ ] CSS ç„¡é‡è¤‡å®šç¾©
- [ ] Unused styles ç§»é™¤
- [ ] Components å¯é‡è¤‡ä½¿ç”¨
- [ ] Naming conventions ä¸€è‡´

### Documentation
- [ ] Design tokens æ–‡ä»¶åŒ–
- [ ] Component usage ç¯„ä¾‹
- [ ] Animation guidelines
- [ ] Accessibility guidelines

---

## é©—æ”¶æ¨™æº–

**é€šéæ¢ä»¶**: æ‰€æœ‰é …ç›®å‹¾é¸å®Œæˆ âœ…

**æ¸¬è©¦è¨­å‚™**:
- Desktop: 1920Ã—1080, Windows/Mac
- Tablet: iPad Pro 11" (1668Ã—2388)
- Mobile: iPhone 14 (390Ã—844)

**æ¸¬è©¦ç€è¦½å™¨**:
- Chrome 120+
- Edge 120+
- Safari 17+
- Firefox 121+
```

**é©—è­‰æ–¹å¼**:
- [ ] æ‰€æœ‰ Checklist é …ç›®å®Œæˆ
- [ ] æˆªåœ–è¨˜éŒ„æ¸¬è©¦çµæœ
- [ ] åœ¨å¤šç¨®è¨­å‚™èˆ‡ç€è¦½å™¨æ¸¬è©¦
- [ ] PO/Designer å¯©æ ¸é€šé

---

## ğŸ“Š Dev Notes

### Animation Performance Optimization

**é¿å…å‹•ç•«å¡é “çš„é—œéµ**:

1. **åªå‹•ç•« transform å’Œ opacity**:
   - âœ… `transform: translateY(10px)` (GPU accelerated)
   - âŒ `top: 10px` (triggers layout, slow)

2. **ä½¿ç”¨ will-change æç¤ºç€è¦½å™¨**:
   ```css
   .animated-element {
     will-change: transform, opacity;
   }
   ```

3. **é¿å…åœ¨å‹•ç•«ä¸­è§¸ç™¼ Layout/Reflow**:
   - âŒ ä¿®æ”¹ width/height/margin/padding
   - âœ… ä½¿ç”¨ transform: scale()

4. **ä½¿ç”¨ requestAnimationFrame**:
   ```typescript
   useFrame(() => {
     // Three.js animations run at 60 FPS automatically
   });
   ```

### Framer Motion Best Practices

**å¸¸ç”¨å‹•ç•«è®Šé«”**:
```typescript
const variants = {
  hidden: { opacity: 0, y: 20 },
  visible: { opacity: 1, y: 0, transition: { duration: 0.3 } },
  exit: { opacity: 0, y: -20, transition: { duration: 0.2 } },
};

<motion.div
  variants={variants}
  initial="hidden"
  animate="visible"
  exit="exit"
/>
```

**Spring Animation** (è‡ªç„¶å½ˆæ€§):
```typescript
<motion.div
  animate={{ scale: 1.1 }}
  transition={{ type: 'spring', stiffness: 300, damping: 20 }}
/>
```

**Stagger Children** (é€å€‹å‡ºç¾):
```typescript
const containerVariants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: {
      staggerChildren: 0.1, // Each child delays 0.1s
    },
  },
};

const itemVariants = {
  hidden: { opacity: 0, y: 20 },
  visible: { opacity: 1, y: 0 },
};

<motion.ul variants={containerVariants} initial="hidden" animate="visible">
  {items.map((item) => (
    <motion.li key={item.id} variants={itemVariants}>
      {item.name}
    </motion.li>
  ))}
</motion.ul>
```

### Responsive Design Strategies

**Mobile-First vs Desktop-First**:

**Mobile-First** (æœ¬å°ˆæ¡ˆæ¡ç”¨):
```css
/* Base styles for mobile */
.container {
  flex-direction: column;
}

/* Tablet and up */
@media (min-width: 768px) {
  .container {
    flex-direction: row;
  }
}
```

**å„ªé»**:
- å¾æœ€å°è¢å¹•é–‹å§‹è¨­è¨ˆï¼Œç¢ºä¿æ ¸å¿ƒåŠŸèƒ½å¯ç”¨
- æ¼¸é€²å¼å¢å¼·ï¼ˆProgressive Enhancementï¼‰
- è¡Œå‹•å„ªå…ˆç¬¦åˆç¾ä»£ web è¶¨å‹¢

**Fluid Typography** (æœªä¾†æ“´å±•):
```css
:root {
  /* Responsive font size using clamp() */
  --font-size-md: clamp(14px, 2vw, 16px);
  --font-size-lg: clamp(16px, 3vw, 24px);
}
```

### Accessibility Checklist

**POUR Principles**:

1. **Perceivable** (å¯æ„ŸçŸ¥):
   - âœ… æ–‡å­—èˆ‡èƒŒæ™¯å°æ¯”åº¦ â‰¥4.5:1
   - âœ… æ‰€æœ‰éæ–‡å­—å…§å®¹æœ‰æ›¿ä»£æ–‡å­—
   - âœ… é¡è‰²ä¸æ˜¯å”¯ä¸€çš„è³‡è¨Šå‚³é”æ–¹å¼

2. **Operable** (å¯æ“ä½œ):
   - âœ… æ‰€æœ‰åŠŸèƒ½å¯é€šééµç›¤æ“ä½œ
   - âœ… Focus é †åºåˆç†
   - âœ… ç„¡éµç›¤é™·é˜±ï¼ˆkeyboard trapï¼‰

3. **Understandable** (å¯ç†è§£):
   - âœ… éŒ¯èª¤è¨Šæ¯æ¸…æ¥šæ˜“æ‡‚
   - âœ… è¡¨å–®æ¨™ç±¤æ˜ç¢º
   - âœ… æ“ä½œçµæœå¯é æ¸¬

4. **Robust** (å …å›º):
   - âœ… æ”¯æ´è¼”åŠ©æŠ€è¡“ï¼ˆscreen readerï¼‰
   - âœ… èªç¾©åŒ– HTMLï¼ˆsemantic HTMLï¼‰
   - âœ… ARIA attributes æ­£ç¢ºä½¿ç”¨

**ARIA Best Practices**:
```typescript
// Button with icon only
<button aria-label="é—œé–‰å°è©±æ¡†">
  <XIcon />
</button>

// Loading state
<div aria-busy="true" aria-live="polite">
  è¼‰å…¥ä¸­...
</div>

// Modal
<div role="dialog" aria-labelledby="modal-title" aria-modal="true">
  <h2 id="modal-title">å°è©±æ¡†æ¨™é¡Œ</h2>
</div>
```

### Dark Mode Implementation (æœªä¾†æ“´å±•)

**CSS Variables Strategy**:
```css
:root {
  --color-background: #ffffff;
  --color-text-primary: #212529;
}

[data-theme='dark'] {
  --color-background: #1a1a1a;
  --color-text-primary: #ffffff;
}
```

**React Hook**:
```typescript
function useDarkMode() {
  const [theme, setTheme] = useState<'light' | 'dark'>('light');

  useEffect(() => {
    const stored = localStorage.getItem('theme');
    if (stored) {
      setTheme(stored as 'light' | 'dark');
      document.documentElement.setAttribute('data-theme', stored);
    }
  }, []);

  const toggleTheme = () => {
    const newTheme = theme === 'light' ? 'dark' : 'light';
    setTheme(newTheme);
    localStorage.setItem('theme', newTheme);
    document.documentElement.setAttribute('data-theme', newTheme);
  };

  return { theme, toggleTheme };
}
```

---

## ğŸ§ª Testing Strategy

### Visual Regression Testing

**å·¥å…·**: Percy, Chromatic, BackstopJS

**æ¸¬è©¦æµç¨‹**:
1. å»ºç«‹ baseline screenshotsï¼ˆå„ç¨®ç‹€æ…‹èˆ‡æ–·é»ï¼‰
2. ç¨‹å¼ç¢¼è®Šæ›´å¾Œè‡ªå‹•è·‘æ¸¬è©¦
3. æ¯”å°å·®ç•°ï¼Œäººå·¥å¯©æ ¸
4. æ‰¹å‡†è®Šæ›´æˆ–ä¿®æ­£ bug

**ç¯„ä¾‹ (Chromatic)**:
```bash
npm install --save-dev chromatic
npx chromatic --project-token=<token>
```

### Manual Testing

**æ¸¬è©¦æ¸…å–®**: åƒè€ƒ Task 8 çš„å®Œæ•´ Checklist

**æ¸¬è©¦é‡é»**:
- [ ] æ‰€æœ‰å‹•ç•«æµæš¢ï¼ˆ30 FPS+ï¼‰
- [ ] éŸ¿æ‡‰å¼ä½ˆå±€æ­£ç¢º
- [ ] æ‰€æœ‰äº’å‹•å…ƒç´ æœ‰ Hover/Focus æ•ˆæœ
- [ ] éµç›¤å°èˆªé †åºåˆç†
- [ ] é¡è‰²å°æ¯”åº¦ç¬¦åˆ WCAG AA

### User Testing

**æ¸¬è©¦å°è±¡**: 5-10 ä½ä½¿ç”¨è€…ï¼ˆå¤šå…ƒèƒŒæ™¯ï¼‰

**æ¸¬è©¦ä»»å‹™**:
1. é–‹å•Ÿæ‡‰ç”¨ç¨‹å¼ï¼Œæè¿°ç¬¬ä¸€å°è±¡
2. å˜—è©¦èˆ‡ Avatar å°è©±
3. è§€å¯Ÿå‹•ç•«èˆ‡éæ¸¡æ•ˆæœ
4. ä½¿ç”¨ä¸åŒè£ç½®ï¼ˆDesktop/Mobileï¼‰
5. å›é¥‹æ•´é«”ä½¿ç”¨é«”é©—

**è©•åˆ†æ¨™æº–**:
- è¦–è¦ºå¸å¼•åŠ›: 1-5 åˆ†
- å‹•ç•«æµæš¢åº¦: 1-5 åˆ†
- äº’å‹•å›é¥‹: 1-5 åˆ†
- æ•´é«”å°ˆæ¥­åº¦: 1-5 åˆ†

**ç›®æ¨™**: å¹³å‡ â‰¥4.0/5.0

---

## ğŸ“ˆ Success Metrics

### é‡åŒ–æŒ‡æ¨™

1. **è¦–è¦ºå“è³ª**: Lighthouse Accessibility Score â‰¥90
2. **å‹•ç•«æ•ˆèƒ½**: FPS â‰¥30 (3D scene)
3. **è¼‰å…¥é€Ÿåº¦**: FCP â‰¤1.5s, LCP â‰¤2.5s
4. **å°æ¯”åº¦**: 100% text passes WCAG AA
5. **éŸ¿æ‡‰å¼**: 3 breakpoints tested on real devices

### è³ªåŒ–æŒ‡æ¨™

1. **ä½¿ç”¨è€…å›é¥‹**: "ä»‹é¢å°ˆæ¥­ç¾è§€ï¼Œå‹•ç•«æµæš¢è‡ªç„¶"
2. **é–‹ç™¼è€…é«”é©—**: "Design system å®Œæ•´ï¼Œå…ƒä»¶æ˜“é‡è¤‡ä½¿ç”¨"
3. **å“ç‰Œå°è±¡**: "ç”¢å“å…·å‚™å°ˆæ¥­ç´šè³ªæ„Ÿ"

---

## ğŸ”— Dependencies

### Epic Dependencies
- **Depends on**:
  - Epic 2 (Avatar Canvas éœ€è¦ UI polish)
  - Epic 3 (Chat Interface éœ€è¦ UI polish)
  - Story 5.2 (Toast ç³»çµ±å¯é‡è¤‡ä½¿ç”¨)

### Story Dependencies
- **Must Complete Before**:
  - Story 5.4 (ç€è¦½å™¨ç›¸å®¹æ€§æ¸¬è©¦) - éœ€è¦å®Œæ•´ UI é€²è¡Œæ¸¬è©¦
  - Story 5.6 (æŠ€è¡“é©—è­‰å ±å‘Š) - éœ€è¦ UI/UX æ¸¬è©¦çµæœ

### External Dependencies
- `framer-motion@11.x`: Animation library
- `tailwindcss@3.x`: Utility-first CSS framework
- `next@14.x`: App Router, client components
- `@react-three/fiber@8.x`: Three.js React renderer

---

## ğŸ“¦ Deliverables

1. **Styles**:
   - `src/styles/design-tokens.css` âœ…
   - `src/styles/accessibility.css` âœ…
   - `tailwind.config.ts` âœ…

2. **Components**:
   - `src/components/ui/Button.tsx` âœ…
   - `src/components/ui/Card.tsx` âœ…
   - `src/components/ui/AnimatedLink.tsx` âœ…
   - `src/components/SkipToContent.tsx` âœ…

3. **Enhanced Components**:
   - `src/components/chat/ChatInterface.tsx` (with animations) âœ…
   - `src/components/avatar/AvatarModel.tsx` (with idle animation) âœ…

4. **Scripts**:
   - `scripts/check-contrast.ts` âœ…

5. **Documentation**:
   - `docs/testing/ui-ux-checklist.md` âœ…
   - `docs/testing/color-contrast-report.md` âœ…

---

## âœ… Definition of Done

- [ ] å…¨åŸŸ Design Tokens å®šç¾©å®Œæ•´ï¼ˆé¡è‰²ã€é–“è·ã€å­—å‹ã€éæ¸¡ï¼‰
- [ ] èŠå¤©ä»‹é¢å‹•ç•«æµæš¢ï¼ˆFade-in/Slide-up, Focus scaleï¼‰
- [ ] Avatar é–’ç½®å‘¼å¸å‹•ç•«èˆ‡èªªè©± Bounce å‹•ç•«å®Œæˆ
- [ ] éŸ¿æ‡‰å¼ä½ˆå±€é©é… Desktop/Tablet/Mobile
- [ ] æ‰€æœ‰äº’å‹•å…ƒç´ æœ‰ Focus ring èˆ‡ Hover effect
- [ ] é¡è‰²å°æ¯”åº¦ç¬¦åˆ WCAG AA æ¨™æº–ï¼ˆâ‰¥4.5:1ï¼‰
- [ ] æ‰€æœ‰å‹•ç•«æ”¯æ´ prefers-reduced-motion
- [ ] UI/UX Checklist æ‰€æœ‰é …ç›®å®Œæˆ
- [ ] è¦–è¦ºå›æ­¸æ¸¬è©¦é€šéï¼ˆè‹¥æœ‰ï¼‰
- [ ] User testing å¹³å‡åˆ†æ•¸ â‰¥4.0/5.0
- [ ] åœ¨ Chrome, Edge, Safari, Firefox æ¸¬è©¦é€šé
- [ ] Code review é€šé
- [ ] æ–‡ä»¶é½Šå…¨ï¼ˆDesign tokens, Accessibility guidelinesï¼‰

---

## ğŸ“š References

- [Framer Motion Documentation](https://www.framer.com/motion/)
- [Tailwind CSS Documentation](https://tailwindcss.com/docs)
- [WCAG 2.1 Guidelines](https://www.w3.org/WAI/WCAG21/quickref/)
- [MDN: prefers-reduced-motion](https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-reduced-motion)
- [WebAIM Contrast Checker](https://webaim.org/resources/contrastchecker/)
- [Google Web Fundamentals: Animations](https://developers.google.com/web/fundamentals/design-and-ux/animations)
- [Inclusive Components](https://inclusive-components.design/)

---

**Story å»ºç«‹æ—¥æœŸ**: 2025-10-14
**æœ€å¾Œæ›´æ–°**: 2025-10-14
**INVEST Score**: â­â­â­â­â­â­ (6/6)
- âœ… Independent: å¯ç¨ç«‹é–‹ç™¼èˆ‡æ¸¬è©¦
- âœ… Negotiable: å‹•ç•«åƒæ•¸ã€æ–·é»å¯èª¿æ•´
- âœ… Valuable: å¤§å¹…æå‡ç”¢å“å°ˆæ¥­åº¦èˆ‡ä½¿ç”¨è€…é«”é©—
- âœ… Estimable: 7 å°æ™‚é ä¼°æ™‚é–“åˆç†
- âœ… Small: ç¯„åœæ˜ç¢ºï¼Œå¯åœ¨ä¸€å€‹ Sprint å…§å®Œæˆ
- âœ… Testable: å¯é€éè¦–è¦ºå›æ­¸æ¸¬è©¦ã€æ‰‹å‹•æ¸¬è©¦èˆ‡ User testing é©—è­‰
